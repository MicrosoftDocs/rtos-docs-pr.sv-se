---
title: Kapitel 1 – Introduktion till Azure återställnings tider NetX Duo SNTP
description: Azure återställnings tider NetX Simple Network Time Protocol (SNTP) är ett protokoll som utformats för att synkronisera klockor via Internet.
author: philmea
ms.author: philmea
ms.date: 06/04/2020
ms.topic: article
ms.service: rtos
ms.openlocfilehash: b3e1170197c6c4981060459104da80e354fac5db
ms.sourcegitcommit: e3d42e1f2920ec9cb002634b542bc20754f9544e
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 03/22/2021
ms.locfileid: "104825752"
---
# <a name="chapter-1---introduction-to-azure-rtos-netx-duo-sntp"></a><span data-ttu-id="847ef-103">Kapitel 1 – Introduktion till Azure återställnings tider NetX Duo SNTP</span><span class="sxs-lookup"><span data-stu-id="847ef-103">Chapter 1 - Introduction to Azure RTOS NetX Duo SNTP</span></span> 

<span data-ttu-id="847ef-104">Azure återställnings tider NetX Simple Network Time Protocol (SNTP) är ett protokoll som utformats för att synkronisera klockor via Internet.</span><span class="sxs-lookup"><span data-stu-id="847ef-104">The Azure RTOS NetX Simple Network Time Protocol (SNTP) is a protocol designed for synchronizing clocks over the Internet.</span></span> <span data-ttu-id="847ef-105">SNTP version 4 är ett förenklat protokoll baserat på Network Time Protocol (NTP).</span><span class="sxs-lookup"><span data-stu-id="847ef-105">SNTP Version 4 is a simplified protocol based on the Network Time Protocol (NTP).</span></span> <span data-ttu-id="847ef-106">Den använder UDP-tjänster (User Datagram Protocol) för att utföra tids uppdateringar i ett enkelt, tillstånds lösa protokoll.</span><span class="sxs-lookup"><span data-stu-id="847ef-106">It utilizes User Datagram Protocol (UDP) services to perform time updates in a simple, stateless protocol.</span></span> <span data-ttu-id="847ef-107">Även om det inte är så komplext som NTP är SNTP mycket tillförlitligt och korrekt.</span><span class="sxs-lookup"><span data-stu-id="847ef-107">Though not as complex as NTP, SNTP is highly reliable and accurate.</span></span> <span data-ttu-id="847ef-108">I de flesta platser för dagens Internet ger SNTP en noggrannhet på 1-50 millisekunder, beroende på egenskaperna för synkroniseringens källa och nätverks Sök vägar.</span><span class="sxs-lookup"><span data-stu-id="847ef-108">In most places of the Internet of today, SNTP provides accuracies of 1-50 milliseconds, depending on the characteristics of the synchronization source and network paths.</span></span> <span data-ttu-id="847ef-109">SNTP har många alternativ för att tillhandahålla tillförlitligheten för att ta emot tid uppdateringar.</span><span class="sxs-lookup"><span data-stu-id="847ef-109">SNTP has many options to provide reliability of receiving time updates.</span></span> <span data-ttu-id="847ef-110">Möjlighet att växla till alternativa servrar och att tillämpa inaktive ring av avsöknings algoritmer och automatisk tids Server identifiering är bara några av de olika sätten för en SNTP-klient att hantera en variabel Internet tids tjänst miljö.</span><span class="sxs-lookup"><span data-stu-id="847ef-110">Ability to switch to alternative servers, applying back off polling algorithms and automatic time server discovery are just a few of the means for an SNTP client to handle a variable Internet time service environment.</span></span> <span data-ttu-id="847ef-111">Vad det saknar i precisionen utgör det för enkelhetens skull och under lätta implementeringen.</span><span class="sxs-lookup"><span data-stu-id="847ef-111">What it lacks in precision it makes up for in simplicity and ease of implementation.</span></span> <span data-ttu-id="847ef-112">SNTP är främst avsett för att tillhandahålla omfattande mekanismer för att få åtkomst till nationella tids-och frekvens spridnings tjänster (t. ex. NTP-server).</span><span class="sxs-lookup"><span data-stu-id="847ef-112">SNTP is intended primarily for providing comprehensive mechanisms to access national time and frequency dissemination (e.g. NTP server) services.</span></span>

## <a name="netx-duo-sntp-client-requirements"></a><span data-ttu-id="847ef-113">Krav för NetX Duo SNTP-klient</span><span class="sxs-lookup"><span data-stu-id="847ef-113">NetX Duo SNTP Client Requirements</span></span>

<span data-ttu-id="847ef-114">NetX Duo SNTP-klienten kräver att en IP-instans redan har skapats.</span><span class="sxs-lookup"><span data-stu-id="847ef-114">The NetX Duo SNTP Client requires that an IP instance has already been created.</span></span> <span data-ttu-id="847ef-115">Dessutom måste UDP vara aktiverat på samma IP-instans och ha till gång till den *välkända* port 123 för att skicka tidsdata till en SNTP-server, även om alternativa portar fungerar också.</span><span class="sxs-lookup"><span data-stu-id="847ef-115">In addition, UDP must be enabled on that same IP instance and should have access to the *well-known* port 123 for sending time data to an SNTP Server, although alternative ports will work as well.</span></span> <span data-ttu-id="847ef-116">Broadcast-klienter ska binda UDP-porten deras broadcast-server skickar, vanligt vis 123.</span><span class="sxs-lookup"><span data-stu-id="847ef-116">Broadcast clients should bind the UDP port their broadcast server is sending on, usually 123.</span></span> <span data-ttu-id="847ef-117">Klient programmet NetX Duo SNTP måste ha en eller flera IP-adresser för Server-SNTP.</span><span class="sxs-lookup"><span data-stu-id="847ef-117">The NetX Duo SNTP Client application must have one or more IP SNTP Server addresses.</span></span>

## <a name="netx-duo-sntp-client-limitations"></a><span data-ttu-id="847ef-118">Begränsningar för NetX Duo SNTP-klienten</span><span class="sxs-lookup"><span data-stu-id="847ef-118">NetX Duo SNTP Client Limitations</span></span> 

<span data-ttu-id="847ef-119">Precision i lokal tids representation i NTP-tidsuppdateringar som hanteras av SNTP-klientens API är begränsat till en upplösning på millisekunder.</span><span class="sxs-lookup"><span data-stu-id="847ef-119">Precision in local time representation in NTP time updates handled by the SNTP Client API is limited to millisecond resolution.</span></span>

<span data-ttu-id="847ef-120">SNTP-klienten innehåller bara en enda SNTP-serveradress när som helst.</span><span class="sxs-lookup"><span data-stu-id="847ef-120">The SNTP Client only holds a single SNTP Server address at any time.</span></span> <span data-ttu-id="847ef-121">Om servern inte längre är giltig, måste programmet stoppa SNTP-klientens aktivitet och initiera om den med en annan SNTP-serveradress, antingen via broadcast eller unicast SNTP-kommunikation.</span><span class="sxs-lookup"><span data-stu-id="847ef-121">If that Server appears to be no longer valid, the application must stop the SNTP Client task, and reinitialize it with another SNTP server address, using either broadcast or unicast SNTP communication.</span></span>

<span data-ttu-id="847ef-122">SNTP-klienten stöder inte manycast.</span><span class="sxs-lookup"><span data-stu-id="847ef-122">The SNTP Client does not support manycast.</span></span>

<span data-ttu-id="847ef-123">NetX Duo SNTP-klienten stöder inte autentiseringsmekanismer för verifiering av mottagna paket data.</span><span class="sxs-lookup"><span data-stu-id="847ef-123">NetX Duo SNTP Client does not support authentication mechanisms for verifying received packet data.</span></span>

## <a name="netx-duo-sntp-client-operation"></a><span data-ttu-id="847ef-124">NetX Duo SNTP-klient åtgärd</span><span class="sxs-lookup"><span data-stu-id="847ef-124">NetX Duo SNTP Client Operation</span></span>

<span data-ttu-id="847ef-125">RFC 4330 rekommenderar att SNTP-klienter endast ska använda det högsta stratum i sitt lokala nätverk och helst i konfigurationer där ingen NTP-eller SNTP-klient är beroende av dem för synkronisering.</span><span class="sxs-lookup"><span data-stu-id="847ef-125">RFC 4330 recommends that SNTP clients should operate only at the highest stratum of their local network and preferably in configurations where no NTP or SNTP client is dependent them for synchronization.</span></span> <span data-ttu-id="847ef-126">Stratum-nivån återspeglar värd positionen i NTP-tidshierarkin där stratum 1 är den högsta nivån (en rot tids Server) och 15 är den lägsta tillåtna nivån (t. ex. klient).</span><span class="sxs-lookup"><span data-stu-id="847ef-126">Stratum level reflects the host position in the NTP time hierarchy where stratum 1 is the highest level (a root time server) and 15 is the lowest allowed level (e.g. Client).</span></span> <span data-ttu-id="847ef-127">SNTP-klientens standardvärde för minsta stratum är 2.</span><span class="sxs-lookup"><span data-stu-id="847ef-127">The SNTP Client default minimum stratum is 2.</span></span>

<span data-ttu-id="847ef-128">NetX Duo SNTP-klienten kan köras i ett av två grundläggande lägen, unicast eller broadcast, för att få tid via Internet.</span><span class="sxs-lookup"><span data-stu-id="847ef-128">The NetX Duo SNTP Client can operate in one of two basic modes, unicast or broadcast, to obtain time over the Internet.</span></span> <span data-ttu-id="847ef-129">I unicast-läge avsöker klienten sin SNTP-server med jämna mellanrum och väntar på att få ett svar från den servern.</span><span class="sxs-lookup"><span data-stu-id="847ef-129">In unicast mode, the Client polls its SNTP Server on regular intervals and waits to receive a reply from that Server.</span></span> <span data-ttu-id="847ef-130">När en tas emot, verifierar klienten att svaret innehåller en giltig tids uppdatering genom att använda en uppsättning "Sanity-kontroller" som rekommenderas av RFC 4330.</span><span class="sxs-lookup"><span data-stu-id="847ef-130">When one is received, the Client verifies that the reply contains a valid time update by applying a set of ‘sanity checks’ recommended by RFC 4330.</span></span> <span data-ttu-id="847ef-131">Klienten använder sedan tids skillnaden, om det finns, med Server klockan på den lokala klockan.</span><span class="sxs-lookup"><span data-stu-id="847ef-131">The Client then applies the time difference, if any, with the Server clock to its local clock.</span></span> <span data-ttu-id="847ef-132">I sändnings läge lyssnar klienten bara efter tid för att uppdatera sändningarna och behåller sin lokala klocka efter att ha tillämpat en liknande uppsättning Sanity-kontroller för att kontrol lera uppdaterings tidnas data.</span><span class="sxs-lookup"><span data-stu-id="847ef-132">In broadcast mode, the Client merely listens for time update broadcasts and maintains its local clock after applying a similar set of sanity checks to verify the update time data.</span></span> <span data-ttu-id="847ef-133">Sanity-kontroller beskrivs i detalj i avsnittet om **SNTP-Sanity kontroller** nedan.</span><span class="sxs-lookup"><span data-stu-id="847ef-133">Sanity checks are described in detail in the **SNTP Sanity Checks** section below.</span></span>

<span data-ttu-id="847ef-134">Innan klienten kan köras i båda lägena måste den upprätta sina operativa parametrar.</span><span class="sxs-lookup"><span data-stu-id="847ef-134">Before the Client can run in either mode, it must establish its operating parameters.</span></span> <span data-ttu-id="847ef-135">Detta görs genom att anropa antingen *nx_sntp_client_initialize_unicast* eller *nx_sntp_client_initialize_broadcast* för unicast-eller sändnings lägen.</span><span class="sxs-lookup"><span data-stu-id="847ef-135">This is done by calling either *nx_sntp_client_initialize_unicast* or *nx_sntp_client_initialize_broadcast* for unicast or broadcast modes, respectively.</span></span> <span data-ttu-id="847ef-136">Detta gör att tids gränsen för maximal tid överskrids utan en giltig uppdatering, att gränsen på på varandra följande ogiltiga uppdateringar togs emot, ett avsöknings intervall för unicast-läge, Operations mode, t. ex. unicast vs. broadcast och SNTP server.</span><span class="sxs-lookup"><span data-stu-id="847ef-136">These serves set the time outs for maximum time lapse without a valid update, the limit on consecutive invalid updates received, a polling interval for unicast mode, operation mode e.g. unicast vs. broadcast, and SNTP Server.</span></span>

<span data-ttu-id="847ef-137">Om den maximala tiden för fördröjning eller högsta antalet mottagna uppdateringar överskrids, fortsätter SNTP-klienten att köras men anger den aktuella statusen för SNTP-servern till ogiltig.</span><span class="sxs-lookup"><span data-stu-id="847ef-137">If the maximum time lapse or maximum invalid updates received is exceeded, the SNTP Client continues to run but sets the current SNTP Server status to invalid.</span></span> <span data-ttu-id="847ef-138">Programmet kan avsöka SNTP-klienten med hjälp av *nx_sntp_client_receiving_updates* -tjänsten för att kontrol lera att SNTP-servern fortfarande skickar giltiga uppdateringar.</span><span class="sxs-lookup"><span data-stu-id="847ef-138">The application can poll the SNTP Client using the *nx_sntp_client_receiving_updates* service to verify the SNTP Server is still sending valid updates.</span></span> <span data-ttu-id="847ef-139">Om inte, bör den stoppa klient tråden för SNTP med hjälp av *nx_sntp_client_stop* tjänsten och anropa någon av de två initierande tjänsterna för att ange en annan SNTP-serveradress.</span><span class="sxs-lookup"><span data-stu-id="847ef-139">If not, it should stop the SNTP Client thread using the *nx_sntp_client_stop* service and call either of the two initialize services to set another SNTP Server address.</span></span> <span data-ttu-id="847ef-140">För att starta om SNTP-klienten anropar programmet *nx_sntp_client_run_broadcast* eller *nx_sntp_client_run_unicast*.</span><span class="sxs-lookup"><span data-stu-id="847ef-140">To restart the SNTP Client, the application calls *nx_sntp_client_run_broadcast* or *nx_sntp_client_run_unicast*.</span></span> <span data-ttu-id="847ef-141">Observera att programmet kan ändra distributions läget för SNTP-klienten i initierings anropet för att växla till unicast eller broadcast som du vill.</span><span class="sxs-lookup"><span data-stu-id="847ef-141">Note that the application can change SNTP Client operating mode in the initialize call to switch to unicast or broadcast as desired.</span></span>

### <a name="local-clock-operation"></a><span data-ttu-id="847ef-142">Lokal klock åtgärd</span><span class="sxs-lookup"><span data-stu-id="847ef-142">Local Clock Operation</span></span>

<span data-ttu-id="847ef-143">SNTP-tiden baseras på antalet sekunder på huvud-NTP-klockan eller antalet sekunder som förflutit i den första NTP-klockan, t. ex. från 1 januari **1900 00:00:00 till** 1 januari **1999 00:00:00**.</span><span class="sxs-lookup"><span data-stu-id="847ef-143">The SNTP time based on the number of seconds on the master NTP clock, or number of seconds elapsed in the first NTP epoch e.g. from Jan 1 **1900 00:00:00 to** Jan 1 **1999 00:00:00**.</span></span> <span data-ttu-id="847ef-144">Betydelsen av 01-01-1999 var när den senaste avslags sekunden inträffade.</span><span class="sxs-lookup"><span data-stu-id="847ef-144">The significance of 01-01-1999 was when the last leap second occurred.</span></span> <span data-ttu-id="847ef-145">Det här värdet definieras enligt följande:</span><span class="sxs-lookup"><span data-stu-id="847ef-145">This value is defined as follows:</span></span>

<span data-ttu-id="847ef-146">\#definiera NTP_SECONDS_AT_01011999 0xBA368E80</span><span class="sxs-lookup"><span data-stu-id="847ef-146">\#define NTP_SECONDS_AT_01011999 0xBA368E80</span></span>

<span data-ttu-id="847ef-147">Innan SNTP-klienten körs kan programmet även initiera lokal tid för SNTP-klienten för klienten som ska användas som en bas linje.</span><span class="sxs-lookup"><span data-stu-id="847ef-147">Before the SNTP Client runs, the application can optionally initialize the SNTP Client local time for the Client to use as a baseline time.</span></span> <span data-ttu-id="847ef-148">För att göra det måste tjänsten *nx_sntp_client_set_local_time* användas.</span><span class="sxs-lookup"><span data-stu-id="847ef-148">To do so, it must use the *nx_sntp_client_set_local_time* service.</span></span> <span data-ttu-id="847ef-149">Detta tar tiden i NTP-format, sekunder och del, där bråk är millisekunderna i den komprimerade NTP-tiden.</span><span class="sxs-lookup"><span data-stu-id="847ef-149">This takes the time in NTP format, seconds and fraction, where fraction is the milliseconds in the NTP condensed time.</span></span> <span data-ttu-id="847ef-150">Vi rekommenderar att programmet får en SNTP-tid från en oberoende källa.</span><span class="sxs-lookup"><span data-stu-id="847ef-150">Ideally the application can obtain an SNTP time from an independent source.</span></span> <span data-ttu-id="847ef-151">Det finns inget API för att konvertera år, månad, datum och tid till en NTP-tid i NetX Duo SNTP-klienten.</span><span class="sxs-lookup"><span data-stu-id="847ef-151">There is no API for converting year, month, date and time to an NTP time in the NetX Duo SNTP Client.</span></span> <span data-ttu-id="847ef-152">En beskrivning av NTP-tidsformat finns i *RFC4330 "Simple Network Time Protocol (SNTP) version 4 för IPv4, IPv6 och OSI".*</span><span class="sxs-lookup"><span data-stu-id="847ef-152">For a description of NTP time format, refer to *RFC4330 “Simple Network Time Protocol (SNTP) Version 4 for IPv4, IPv6 and OSI”.*</span></span>

<span data-ttu-id="847ef-153">Om ingen bas lokal tid anges när SNTP-klienten startas, accepterar SNTP-klienten SNTP-uppdateringar utan att jämföra med den lokala tiden på den första uppdateringen.</span><span class="sxs-lookup"><span data-stu-id="847ef-153">If no base local time is supplied when the SNTP Client starts up, the SNTP Client will accept the SNTP updates without comparing to its local time on the first update.</span></span> <span data-ttu-id="847ef-154">Därefter kommer den att tillämpa den högsta och lägsta tids uppdaterings värden för att avgöra om den kommer att ändra den lokala tiden.</span><span class="sxs-lookup"><span data-stu-id="847ef-154">Thereafter it will apply the maximum and minimum time update values to determine if it will modify its local time.</span></span>

<span data-ttu-id="847ef-155">Programmet kan använda tjänsten *nx_sntp_client_get_local_time_extended* för att hämta lokal tid för SNTP-klienten.</span><span class="sxs-lookup"><span data-stu-id="847ef-155">To obtain the SNTP Client local time, the application can use the *nx_sntp_client_get_local_time_extended* service.</span></span>

### <a name="sntp-sanity-checks"></a><span data-ttu-id="847ef-156">Sanity-kontroller för SNTP</span><span class="sxs-lookup"><span data-stu-id="847ef-156">SNTP Sanity Checks</span></span> 

<span data-ttu-id="847ef-157">Klienten undersöker det inkommande paketet med följande kriterier:</span><span class="sxs-lookup"><span data-stu-id="847ef-157">The Client examines the incoming packet for the following criteria:</span></span>

  - <span data-ttu-id="847ef-158">Käll-IP-adressen måste matcha den aktuella serverns IP-adress.</span><span class="sxs-lookup"><span data-stu-id="847ef-158">Source IP address must match the current server IP address.</span></span>

  - <span data-ttu-id="847ef-159">Avsändar käll porten måste stämma överens med den aktuella Server käll porten.</span><span class="sxs-lookup"><span data-stu-id="847ef-159">Sender source port must match with the current server source port.</span></span>

  - <span data-ttu-id="847ef-160">Paket längden måste vara den minsta längd som ska rymmas ett SNTP-klock meddelande.</span><span class="sxs-lookup"><span data-stu-id="847ef-160">Packet length must be the minimum length to hold an SNTP time message.</span></span>

<span data-ttu-id="847ef-161">Därefter extraheras tids data från den minnesbuffert som klienten sedan tillämpar en uppsättning av vissa "Sanity kontroller":</span><span class="sxs-lookup"><span data-stu-id="847ef-161">Next, the time data is extracted from the packet buffer to which the Client then applies a set of specific ‘sanity checks’:</span></span>

  - <span data-ttu-id="847ef-162">Indikatorn för klivet som anges till 3 anger att servern inte är synkroniserad.</span><span class="sxs-lookup"><span data-stu-id="847ef-162">The Leap Indicator set to 3 indicates the Server is not synchronized.</span></span> <span data-ttu-id="847ef-163">Klienten bör försöka hitta en alternativ server.</span><span class="sxs-lookup"><span data-stu-id="847ef-163">The Client should attempt to find an alternative server.</span></span>

  - <span data-ttu-id="847ef-164">Ett stratum-fält med värdet noll kallas för ett kyss-paket (KOD för dödsfall).</span><span class="sxs-lookup"><span data-stu-id="847ef-164">A stratum field set to zero is known as a Kiss of Death (KOD) packet.</span></span> <span data-ttu-id="847ef-165">SMTP-klienten KOD hanterare för den här situationen är en användardefinierad motringning.</span><span class="sxs-lookup"><span data-stu-id="847ef-165">The SMTP Client KOD handler for this situation is a user defined callback.</span></span> <span data-ttu-id="847ef-166">Den lilla exempel demonstrations filen innehåller en enkel KOD hanterare för den här situationen.</span><span class="sxs-lookup"><span data-stu-id="847ef-166">The small example demo file contains a simple KOD handler for this situation.</span></span> <span data-ttu-id="847ef-167">Fältet referens-ID innehåller en kod som anger orsaken till att KOD svaret är uppfyllt.</span><span class="sxs-lookup"><span data-stu-id="847ef-167">The Reference ID field optionally contains a code indicating the reason for the KOD reply.</span></span> <span data-ttu-id="847ef-168">KOD hanteraren måste i vilken takt som helst visa hur de ska hantera att ta emot en kyss från SNTP-servern.</span><span class="sxs-lookup"><span data-stu-id="847ef-168">At any rate, the KOD handler must indicate how to handle receiving a kiss of death from the SNTP Server.</span></span> <span data-ttu-id="847ef-169">Det innebär vanligt vis att du vill initiera om SNTP-klienten med en annan SNTP-server.</span><span class="sxs-lookup"><span data-stu-id="847ef-169">Typically it will want to reinitialize the SNTP Client with another SNTP Server.</span></span>

  - <span data-ttu-id="847ef-170">Serverns SNTP-version, stratum och drift läge måste matchas med klient tjänsten.</span><span class="sxs-lookup"><span data-stu-id="847ef-170">The Server SNTP version, stratum and mode of operation must be matched to the Client service.</span></span>

  - <span data-ttu-id="847ef-171">Om klienten har kon figurer ATS med ett maximalt värde för en server klocka, kontrollerar klienten Server klockans spridning på den första uppdateringen tas emot, och om den överskrider klientens Max värde avvisar klienten servern.</span><span class="sxs-lookup"><span data-stu-id="847ef-171">If the Client is configured with a server clock dispersion maximum, the Client checks the server clock dispersion on the first update received only, and if it exceeds the Client maximum, the Client rejects the Server.</span></span>

  - <span data-ttu-id="847ef-172">Fälten för serverns tidsstämpel måste också klara vissa kontroller.</span><span class="sxs-lookup"><span data-stu-id="847ef-172">The Server time stamp fields must also pass specific checks.</span></span> <span data-ttu-id="847ef-173">För unicast-servern måste alla tids fält fyllas i och får inte vara NULL.</span><span class="sxs-lookup"><span data-stu-id="847ef-173">For the unicast Server, all time fields must be filled in and cannot be NULL.</span></span> <span data-ttu-id="847ef-174">Tidsstämpeln för ursprunget måste vara lika med tids stämplingen för överföring i klientens begäran om SNTP-tidsmeddelande.</span><span class="sxs-lookup"><span data-stu-id="847ef-174">The Origination time stamp must equal the Transmit time stamp in the Client’s SNTP time message request.</span></span> <span data-ttu-id="847ef-175">Detta skyddar klienten från skadlig inkräktare och Server beteende för falsk Server.</span><span class="sxs-lookup"><span data-stu-id="847ef-175">This protects the Client from malicious intruders and rogue Server behavior.</span></span> <span data-ttu-id="847ef-176">Sändnings servern behöver bara fylla i tids stämplingen för överföring.</span><span class="sxs-lookup"><span data-stu-id="847ef-176">The broadcast Server need only fill in the Transmit time stamp.</span></span> <span data-ttu-id="847ef-177">Eftersom det inte tar emot något från klienten har det inte några fält för mottagning eller ursprung att fylla i.</span><span class="sxs-lookup"><span data-stu-id="847ef-177">Since it does not receive anything from the Client it has no Receive or Origination fields to fill in.</span></span>

    <span data-ttu-id="847ef-178">En misslyckad Sanity-kontroll varumärken som en tids uppdatering som en ogiltig tids uppdatering.</span><span class="sxs-lookup"><span data-stu-id="847ef-178">A failed sanity check brands a time update as an invalid time update.</span></span> <span data-ttu-id="847ef-179">SNTP-klienten Sanity check service spårar antalet ogiltiga tids uppdateringar som tagits emot från samma server i följd.</span><span class="sxs-lookup"><span data-stu-id="847ef-179">The SNTP Client sanity check service tracks the number of consecutive invalid time updates received from the same Server.</span></span>

<span data-ttu-id="847ef-180">När en klient tråds uppgift i SNTP kontrollerar giltigheten för ett SNTP-paket för att tillämpa den lokala SNTP-klientens tid, ökar antalet SNTP-klienter som `nx_sntp_client_invalid_time_updates.` också returnerar en fel status till anroparen, men detta är all intern bearbetning så att den inte visas direkt för programmet.</span><span class="sxs-lookup"><span data-stu-id="847ef-180">When SNTP Client thread task checks the validity of an SNTP packet for applying to the local SNTP Client time, it increments the count of the SNTP Client `nx_sntp_client_invalid_time_updates.` It also returns an error status to the caller but this is all internal processing so it is not immediately visible to the application.</span></span> <span data-ttu-id="847ef-181">Sättet att identifiera uppdateringar av misslyckade tider är att fråga värdet för SNTP-klienten efter att du har `nx_sntp_client_invalid_time_updates` tagit emot uppdateringar av SNTP-serverns tid.</span><span class="sxs-lookup"><span data-stu-id="847ef-181">The way to detect failed time updates is to query the value of the SNTP Client `nx_sntp_client_invalid_time_updates` after receiving SNTP Server time updates.</span></span>

<span data-ttu-id="847ef-182">Om uppdateringen av Server tiden passerar Sanity-kontrollerna försöker klienten att bearbeta tids data till den lokala tiden.</span><span class="sxs-lookup"><span data-stu-id="847ef-182">If the Server time update passes the sanity checks, the Client then attempts to process the time data to its local time.</span></span> <span data-ttu-id="847ef-183">Om klienten har kon figurer ATS för beräkning av rund resan, t. ex. När en uppdaterings förfrågan skickas till den tid som tas emot, beräknas tiden för fördröjningen.</span><span class="sxs-lookup"><span data-stu-id="847ef-183">If the Client is configured for round trip calculation, e.g. the time from sending an update request to the time one is received, the round trip time is calculated.</span></span> <span data-ttu-id="847ef-184">Värdet är halvt och läggs sedan till serverns tid.</span><span class="sxs-lookup"><span data-stu-id="847ef-184">This value is halved and then added to the Server’s time.</span></span>

<span data-ttu-id="847ef-185">Om det här är den första uppdateringen som tas emot från den aktuella SNTP-servern, fastställer SNTP-klienten om den ska ignorera skillnaden mellan servern och lokal klient tid.</span><span class="sxs-lookup"><span data-stu-id="847ef-185">Next, if this is the first update received from the current SNTP Server, the SNTP Client determines if it should ignore the difference between the Server and Client local time.</span></span> <span data-ttu-id="847ef-186">Därefter utvärderas alla uppdateringar från SNTP-servern för skillnaden med lokal klient tid.</span><span class="sxs-lookup"><span data-stu-id="847ef-186">Thereafter all updates from the SNTP Server are evaluated for the difference with the Client local time.</span></span>

<span data-ttu-id="847ef-187">Skillnaden mellan klient-och server tid jämförs med `NX_SNTP_CLIENT_MAX_TIME_ADJUSTMENT` .</span><span class="sxs-lookup"><span data-stu-id="847ef-187">The difference between Client and Server time is compared with `NX_SNTP_CLIENT_MAX_TIME_ADJUSTMENT`.</span></span> <span data-ttu-id="847ef-188">Om det överskrider det här värdet utlöstes data. Om skillnaden är mindre än `NX_SNTP_CLIENT_MIN_TIME_ADJUSTMENT` skillnaden betraktas den som för liten för att kräva justering.</span><span class="sxs-lookup"><span data-stu-id="847ef-188">If it exceeds this value, the data is thrown out. If the difference is less than the `NX_SNTP_CLIENT_MIN_TIME_ADJUSTMENT` the difference is considered too small to require adjustment.</span></span>

<span data-ttu-id="847ef-189">Om du skickar alla dessa kontroller används tid uppdateringen sedan på SNTP-klienten med vissa korrigeringar av fördröjningar i intern bearbetning av SNTP-klienter.</span><span class="sxs-lookup"><span data-stu-id="847ef-189">Passing all these checks, the time update is then applied to the SNTP Client with some corrections for delays in internal SNTP Client processing.</span></span>

### <a name="sntp-asynchronous-unicast-requests"></a><span data-ttu-id="847ef-190">Asynkrona unicast-begäranden i SNTP</span><span class="sxs-lookup"><span data-stu-id="847ef-190">SNTP Asynchronous Unicast Requests</span></span> 

<span data-ttu-id="847ef-191">SNTP-klienten gör att värd programmet kan skicka en unicast-begäran asynkront för den aktuella tiden från NTP-servern.</span><span class="sxs-lookup"><span data-stu-id="847ef-191">The SNTP Client allows the host application to asynchronously send a unicast request for the current time from the NTP server.</span></span>

```C
UINT _nx_sntp_client_request_unicast_time(
NX_SNTP_CLIENT *client_ptr, 
UINT wait_option)
```

<span data-ttu-id="847ef-192">Alternativet vänte är förfallo datum för att vänta på ett svar.</span><span class="sxs-lookup"><span data-stu-id="847ef-192">The wait option is the expiration to wait for a response.</span></span>

<span data-ttu-id="847ef-193">Om NTP-servern svarar, omfattas paketet av samma bearbetnings-och Sanity-kontroller enligt beskrivningen i föregående avsnitt innan du uppdaterar lokal tid för SNTP-klienten.</span><span class="sxs-lookup"><span data-stu-id="847ef-193">If the NTP Server responds, the packet is subjected to the same processing and sanity checks as described in the previous section before updating the SNTP Client local time.</span></span>

<span data-ttu-id="847ef-194">Om anropet returnerar slutförd, kan programmet anropa *nx_sntp_client_utility_display_date_time* eller *nx_sntp_client_get_local_time_extended* för den uppdaterade lokala tiden.</span><span class="sxs-lookup"><span data-stu-id="847ef-194">If the call returns successful completion, the application can call *nx_sntp_client_utility_display_date_time* or *nx_sntp_client_get_local_time_extended* for the updated local time.</span></span>

<span data-ttu-id="847ef-195">Dessa unicast-begäranden påverkar inte det normala SNTP-klientcertifikatet för att skicka nästa unicast-begäran, eller i sändnings läge, när nästa NTP-sändning förväntas.</span><span class="sxs-lookup"><span data-stu-id="847ef-195">These unicast requests do not interfere with the normal SNTP Client schedule for sending the next unicast request, or if in broadcast mode, when to expect the next NTP broadcast.</span></span>

### <a name="periodic-local-time-updates"></a><span data-ttu-id="847ef-196">Regelbundna uppdateringar av lokal tid</span><span class="sxs-lookup"><span data-stu-id="847ef-196">Periodic Local Time Updates</span></span>

<span data-ttu-id="847ef-197">Den maximala justeringen av den lokala tiden anges i alternativet NX_SNTP_CLIENT_MAX_TIME_ADJUSTMENT (i millisekunder).</span><span class="sxs-lookup"><span data-stu-id="847ef-197">The maximum adjustment to the local time is set in the NX_SNTP_CLIENT_MAX_TIME_ADJUSTMENT option (in milliseconds).</span></span> <span data-ttu-id="847ef-198">Avsöknings uppdaterings intervallet för unicast SNTP klient åtgärder anges i alternativet NX_SNTP_CLIENT_UNICAST_POLL_INTERVAL (i sekunder).</span><span class="sxs-lookup"><span data-stu-id="847ef-198">The polling update interval for unicast SNTP Client operations is set in the NX_SNTP_CLIENT_UNICAST_POLL_INTERVAL option (in seconds).</span></span> <span data-ttu-id="847ef-199">Om avsöknings intervallet är större än den maximala justeringen avvisas efterföljande Server uppdateringar efter den första uppdateringen av servern.</span><span class="sxs-lookup"><span data-stu-id="847ef-199">If the polling interval is greater than the maximum adjustment, then subsequent server updates after the first server update will be rejected.</span></span> <span data-ttu-id="847ef-200">För att förhindra detta uppdaterar SNTP-klienten den lokala tiden med jämna mellanrum definierad som NX_SNTP_UPDATE_TIMEOUT_INTERVAL.</span><span class="sxs-lookup"><span data-stu-id="847ef-200">To prevent this, the SNTP Client will update the local time periodically defined as NX_SNTP_UPDATE_TIMEOUT_INTERVAL.</span></span> 

<span data-ttu-id="847ef-201">Om det finns en skillnad i tiden mellan on-tavlan och Server tiden (vilken SNTP-klientens lokala tid ska vara inställd på), ska den synkroniseras till SNTP-klientens tid (vi visar inte det i den här användar handboken).</span><span class="sxs-lookup"><span data-stu-id="847ef-201">If there is a difference in time between the on board RTC and the server time (which the SNTP Client local time should be set to), the RTC should be synched to the SNTP Client time (we do not demonstrate that in this User Guide).</span></span>

<span data-ttu-id="847ef-202">Eftersom uppdatering av SNTP-server inte ska ske oftare än en gång per timme, är det inte praktiskt att avsöka SNTP-klienten för Server uppdateringar eller Server status oftare än.</span><span class="sxs-lookup"><span data-stu-id="847ef-202">Since SNTP server updates should not occur more often than once per hour, it is not useful to poll the SNTP Client for server updates or server status more often than that.</span></span> <span data-ttu-id="847ef-203">SNTP-klienten bör dock uppdatera sin lokala klocka ofta så att den inte längre överskrider den maximala tids justerings parametern NX_SNTP_CLIENT_MAX_TIME_LAPSE.</span><span class="sxs-lookup"><span data-stu-id="847ef-203">However, the SNTP Client should update its local clock often enough not to fall further than the maximum time adjustment parameter NX_SNTP_CLIENT_MAX_TIME_LAPSE.</span></span>

<span data-ttu-id="847ef-204">Alternativt kan den maximala justerings NX_SNTP_CLIENT_MAX_TIME_LAPSE ställas in på fler än unicast-avsöknings uppdateringen (eller förväntade broadcast-intervall).</span><span class="sxs-lookup"><span data-stu-id="847ef-204">Alternatively, the maximum adjustment NX_SNTP_CLIENT_MAX_TIME_LAPSE can be set to greater than the unicast polling update (or anticipated broadcast intervals).</span></span> <span data-ttu-id="847ef-205">Detta eliminerar behovet av en oberoende real tids klocka.</span><span class="sxs-lookup"><span data-stu-id="847ef-205">The latter eliminates the need for an independent real time clock.</span></span> <span data-ttu-id="847ef-206">Avsikten med SNTP-protokollet är dock att undvika det totala beroendet av antingen lokal uppdatering eller uppdateringar av nätverks tid.</span><span class="sxs-lookup"><span data-stu-id="847ef-206">However, the intention of SNTP protocol is to avoid total reliance on either local RTC or network time updates.</span></span> <span data-ttu-id="847ef-207">Vidare är uppdatering av SNTP-servern avsedd för att förhindra drift i den lokala tids klockan.</span><span class="sxs-lookup"><span data-stu-id="847ef-207">Further, the SNTP Server updates are intended to prevent drift in the local time clock.</span></span>

## <a name="multiple-network-interfaces"></a><span data-ttu-id="847ef-208">Flera nätverks gränssnitt</span><span class="sxs-lookup"><span data-stu-id="847ef-208">Multiple Network Interfaces</span></span>

<span data-ttu-id="847ef-209">NetX Duo SNTP-klienten kan konfigureras att köras på sekundära nätverk så länge som dessa nätverk är registrerade med IP-instansen.</span><span class="sxs-lookup"><span data-stu-id="847ef-209">NetX Duo SNTP Client can be configured to run on secondary networks as long as those networks are registered with the IP instance.</span></span> <span data-ttu-id="847ef-210">Mer information om hur du registrerar sekundära nätverk finns i användar handboken för NetX Duo eller NetX.</span><span class="sxs-lookup"><span data-stu-id="847ef-210">See the NetX Duo or NetX User Guide for more information on how to register secondary networks.</span></span>

<span data-ttu-id="847ef-211">I *nx_sntp_client_create* -anropet ställer du in den tredje ingången iface_index till indexet för det nätverk som SNTP-klienten ska ta emot tid uppdateringar på.</span><span class="sxs-lookup"><span data-stu-id="847ef-211">In the *nx_sntp_client_create* call, set the third input, iface_index, to the index of the network for the SNTP Client to receive time updates on.</span></span> <span data-ttu-id="847ef-212">Det primära gränssnittet är alltid vid index 0.</span><span class="sxs-lookup"><span data-stu-id="847ef-212">The primary interface is always at index 0.</span></span> <span data-ttu-id="847ef-213">NetX Duo SNTP-klienten har inte stöd för tids uppdateringar samtidigt på flera nätverks gränssnitt.</span><span class="sxs-lookup"><span data-stu-id="847ef-213">NetX Duo SNTP Client cannot support time updates simultaneously on multiple network interface.</span></span>

## <a name="sntp-and-ntp-rfcs"></a><span data-ttu-id="847ef-214">SNTP-och NTP-rapporter</span><span class="sxs-lookup"><span data-stu-id="847ef-214">SNTP and NTP RFCs</span></span>

<span data-ttu-id="847ef-215">NetX Duo SNTP-klienten är kompatibel med RFC4330 "Simple Network Time Protocol (SNTP) version 4 för IPv4, IPv6 och OSI och relaterade RFC: er.</span><span class="sxs-lookup"><span data-stu-id="847ef-215">NetX Duo SNTP client is compliant with RFC4330 “Simple Network Time Protocol (SNTP) Version 4 for IPv4, IPv6 and OSI” and related RFCs.</span></span>