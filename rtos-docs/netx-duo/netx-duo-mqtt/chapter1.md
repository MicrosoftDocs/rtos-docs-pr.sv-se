---
title: Kapitel 1 – Introduktion till Azure återställnings tider NetX Duo MQTT
description: Klient paketet NetX Duo MQTT kräver att NetX Duo (version 5,10 eller senare) installeras, är korrekt konfigurerat och att IP-instansen har skapats.
author: philmea
ms.author: philmea
ms.date: 05/19/2020
ms.topic: article
ms.service: rtos
ms.openlocfilehash: 2e13b997f987e2fd82569bcb1904218908313d70
ms.sourcegitcommit: e3d42e1f2920ec9cb002634b542bc20754f9544e
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 03/22/2021
ms.locfileid: "104825911"
---
# <a name="chapter-1---introduction-to-azure-rtos-netx-duo-mqtt"></a><span data-ttu-id="ca237-103">Kapitel 1 – Introduktion till Azure återställnings tider NetX Duo MQTT</span><span class="sxs-lookup"><span data-stu-id="ca237-103">Chapter 1 - Introduction to Azure RTOS NetX Duo MQTT</span></span>

## <a name="netx-duo-mqtt-requirements"></a><span data-ttu-id="ca237-104">NetX Duo MQTT-krav</span><span class="sxs-lookup"><span data-stu-id="ca237-104">NetX Duo MQTT Requirements</span></span>

<span data-ttu-id="ca237-105">Azure återställnings tider NetX Duo MQTT client-paketet kräver att NetX Duo (version 5,10 eller senare) installeras, är korrekt konfigurerat och att IP-instansen har skapats.</span><span class="sxs-lookup"><span data-stu-id="ca237-105">The Azure RTOS NetX Duo MQTT client package requires that NetX Duo (version 5.10 or later) be installed, properly configured, and the IP instance has been created.</span></span> <span data-ttu-id="ca237-106">TCP-modulen måste vara aktive rad i systemet.</span><span class="sxs-lookup"><span data-stu-id="ca237-106">The TCP module must be enabled in the system.</span></span> <span data-ttu-id="ca237-107">Om TLS-säkerhet krävs måste dessutom NetX Secure TLS-modulen konfigureras enligt den säkerhets parameter som krävs av Service Broker.</span><span class="sxs-lookup"><span data-stu-id="ca237-107">In addition, if TLS security is required, the NetX Secure TLS module needs to be configured according to the security parameter required by the broker.</span></span>

## <a name="netx-duo-mqtt-specification"></a><span data-ttu-id="ca237-108">NetX Duo MQTT-specifikation</span><span class="sxs-lookup"><span data-stu-id="ca237-108">NetX Duo MQTT Specification</span></span>

<span data-ttu-id="ca237-109">NetX Duo MQTT client IMPLEMENT är kompatibel med OASIS MQTT version 3.1.1, oktober<sup>2014.</sup></span><span class="sxs-lookup"><span data-stu-id="ca237-109">NetX Duo MQTT client implement is compliant with OASIS MQTT Version 3.1.1 Oct 29<sup>th</sup> 2014.</span></span> <span data-ttu-id="ca237-110">Du hittar specifikationen på:</span><span class="sxs-lookup"><span data-stu-id="ca237-110">The specification can be found at:</span></span>

- [http://mqtt.org/](http://mqtt.org/)

## <a name="netx-duo-mqtt-basic-operation"></a><span data-ttu-id="ca237-111">NetX Duo MQTT Basic-åtgärd</span><span class="sxs-lookup"><span data-stu-id="ca237-111">NetX Duo MQTT Basic Operation</span></span>

<span data-ttu-id="ca237-112">MQTT (Message Queue-transport för telemetri) baseras på utgivarens prenumerations modell.</span><span class="sxs-lookup"><span data-stu-id="ca237-112">MQTT (Message Queue Telemetry Transport) is based on publisher-subscriber model.</span></span> <span data-ttu-id="ca237-113">En klient kan publicera information till andra klienter via en Broker.</span><span class="sxs-lookup"><span data-stu-id="ca237-113">A client can publish information to other clients through a broker.</span></span> <span data-ttu-id="ca237-114">En klient, om det är intresse rad av ett ämne, kan prenumerera på avsnittet via koordinatorn.</span><span class="sxs-lookup"><span data-stu-id="ca237-114">A client, if interested in a topic, can subscribe to the topic through the broker.</span></span> <span data-ttu-id="ca237-115">En Service Broker ansvarar för att leverera publicerade meddelanden till sina klienter som prenumererar på ämnet.</span><span class="sxs-lookup"><span data-stu-id="ca237-115">A broker is responsible for delivering published messages to its clients who subscribe to the topic.</span></span> <span data-ttu-id="ca237-116">I den här utgivarens prenumerations modell kan flera klienter publicera data med samma ämne.</span><span class="sxs-lookup"><span data-stu-id="ca237-116">In this publisher-subscriber model, multiple clients may publish data with the same topic.</span></span> <span data-ttu-id="ca237-117">En klient får ett meddelande som publiceras om klienten prenumererar på samma ämne.</span><span class="sxs-lookup"><span data-stu-id="ca237-117">A client will receive a message it publishes if the client subscribes to the same topic.</span></span>

<span data-ttu-id="ca237-118">Beroende på användnings fallet kan en klient välja en av de tre QoS-nivåerna vid publicering av ett meddelande:</span><span class="sxs-lookup"><span data-stu-id="ca237-118">Depending on the use case, a client may choose one of the 3 QoS levels when publishing a message:</span></span>

- <span data-ttu-id="ca237-119">**QoS 0**: meddelandet levereras högst en gång.</span><span class="sxs-lookup"><span data-stu-id="ca237-119">**QoS 0**: The message is delivered at most once.</span></span> <span data-ttu-id="ca237-120">Meddelanden som skickas med QoS 0 kan gå förlorade.</span><span class="sxs-lookup"><span data-stu-id="ca237-120">Messages sent with QoS 0 may be lost.</span></span>
- <span data-ttu-id="ca237-121">**QoS 1**: meddelandet levereras minst en gång.</span><span class="sxs-lookup"><span data-stu-id="ca237-121">**QoS 1**: The message is delivered at least once.</span></span> <span data-ttu-id="ca237-122">Meddelanden som skickas med QoS 1 kan levereras mer än en gång.</span><span class="sxs-lookup"><span data-stu-id="ca237-122">Messages sent with QoS 1 may be delivered more than once.</span></span>
- <span data-ttu-id="ca237-123">**QoS 2**: meddelandet levereras exakt en gång.</span><span class="sxs-lookup"><span data-stu-id="ca237-123">**QoS 2**: The message is delivered exactly once.</span></span> <span data-ttu-id="ca237-124">Meddelanden som skickas med QoS 2 garanteras att levereras, utan duplicering.</span><span class="sxs-lookup"><span data-stu-id="ca237-124">Messages sent with QoS 2 is guaranteed to be delivered, with no duplication.</span></span>

> [!NOTE]
> <span data-ttu-id="ca237-125">Den här implementeringen av MQTT-klienten har inte stöd för meddelanden på QoS-nivå 2.</span><span class="sxs-lookup"><span data-stu-id="ca237-125">This implementation of MQTT client does not support QoS level 2 messages.</span></span>

<span data-ttu-id="ca237-126">Eftersom QoS 1 och QoS 2 är garanterat att levereras, håller Service Broker reda på status för QoS 1-och QoS 2-meddelanden som skickas till varje klient.</span><span class="sxs-lookup"><span data-stu-id="ca237-126">Since QoS 1 and QoS 2 are guaranteed to be delivered, the broker keeps track the state of QoS 1 and QoS 2 messages sent to each client.</span></span> <span data-ttu-id="ca237-127">Detta är särskilt viktigt för klienter som förväntar sig QoS1 eller QoS 2-meddelanden.</span><span class="sxs-lookup"><span data-stu-id="ca237-127">This is particularly important for clients that expect QoS1 or QoS 2 messages.</span></span> <span data-ttu-id="ca237-128">Klienten kan vara frånkopplad från koordinatorn (till exempel när klienten startas om eller om kommunikations länken är tillfälligt förlorad).</span><span class="sxs-lookup"><span data-stu-id="ca237-128">The client may be disconnected from the broker (for example when the client reboots, or the communication link is temporarily lost).</span></span> <span data-ttu-id="ca237-129">Service Broker måste lagra QoS 1-och QoS 2-meddelanden så att meddelandena kan levereras senare när klienten återansluts till Broker.</span><span class="sxs-lookup"><span data-stu-id="ca237-129">The broker must store QoS 1 and QoS 2 messages so the messages can be delivered later once the client is reconnected to the broker.</span></span> <span data-ttu-id="ca237-130">Klienten kan dock välja att inte ta emot inaktuella meddelanden från koordinatorn efter åter anslutning.</span><span class="sxs-lookup"><span data-stu-id="ca237-130">However, the client may choose not to receive any stale messages from the broker after reconnection.</span></span> <span data-ttu-id="ca237-131">Klienten kan göra detta genom att initiera anslutningen med flaggan *clean_session* inställd på \***NX_TRUE** _.</span><span class="sxs-lookup"><span data-stu-id="ca237-131">The client can do so by initiating the connection with the *clean_session* flag set to \***NX_TRUE** _.</span></span> <span data-ttu-id="ca237-132">I det här fallet, vid mottagandet av MQTT CONNECT-meddelandet, ignoreras all sessionsinformation som är associerad med den här klienten, inklusive levererade eller obekräftade QoS 1-eller QoS 2-meddelanden.</span><span class="sxs-lookup"><span data-stu-id="ca237-132">In this case, upon receiving the MQTT CONNECT message, the broker shall discard any session information associated with this client, including undelivered or unconfirmed QoS 1 or QoS 2 messages.</span></span> <span data-ttu-id="ca237-133">Om _clean_session \*-flaggan är till \***NX_FALSE**_, ska servern skicka om QoS 1-och QoS 2-meddelanden.</span><span class="sxs-lookup"><span data-stu-id="ca237-133">If the _clean_session\* flag is to \***NX_FALSE**_, the server shall resend the QoS 1 and QoS 2 messages.</span></span> <span data-ttu-id="ca237-134">MQTT-klienten skickar också alla meddelanden som inte har godkänts om _clean_session \* är inställt på \*\**NX_TRUE *.**</span><span class="sxs-lookup"><span data-stu-id="ca237-134">The MQTT Client also resends any un-acknowledged messages if _clean_session\* is set to \***NX_TRUE\*.**</span></span> <span data-ttu-id="ca237-135">Den här bekräftelsen skiljer sig från TCP-lagrets ACK, även om det även sker.</span><span class="sxs-lookup"><span data-stu-id="ca237-135">This acknowledgment is different from the TCP layer ACK, although that happens as well.</span></span> <span data-ttu-id="ca237-136">MQTT-klienten skickar en bekräftelse till Broker.</span><span class="sxs-lookup"><span data-stu-id="ca237-136">The MQTT client sends an acknowledgment to the broker.</span></span>

<span data-ttu-id="ca237-137">Ett program skapar en MQTT-klient instans genom att anropa \***nxd_mqtt_client_create ()** _.</span><span class="sxs-lookup"><span data-stu-id="ca237-137">An application creates an MQTT client instance by calling \***nxd_mqtt_client_create()** _.</span></span> <span data-ttu-id="ca237-138">När klienten har skapats kan programmet ansluta till Service Broker genom att anropa _*_nxd_mqtt_client_connect ()_*_.</span><span class="sxs-lookup"><span data-stu-id="ca237-138">Once the client is created, the application can connect to the broker by calling _*_nxd_mqtt_client_connect()_*_.</span></span> <span data-ttu-id="ca237-139">Efter att ha anslutit till Broker kan klienten prenumerera på ett ämne genom att anropa _*_nxd_mqtt_client_subscribe ()_*_ eller publicera ett ämne genom att anropa _ *_nxd_mqtt_client_publish ()_* \*.</span><span class="sxs-lookup"><span data-stu-id="ca237-139">After connecting to the broker, the client can subscribe to a topic by calling _*_nxd_mqtt_client_subscribe()_*_, or publish a topic by calling _\*_nxd_mqtt_client_publish()_\*\*.</span></span>

<span data-ttu-id="ca237-140">Inkommande MQTT-meddelanden lagras i Receive-kön i MQTT-klient instansen.</span><span class="sxs-lookup"><span data-stu-id="ca237-140">Incoming MQTT messages are stored in the receive queue in the MQTT client instance.</span></span> <span data-ttu-id="ca237-141">Programmet hämtar detta meddelande genom att anropa ***nxd_mqtt_client_message_get ()***.</span><span class="sxs-lookup"><span data-stu-id="ca237-141">Application retrieves these message by calling ***nxd_mqtt_client_message_get()***.</span></span> <span data-ttu-id="ca237-142">Om det finns meddelanden i mottagnings kön, returneras det första meddelandet (t. ex. äldsta) från kön till anroparen.</span><span class="sxs-lookup"><span data-stu-id="ca237-142">If there are messages in the receive queue, the first message (e.g. the oldest) from the queue is returned to the caller.</span></span> <span data-ttu-id="ca237-143">Avsnitts strängen från meddelandet returneras också.</span><span class="sxs-lookup"><span data-stu-id="ca237-143">The topic string from the message is also returned.</span></span>

> [!NOTE]
> <span data-ttu-id="ca237-144">Funktionen \***nxd_mqtt_client_message_get ()** _ blockeras inte om MQTT-klientens mottagande kö är tom.</span><span class="sxs-lookup"><span data-stu-id="ca237-144">The function \***nxd_mqtt_client_message_get()** _ does not block if the MQTT client receive queue is empty.</span></span> <span data-ttu-id="ca237-145">Funktionen returnerar omedelbart med retur koden _ *_NXD_MQTT_NO_MESSAGE_* \*.</span><span class="sxs-lookup"><span data-stu-id="ca237-145">The function returns immediately with the return code _\*_NXD_MQTT_NO_MESSAGE_\*\*.</span></span> <span data-ttu-id="ca237-146">Programmet ska behandla detta retur värde som en indikation på att mottagnings kön är tom, inte ett fel.</span><span class="sxs-lookup"><span data-stu-id="ca237-146">The application shall treat this return value as an indication that the receive queue is empty, not an error.</span></span>

<span data-ttu-id="ca237-147">För att undvika att avsöka mottagnings kön för inkommande meddelanden kan programmet registrera en callback-funktion med MQTT-klienten genom att anropa ***nxd_mqtt_client_recieve_notify_set ()***.</span><span class="sxs-lookup"><span data-stu-id="ca237-147">To avoid polling the receive queue for incoming messages, the application can register a callback function with the MQTT client by calling ***nxd_mqtt_client_recieve_notify_set()***.</span></span> <span data-ttu-id="ca237-148">Callback-funktionen deklareras som:</span><span class="sxs-lookup"><span data-stu-id="ca237-148">The callback function is declared as:</span></span>

```c
VOID (*receive_notify_callback)(NXD_MQTT_CLIENT *client_ptr, 
    UINT message_count);
```

<span data-ttu-id="ca237-149">När MQTT-klienten tar emot meddelanden från Broker anropas funktionen motringning om funktionen har angetts.</span><span class="sxs-lookup"><span data-stu-id="ca237-149">As the MQTT client receives messages from the broker, it invokes the callback function if the function is set.</span></span> <span data-ttu-id="ca237-150">Funktionen motringning skickar pekaren till klient kontroll blocket och ett antal meddelande värden.</span><span class="sxs-lookup"><span data-stu-id="ca237-150">The callback function passes the pointer to the client control block and a message count value.</span></span> <span data-ttu-id="ca237-151">Värdet för antal meddelanden anger antalet MQTT-meddelanden i mottagnings kön.</span><span class="sxs-lookup"><span data-stu-id="ca237-151">The message count value indicates the number of MQTT messages in the receive queue.</span></span> <span data-ttu-id="ca237-152">Observera att den här funktionen för motringning körs i MQTT klient tråd kontext.</span><span class="sxs-lookup"><span data-stu-id="ca237-152">Note that this callback function executes in the MQTT client thread context.</span></span> <span data-ttu-id="ca237-153">Därför bör callback-funktionen inte köra några procedurer som kan blockera MQTT-klient tråden.</span><span class="sxs-lookup"><span data-stu-id="ca237-153">Therefore, the callback function should not execute any procedures that may block the MQTT client thread.</span></span> <span data-ttu-id="ca237-154">Motringningsfunktionen ska utlösa program tråden för anrop ***nxd_mqtt_client_message_get ()*** för att hämta meddelandena.</span><span class="sxs-lookup"><span data-stu-id="ca237-154">The callback function should trigger the application thread to call ***nxd_mqtt_client_message_get()*** to retrieve the messages.</span></span>

<span data-ttu-id="ca237-155">För att koppla från och avsluta MQTT-klient tjänsten, måste programmet använda tjänsten ***nxd_mqtt_client_disconnect ()** _ och _*_nxd_mqtt_client_delete ()._\*_</span><span class="sxs-lookup"><span data-stu-id="ca237-155">To disconnect and terminate the MQTT client service, the application shall use the service ***nxd_mqtt_client_disconnect()** _ and _*_nxd_mqtt_client_delete()._\*_</span></span> <span data-ttu-id="ca237-156">Anrop av _*_nxd_mqtt_client_disconnect ()_*_ kopplar bara från TCP-anslutningen till Broker.</span><span class="sxs-lookup"><span data-stu-id="ca237-156">Calling _*_nxd_mqtt_client_disconnect()_*_ simply disconnects the TCP connection to the broker.</span></span> <span data-ttu-id="ca237-157">Den frigör meddelanden som redan har tagits emot och lagrats i mottagnings kön.</span><span class="sxs-lookup"><span data-stu-id="ca237-157">It releases messages already received and stored in the receive queue.</span></span> <span data-ttu-id="ca237-158">Den släpper dock inte QoS-nivå 1-meddelanden i överförings kön.</span><span class="sxs-lookup"><span data-stu-id="ca237-158">However, it does not release QoS level 1 messages in the transmit queue.</span></span> <span data-ttu-id="ca237-159">Meddelanden på QoS-nivå 1 överförs vid anslutning, förutsatt att flaggan _*_clean_session_*_ har angetts till _ *_NX_FALSE._*\*</span><span class="sxs-lookup"><span data-stu-id="ca237-159">QoS level 1 messages are retransmitted upon connection, assuming the _*_clean_session_*_ flag is set to _ *_NX_FALSE._*\*</span></span>

<span data-ttu-id="ca237-160">Service Broker kan också koppla från klienten.</span><span class="sxs-lookup"><span data-stu-id="ca237-160">The broker may also disconnect from the client.</span></span> <span data-ttu-id="ca237-161">När TCP-anslutningen mellan klienten och utjämningen avbryts, kan programmet meddelas av funktionen från kopplings meddelande.</span><span class="sxs-lookup"><span data-stu-id="ca237-161">When the TCP connection between the client and the broker is terminated, the application can be notified by the disconnect notify function.</span></span> <span data-ttu-id="ca237-162">Om du vill använda meddelande mekanismen installerar programmet funktionen för att koppla från meddelande genom att anropa \*\**nxd_mqtt_client_disconnect_notify_set *.**</span><span class="sxs-lookup"><span data-stu-id="ca237-162">To use the notification mechanism, application installs the disconnect notify function by calling \***nxd_mqtt_client_disconnect_notify_set\*.**</span></span> <span data-ttu-id="ca237-163">När en TCP-från koppling observeras och MQTT-sessionen har skapats, anropas Notification-funktionen.</span><span class="sxs-lookup"><span data-stu-id="ca237-163">Once a TCP disconnect is observed and the MQTT session has been created, the notification function is invoked.</span></span>

<span data-ttu-id="ca237-164">Anrop av ***nxd_mqtt_client_delete ()*** släpper alla meddelande block i överförings kön och mottagnings kön.</span><span class="sxs-lookup"><span data-stu-id="ca237-164">Calling ***nxd_mqtt_client_delete()*** releases all message blocks in the transmit queue and the receive queue.</span></span> <span data-ttu-id="ca237-165">Ej godkända QoS-nivå 1-meddelanden tas också bort.</span><span class="sxs-lookup"><span data-stu-id="ca237-165">Unacknowledged QoS level 1 messages are also deleted.</span></span>

## <a name="secure-mqtt-connection"></a><span data-ttu-id="ca237-166">Säker MQTT-anslutning</span><span class="sxs-lookup"><span data-stu-id="ca237-166">Secure MQTT Connection</span></span>

<span data-ttu-id="ca237-167">MQTT-klienten skapar en säker anslutning till Broker med hjälp av NetX Secure TLS-modulen.</span><span class="sxs-lookup"><span data-stu-id="ca237-167">The MQTT client makes a secure connection to the broker using the NetX Secure TLS module.</span></span> <span data-ttu-id="ca237-168">Standard port numret för MQTT med TLS-säkerhet är 8883, definierat i ***NXD_MQTT_TLS_PORT***.</span><span class="sxs-lookup"><span data-stu-id="ca237-168">The default port number for MQTT with TLS security is 8883, defined in ***NXD_MQTT_TLS_PORT***.</span></span>

<span data-ttu-id="ca237-169">För att skapa en säker MQTT-anslutning till Broker måste en TLS-session förhandlas efter att en TCP-anslutning har upprättats, innan MQTT CONNECT-meddelanden kan skickas till Broker.</span><span class="sxs-lookup"><span data-stu-id="ca237-169">To create a secure MQTT connection to the broker, a TLS session needs to be negotiated after a TCP connection is established, before MQTT CONNECT messages can be sent to the broker.</span></span> <span data-ttu-id="ca237-170">TLS-sessionen har kon figurer ATS genom att anropa ***nxd_mqtt_client_secure_connect ()*** och skicka en användardefinierad funktion för MOTRINGNING av TLS-installation.</span><span class="sxs-lookup"><span data-stu-id="ca237-170">The TLS session set up is accomplished by calling ***nxd_mqtt_client_secure_connect()*** and passing in a user-defined TLS setup callback function.</span></span> <span data-ttu-id="ca237-171">När TCP-anslutningen har upprättats anropar klienten den TLS-MQTT som krävs för att starta en fungerande TLS-handskaknings process.</span><span class="sxs-lookup"><span data-stu-id="ca237-171">During the MQTT connection phase, once the TCP connection is established, the client invokes the TLS setup callback function to start a proper TLS handshake process.</span></span> <span data-ttu-id="ca237-172">När TLS-sessionen har upprättats fortsätter klienten MQTT CONNECT-meddelandet över den säkra kanalen.</span><span class="sxs-lookup"><span data-stu-id="ca237-172">After the TLS session is established, the client continues the MQTT CONNECT message over the secure channel.</span></span>

<span data-ttu-id="ca237-173">Den användardefinierade motringningsfunktionen tar fem indatavärden och deklareras som:</span><span class="sxs-lookup"><span data-stu-id="ca237-173">The user defined callback function takes five input values and is declared as:</span></span>

```c
UINT tls_Setup_callback(NXD_MQTT_CLIENT *client_ptr,
    NX_SECURE_TLS_SESSION *session_ptr,
    NX_SECURE_TLS_CERTIFICATE *certificate_ptr,
    NX_SECURE_TLS_CERTIFICATE *trusted_cerfiticate);
```

<span data-ttu-id="ca237-174">Nedan visas en beskrivning av indataparametrarna:</span><span class="sxs-lookup"><span data-stu-id="ca237-174">Below is a description of the input parameters:</span></span>

- <span data-ttu-id="ca237-175">**client_ptr**: pekar på klient kontroll blocket MQTT.</span><span class="sxs-lookup"><span data-stu-id="ca237-175">**client_ptr**: Pointer to the MQTT client control block.</span></span>
- <span data-ttu-id="ca237-176">**session_ptr**: pekar mot kontroll block för TLS-session.</span><span class="sxs-lookup"><span data-stu-id="ca237-176">**session_ptr**: Pointer to the TLS session control block.</span></span>
- <span data-ttu-id="ca237-177">**certificate_ptr**: pekar mot certifikat kontroll blocket.</span><span class="sxs-lookup"><span data-stu-id="ca237-177">**certificate_ptr**: Pointer to the certificate control block.</span></span> <span data-ttu-id="ca237-178">Installations funktionen konfigurerar det här certifikatet innan det skickas till Broker.</span><span class="sxs-lookup"><span data-stu-id="ca237-178">The setup function configures this certificate before sending it to the broker.</span></span>
- <span data-ttu-id="ca237-179">**trusted_certificate_ptr**: pekar på det betrodda certifikatet.</span><span class="sxs-lookup"><span data-stu-id="ca237-179">**trusted_certificate_ptr**: Pointer to the trusted certificate.</span></span> <span data-ttu-id="ca237-180">Funktionen TLS-installation konfigurerar det betrodda certifikatet för att autentisera servern.</span><span class="sxs-lookup"><span data-stu-id="ca237-180">TLS setup function configures the trusted certificate to authenticate the server.</span></span>

<span data-ttu-id="ca237-181">I funktionen TLS-installation ansvarar programmet för att skapa en TLS-session och konfigurera sessionen med ett korrekt certifikat.</span><span class="sxs-lookup"><span data-stu-id="ca237-181">In the TLS setup function, the application is responsible for creating a TLS session, and configuring the session with a proper certificate.</span></span> <span data-ttu-id="ca237-182">Följande pseudo-kod visar en typisk start procedur för TLS-sessioner.</span><span class="sxs-lookup"><span data-stu-id="ca237-182">The following pseudo code outlines a typical TLS session start up procedure.</span></span> <span data-ttu-id="ca237-183">Läsaren hänvisas till användar handboken för NetX Secure TLS för information om hur du använder TLS-API: er.</span><span class="sxs-lookup"><span data-stu-id="ca237-183">The reader is referred to the NetX Secure TLS User Guide for details on using TLS APIs.</span></span>

<span data-ttu-id="ca237-184">Nedan visas ett exempel på ett TLS-installations anrop:</span><span class="sxs-lookup"><span data-stu-id="ca237-184">Below is an example TLS setup callback:</span></span>

```c
UINT tls_setup_callback(NXD_MQTT_CLIENT *client_pt
    NX_SECURE_TLS_SESSION *session_ptr,
    NX_SECURE_TLS_CERTIFICATE *certrifcate_ptr,
    NX_SECURE_TLS_CERTIFICATE *trusted_certificate_ptr)
{
    /* Initialize TLS module */
    nx_secure_tls_initialize();

    /* Create a TLS session */
    nx_secure_tls_session_create(session_ptr, …);

    /* Need to allocate space for the certificate coming in from the broker. */
    memset(certificate_ptr), 0, sizeof(NX_SECURE_TLS_CERTIFICATE));

    nx_secure_tls_remote_certificate_allocate(session_ptr, certificate_ptr);

    /* Add a CA Certificate to our trusted store for verifying incomingserver certificates. */
    nx_secure_tls_certificate_initialize(
        trusted_certificate_ptr,
        ca_cert_der,
        ca_cert_der_len, NULL, 0);
    nx_secure_tls_trusted_certificate_add(session_ptr,
        trusted_certificate));
}
```

## <a name="known-limitations-of-the-netx-duo-mqtt-client"></a><span data-ttu-id="ca237-185">Kända begränsningar för NetX Duo MQTT-klienten</span><span class="sxs-lookup"><span data-stu-id="ca237-185">Known Limitations of the NetX Duo MQTT Client</span></span>

- <span data-ttu-id="ca237-186">NetX Duo-MQTT stöder inte sändning eller mottagning av QoS-nivå 2-meddelanden.</span><span class="sxs-lookup"><span data-stu-id="ca237-186">NetX Duo MQTT does not support sending or receiving QoS level 2 messages.</span></span>
- <span data-ttu-id="ca237-187">NetX Duo-MQTT har inte stöd för kedjade paket.</span><span class="sxs-lookup"><span data-stu-id="ca237-187">NetX Duo MQTT does not support chained-packets.</span></span>
