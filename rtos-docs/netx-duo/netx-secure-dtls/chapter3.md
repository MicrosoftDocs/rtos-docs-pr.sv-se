---
title: Kapitel 3 – funktionell beskrivning av Azure återställnings tider NetX Secure DTLS
description: Det här kapitlet innehåller en funktions Beskrivning av Azure återställnings tider NetX Secure DTLS.
author: philmea
ms.author: philmea
ms.date: 06/04/2020
ms.topic: article
ms.service: rtos
ms.openlocfilehash: 347bd83fa8c72ced2e8678a92ec5c5f8393c136d
ms.sourcegitcommit: 60ad844b58639d88830f2660ab0c4ff86b92c10f
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 04/07/2021
ms.locfileid: "106550209"
---
# <a name="chapter-3-functional-description-of-azure-rtos-netx-secure-dtls"></a><span data-ttu-id="e5298-103">Kapitel 3: funktionell beskrivning av Azure återställnings tider NetX Secure DTLS</span><span class="sxs-lookup"><span data-stu-id="e5298-103">Chapter 3: Functional description of Azure RTOS NetX Secure DTLS</span></span>

## <a name="execution-overview"></a><span data-ttu-id="e5298-104">Översikt över körning</span><span class="sxs-lookup"><span data-stu-id="e5298-104">Execution Overview</span></span>

<span data-ttu-id="e5298-105">Det här kapitlet innehåller en funktions Beskrivning av Azure återställnings tider NetX Secure DTLS.</span><span class="sxs-lookup"><span data-stu-id="e5298-105">This chapter contains a functional description of Azure RTOS NetX Secure DTLS.</span></span> <span data-ttu-id="e5298-106">Det finns två primära typer av program körning i ett NetX Secure DTLS-program: initierings-och program gränssnitts anrop.</span><span class="sxs-lookup"><span data-stu-id="e5298-106">There are two primary types of program execution in a NetX Secure DTLS application: initialization and application interface calls.</span></span> 

<span data-ttu-id="e5298-107">NetX Secure förutsätter att ThreadX och NetX/NetXDuo finns.</span><span class="sxs-lookup"><span data-stu-id="e5298-107">NetX Secure assumes the existence of ThreadX and NetX/NetXDuo.</span></span> <span data-ttu-id="e5298-108">Från ThreadX kräver det tråd körning, avstängning, periodiska timers och ömsesidiga undantags funktioner.</span><span class="sxs-lookup"><span data-stu-id="e5298-108">From ThreadX, it requires thread execution, suspension, periodic timers, and mutual exclusion facilities.</span></span> <span data-ttu-id="e5298-109">Från NetX/NetXDuo krävs det funktioner och driv rutiner för UDP och IP-nätverk.</span><span class="sxs-lookup"><span data-stu-id="e5298-109">From NetX/NetXDuo it requires the UDP and IP networking facilities and drivers.</span></span>

## <a name="datagram-transport-layer-security-dtls-and-transport-layer-security-tls"></a><span data-ttu-id="e5298-110">Datagram Transport Layer Security (DTLS) och Transport Layer Security (TLS)</span><span class="sxs-lookup"><span data-stu-id="e5298-110">Datagram Transport Layer Security (DTLS) and Transport Layer Security (TLS)</span></span>

<span data-ttu-id="e5298-111">NetX Secure DTLS implementerar Datagram Transport Layer Security protokoll version 1,2 som definieras i RFC 6347.</span><span class="sxs-lookup"><span data-stu-id="e5298-111">NetX Secure DTLS implements the Datagram Transport Layer Security protocol version 1.2 defined in RFC 6347.</span></span> <span data-ttu-id="e5298-112">DTLS version 1,0 har definierats i RFC 4347 och motsvarar TLS-version 1,1.</span><span class="sxs-lookup"><span data-stu-id="e5298-112">DTLS version 1.0 was defined in RFC 4347 and corresponded to TLS version 1.1.</span></span> <span data-ttu-id="e5298-113">På grund av att DTLS är i princip ett tillägg till TLS, bestämde vi att nästa version skulle använda samma versions nummer som motsvarande TLS-version.</span><span class="sxs-lookup"><span data-stu-id="e5298-113">Due to DTLS being essentially an extension to TLS, it was decided that the next version would use the same version number as the corresponding TLS version.</span></span> <span data-ttu-id="e5298-114">Det finns därför ingen DTLS version 1,1 eftersom DTLS version 1,2 motsvarar TLS-version 1,2.</span><span class="sxs-lookup"><span data-stu-id="e5298-114">Thus, there is no DTLS version 1.1 as DTLS version 1.2 corresponds to TLS version 1.2.</span></span>

> [!NOTE]
> <span data-ttu-id="e5298-115">NetX Secure stöder DTLS version 1,2.</span><span class="sxs-lookup"><span data-stu-id="e5298-115">NetX Secure supports DTLS version 1.2.</span></span> <span data-ttu-id="e5298-116">DTLS 1,0 (RFC 4347) stöds **inte** för närvarande.</span><span class="sxs-lookup"><span data-stu-id="e5298-116">DTLS 1.0 (RFC 4347) is **not** currently supported.</span></span>

<span data-ttu-id="e5298-117">*Secure Sockets Layer* (SSL) var det ursprungliga namnet på TLS innan det blev standard i RFC 2246 och "SSL" används ofta som ett generiskt namn för TLS-protokollen.</span><span class="sxs-lookup"><span data-stu-id="e5298-117">*Secure Sockets Layer* (SSL) was the original name of TLS before it became a standard in RFC 2246 and “SSL” is often used as a generic name for the TLS protocols.</span></span> <span data-ttu-id="e5298-118">Den senaste versionen av SSL var 3,0 och TLS 1,0 kallas ibland SSL version 3,1.</span><span class="sxs-lookup"><span data-stu-id="e5298-118">The last version of SSL was 3.0, and TLS 1.0 is sometimes referred to as SSL version 3.1.</span></span> <span data-ttu-id="e5298-119">Alla versioner av det officiella "SSL"-protokollet betraktas som föråldrade och oskyddade och för närvarande NetX Secure ger inte SSL-implementering.</span><span class="sxs-lookup"><span data-stu-id="e5298-119">All versions of the official “SSL” protocol are considered obsolete and insecure and currently NetX Secure does not provide an SSL implementation.</span></span>

<span data-ttu-id="e5298-120">TLS anger ett protokoll för att generera *sessionsnycklar* som skapas under TLS- *handskakningen* mellan en TLS-klient och-server och dessa nycklar används för att kryptera data som skickas av programmet under TLS- *sessionen.*</span><span class="sxs-lookup"><span data-stu-id="e5298-120">TLS specifies a protocol to generate *session keys* which are created during the TLS *handshake* between a TLS client and server and those keys are used to encrypt data sent by the application during the TLS *session.*</span></span>

<span data-ttu-id="e5298-121">DTLS är nära kopplad till TLS, eftersom de underliggande säkerhets mechansims delas mellan protokollen.</span><span class="sxs-lookup"><span data-stu-id="e5298-121">DTLS is closely coupled with TLS, as the underlying security mechansims are shared between the protocols.</span></span> <span data-ttu-id="e5298-122">TLS är dock utformat för att fungera över ett transport lager protokoll som ger garantier om paket leverans och ordning (nästan alltid TCP i praktiken) och kommer inte att fungera över ett opålitligt protokoll som UDP.</span><span class="sxs-lookup"><span data-stu-id="e5298-122">However, TLS is designed to work over a transport layer protocol that provides guarantees about packet delivery and order (almost always TCP in practice) and will not function over an unreliable protocol like UDP.</span></span> <span data-ttu-id="e5298-123">Det är precis på grund av UDP som DTLS introducerades: DTLS har utformats för att hantera den otillförlitliga typen av UDP och liknande protokoll.</span><span class="sxs-lookup"><span data-stu-id="e5298-123">It is precisely because of UDP that DTLS was introduced: DTLS was designed handle the unreliable nature of UDP and similar protocols.</span></span> <span data-ttu-id="e5298-124">Detta sker genom att du inkluderar ordnings-och Tillförlitlighets logik (t. ex. återöverföring av ignorerade data) liknande de pålitliga protokoll som TCP.</span><span class="sxs-lookup"><span data-stu-id="e5298-124">It does this by including ordering and reliability logic (e.g. retransmission of dropped data) similar to reliable protocols like TCP.</span></span>

<span data-ttu-id="e5298-125">En fullständig beskrivning av TLS ingår i kapitel 3 i NetX Secure TLS User ' s guide, så det här dokumentet fokuserar på skillnaderna mellan TLS och DTLS.</span><span class="sxs-lookup"><span data-stu-id="e5298-125">A complete discussion of TLS is included in Chapter 3 of the NetX Secure TLS User’s Guide, so this document will focus on the differences between TLS and DTLS.</span></span>

### <a name="dtls-record-header"></a><span data-ttu-id="e5298-126">DTLS post rubrik</span><span class="sxs-lookup"><span data-stu-id="e5298-126">DTLS Record header</span></span>

<span data-ttu-id="e5298-127">Alla giltiga DTLS-poster måste ha ett DTLS-huvud, som visas i bild 1.</span><span class="sxs-lookup"><span data-stu-id="e5298-127">Any valid DTLS record must have a DTLS header, as shown in Figure 1.</span></span> <span data-ttu-id="e5298-128">Huvudet är detsamma som TLS med att lägga till två nya fält: 16-bitars *epok* och 48-bitars *ordnings nummer*, som beskrivs nedan.</span><span class="sxs-lookup"><span data-stu-id="e5298-128">The header is the same as TLS with the addition of two new fields: the 16-bit *epoch* and the 48-bit *sequence number*, described below.</span></span>

![Diagram över en DTLS post-rubrik.](media/image2.png)

<span data-ttu-id="e5298-130">**Figur 1 – post rubriken DTLS**</span><span class="sxs-lookup"><span data-stu-id="e5298-130">**Figure 1 - DTLS record header**</span></span>

<span data-ttu-id="e5298-131">Fälten i TLS-postrubriken definieras enligt följande:</span><span class="sxs-lookup"><span data-stu-id="e5298-131">The fields of the TLS record header are defined as follows:</span></span>

| <span data-ttu-id="e5298-132">Fält för TLS-huvud</span><span class="sxs-lookup"><span data-stu-id="e5298-132">TLS Header Field</span></span> | <span data-ttu-id="e5298-133">Syfte</span><span class="sxs-lookup"><span data-stu-id="e5298-133">Purpose</span></span>  |
| ---------------- | --------- |
| <span data-ttu-id="e5298-134">**8-bitars meddelande typ**</span><span class="sxs-lookup"><span data-stu-id="e5298-134">**8-bit Message Type**</span></span> | <span data-ttu-id="e5298-135">Det här fältet innehåller den typ av DTLS-post som skickas.</span><span class="sxs-lookup"><span data-stu-id="e5298-135">This field contains the type of DTLS record being sent.</span></span> <span data-ttu-id="e5298-136">Giltiga typer är följande:</span><span class="sxs-lookup"><span data-stu-id="e5298-136">Valid types are as follows:</span></span><br /><span data-ttu-id="e5298-137">- ChangeCipherSpec: 0x14</span><span class="sxs-lookup"><span data-stu-id="e5298-137">- ChangeCipherSpec: 0x14</span></span><br /><span data-ttu-id="e5298-138">-Avisering: 0x15</span><span class="sxs-lookup"><span data-stu-id="e5298-138">- Alert: 0x15</span></span><br /><span data-ttu-id="e5298-139">-Hand skakning: 0x16</span><span class="sxs-lookup"><span data-stu-id="e5298-139">- Handshake: 0x16</span></span><br /><span data-ttu-id="e5298-140">– Program data: 0x17</span><span class="sxs-lookup"><span data-stu-id="e5298-140">- Application Data: 0x17</span></span><br /> |
| <span data-ttu-id="e5298-141">**16-bitars protokoll version**</span><span class="sxs-lookup"><span data-stu-id="e5298-141">**16-bit Protocol Version**</span></span> | <span data-ttu-id="e5298-142">Det här fältet innehåller DTLS-protokollets version.</span><span class="sxs-lookup"><span data-stu-id="e5298-142">This field contains the DTLS protocol version.</span></span> <span data-ttu-id="e5298-143">Giltiga värden är följande:</span><span class="sxs-lookup"><span data-stu-id="e5298-143">Valid values are as follows:</span></span><br /><span data-ttu-id="e5298-144">-DTLS 1,1:0xFEFD</span><span class="sxs-lookup"><span data-stu-id="e5298-144">- DTLS 1.1: 0xFEFD</span></span> |
|  <span data-ttu-id="e5298-145">**16-bitars epok**</span><span class="sxs-lookup"><span data-stu-id="e5298-145">**16-bit Epoch**</span></span> |  <span data-ttu-id="e5298-146">Det här fältet innehåller DTLS "epok" som är en räknare som ökas varje gång krypterings statusen ändras (t. ex. när nya sessionsnycklar genereras).</span><span class="sxs-lookup"><span data-stu-id="e5298-146">This field contains the DTLS “epoch” which is a counter that is incremented each time the encryption state is changed (e.g. when generating new session keys).</span></span>  |
|  <span data-ttu-id="e5298-147">**48-bitars sekvensnummer**</span><span class="sxs-lookup"><span data-stu-id="e5298-147">**48-bit Sequence Number**</span></span> |  <span data-ttu-id="e5298-148">Det här fältet innehåller ett sekvensnummer som identifierar den här posten.</span><span class="sxs-lookup"><span data-stu-id="e5298-148">This field contains a sequence number which identifies this particular record.</span></span> <span data-ttu-id="e5298-149">Den används av DTLS för att underhålla post beställningar och kontrol lera återöverförings behov.</span><span class="sxs-lookup"><span data-stu-id="e5298-149">It is used by DTLS to maintain record ordering and check for retransmission need.</span></span> |
|  <span data-ttu-id="e5298-150">**16-bitars längd**</span><span class="sxs-lookup"><span data-stu-id="e5298-150">**16-bit Length**</span></span> |  <span data-ttu-id="e5298-151">Det här fältet innehåller längden på de data som kapslats i DTLS-posten.</span><span class="sxs-lookup"><span data-stu-id="e5298-151">This field contains the length of the data encapsulated in the DTLS record.</span></span>  |

### <a name="dtls-handshake-record-header"></a><span data-ttu-id="e5298-152">Post rubrik för DTLS-handskakning</span><span class="sxs-lookup"><span data-stu-id="e5298-152">DTLS Handshake Record header</span></span>

<span data-ttu-id="e5298-153">Alla giltiga DTLS-handskaknings poster måste ha ett DTLS-huvud, som visas i bild 2.</span><span class="sxs-lookup"><span data-stu-id="e5298-153">Any valid DTLS handshake record must have a DTLS Handshake header, as shown in Figure 2.</span></span>

![Diagram över ett DTLS-handskaknings post huvud.](media/image3.png)

<span data-ttu-id="e5298-155">**Bild 2 – post rubriken för DTLS-handskakningen**</span><span class="sxs-lookup"><span data-stu-id="e5298-155">**Figure 2 - DTLS Handshake record header**</span></span>

<span data-ttu-id="e5298-156">Fälten i post huvudet för DTLS-handskakning definieras enligt följande:</span><span class="sxs-lookup"><span data-stu-id="e5298-156">The fields of the DTLS Handshake record header are defined as follows:</span></span>

| <span data-ttu-id="e5298-157">Fält för TLS-huvud</span><span class="sxs-lookup"><span data-stu-id="e5298-157">TLS Header Field</span></span> | <span data-ttu-id="e5298-158">Syfte</span><span class="sxs-lookup"><span data-stu-id="e5298-158">Purpose</span></span>  |
| ---------------- | ------------------------------------------------ |
| <span data-ttu-id="e5298-159">**8-bitars meddelande typ**</span><span class="sxs-lookup"><span data-stu-id="e5298-159">**8-bit Message Type**</span></span> | <span data-ttu-id="e5298-160">Det här fältet innehåller den typ av DTLS-post som skickas.</span><span class="sxs-lookup"><span data-stu-id="e5298-160">This field contains the type of DTLS record being sent.</span></span> <span data-ttu-id="e5298-161">Giltiga typer är följande:</span><span class="sxs-lookup"><span data-stu-id="e5298-161">Valid types are as follows:</span></span><br /><span data-ttu-id="e5298-162">- ChangeCipherSpec: 0x14</span><span class="sxs-lookup"><span data-stu-id="e5298-162">- ChangeCipherSpec: 0x14</span></span><br /><span data-ttu-id="e5298-163">-Avisering: 0x15</span><span class="sxs-lookup"><span data-stu-id="e5298-163">- Alert: 0x15</span></span><br /><span data-ttu-id="e5298-164">-Hand skakning: 0x16</span><span class="sxs-lookup"><span data-stu-id="e5298-164">- Handshake: 0x16</span></span><br /><span data-ttu-id="e5298-165">– Program data: 0x17</span><span class="sxs-lookup"><span data-stu-id="e5298-165">- Application Data: 0x17</span></span> |
|  <span data-ttu-id="e5298-166">**16-bitars epok**</span><span class="sxs-lookup"><span data-stu-id="e5298-166">**16-bit Epoch**</span></span> | <span data-ttu-id="e5298-167">Det här fältet innehåller DTLS "epok" som är en räknare som ökas varje gång krypterings statusen ändras (t. ex. när nya sessionsnycklar genereras).</span><span class="sxs-lookup"><span data-stu-id="e5298-167">This field contains the DTLS “epoch” which is a counter that is incremented each time the encryption state is changed (e.g. when generating new session keys).</span></span> |
|  <span data-ttu-id="e5298-168">**48-bitars sekvensnummer**</span><span class="sxs-lookup"><span data-stu-id="e5298-168">**48-bit Sequence Number**</span></span> | <span data-ttu-id="e5298-169">Det här fältet innehåller ett sekvensnummer som identifierar den här posten.</span><span class="sxs-lookup"><span data-stu-id="e5298-169">This field contains a sequence number which identifies this particular record.</span></span> <span data-ttu-id="e5298-170">Den används av DTLS för att underhålla post beställningar och kontrol lera återöverförings behov.</span><span class="sxs-lookup"><span data-stu-id="e5298-170">It is used by DTLS to maintain record ordering and check for retransmission need.</span></span> |
|  <span data-ttu-id="e5298-171">**16-bitars protokoll version**</span><span class="sxs-lookup"><span data-stu-id="e5298-171">**16-bit Protocol Version**</span></span> | <span data-ttu-id="e5298-172">Det här fältet innehåller DTLS-protokollets version.</span><span class="sxs-lookup"><span data-stu-id="e5298-172">This field contains the DTLS protocol version.</span></span> <span data-ttu-id="e5298-173">Giltiga värden är följande:</span><span class="sxs-lookup"><span data-stu-id="e5298-173">Valid values are as follows:</span></span><br /><span data-ttu-id="e5298-174">-DTLS 1,1:0xFEFD</span><span class="sxs-lookup"><span data-stu-id="e5298-174">- DTLS 1.1: 0xFEFD</span></span> |
| <span data-ttu-id="e5298-175">**16-bitars längd**</span><span class="sxs-lookup"><span data-stu-id="e5298-175">**16-bit Length**</span></span> | <span data-ttu-id="e5298-176">Det här fältet innehåller längden på de data som kapslats i DTLS-posten.</span><span class="sxs-lookup"><span data-stu-id="e5298-176">This field contains the length of the data encapsulated in the DTLS record.</span></span> |
| <span data-ttu-id="e5298-177">**8-bitars hand Skaknings typ**</span><span class="sxs-lookup"><span data-stu-id="e5298-177">**8-bit Handshake Type**</span></span> | <span data-ttu-id="e5298-178">Det här fältet innehåller meddelande typen hand skakning.</span><span class="sxs-lookup"><span data-stu-id="e5298-178">This field contains the handshake message type.</span></span> <span data-ttu-id="e5298-179">Giltiga värden är följande:</span><span class="sxs-lookup"><span data-stu-id="e5298-179">Valid values are as follows:</span></span><br /><span data-ttu-id="e5298-180">-HelloRequest: 0x00</span><span class="sxs-lookup"><span data-stu-id="e5298-180">- HelloRequest: 0x00</span></span><br /><span data-ttu-id="e5298-181">-Sitt hälsnings: 0x01</span><span class="sxs-lookup"><span data-stu-id="e5298-181">- ClientHello: 0x01</span></span><br /><span data-ttu-id="e5298-182">-ServerHello: protokollnumret 0x02</span><span class="sxs-lookup"><span data-stu-id="e5298-182">- ServerHello: 0x02</span></span><br /><span data-ttu-id="e5298-183">-Certifikat: 0x0B</span><span class="sxs-lookup"><span data-stu-id="e5298-183">- Certificate: 0x0B</span></span><br /><span data-ttu-id="e5298-184">- ServerKeyExchange: 0x0C</span><span class="sxs-lookup"><span data-stu-id="e5298-184">- ServerKeyExchange: 0x0C</span></span><br /><span data-ttu-id="e5298-185">- CertificateRequest: 0x0D</span><span class="sxs-lookup"><span data-stu-id="e5298-185">- CertificateRequest: 0x0D</span></span><br /><span data-ttu-id="e5298-186">- ServerHelloDone: 0x0E</span><span class="sxs-lookup"><span data-stu-id="e5298-186">- ServerHelloDone: 0x0E</span></span><br /><span data-ttu-id="e5298-187">- CertificateVerify: 0x0F</span><span class="sxs-lookup"><span data-stu-id="e5298-187">- CertificateVerify: 0x0F</span></span><br /><span data-ttu-id="e5298-188">-ClientKeyExchange: 0x10</span><span class="sxs-lookup"><span data-stu-id="e5298-188">- ClientKeyExchange: 0x10</span></span><br /><span data-ttu-id="e5298-189">-Färdig: 0x14</span><span class="sxs-lookup"><span data-stu-id="e5298-189">- Finished: 0x14</span></span> |
| <span data-ttu-id="e5298-190">**24-bitars längd**</span><span class="sxs-lookup"><span data-stu-id="e5298-190">**24-bit Length**</span></span> | <span data-ttu-id="e5298-191">Det här fältet innehåller längden på hand skaknings meddelande data.</span><span class="sxs-lookup"><span data-stu-id="e5298-191">This field contains the length of the handshake message data.</span></span> |
| <span data-ttu-id="e5298-192">**16-bitars sekvensnummer**</span><span class="sxs-lookup"><span data-stu-id="e5298-192">**16-bit Sequence Number**</span></span> | <span data-ttu-id="e5298-193">Det här fältet innehåller ett sekvensnummer.</span><span class="sxs-lookup"><span data-stu-id="e5298-193">This field contains a sequence number.</span></span> |

### <a name="the-dtls-handshake-and-dtls-session"></a><span data-ttu-id="e5298-194">DTLS-handskakning och DTLS-sessionen</span><span class="sxs-lookup"><span data-stu-id="e5298-194">The DTLS Handshake and DTLS Session</span></span>

<span data-ttu-id="e5298-195">En typisk DTLS-handskakning visas i bild 3.</span><span class="sxs-lookup"><span data-stu-id="e5298-195">A typical DTLS handshake is shown in Figure 3.</span></span> <span data-ttu-id="e5298-196">Den är nästan identisk med den typiska TLS-handskakningen med en viktig skillnad – när sitt hälsnings-meddelandet först skickas svarar servern med ett nytt DTLS meddelande *HelloVerifyRequest* som innehåller en "cookie".</span><span class="sxs-lookup"><span data-stu-id="e5298-196">It is nearly identical to the typical TLS handshake with an important difference – when the ClientHello message is first sent, the server responds with a new DTLS-specific message, *HelloVerifyRequest* which contains a “cookie”.</span></span> <span data-ttu-id="e5298-197">DTLS-klienten måste svara med ett andra sitt hälsnings-meddelande som innehåller den cookien innan hand skakningen kan fortsätta.</span><span class="sxs-lookup"><span data-stu-id="e5298-197">The DTLS Client must respond with a second ClientHello message containing that cookie before the handshake can proceed.</span></span> <span data-ttu-id="e5298-198">Den här mekanismen har lagts till i DTLS för att förhindra vissa DoS-attacker (Denial of Service) eftersom UDP är ett protokoll för anslutnings fel (TCP kräver en dedikerad anslutning/port så att TLS inte drabbas av samma problem).</span><span class="sxs-lookup"><span data-stu-id="e5298-198">This mechanism was added to DTLS to prevent certain Denial of Service (DoS) attacks since UDP is a connectionless protocol (TCP requires a dedicated connection/port so TLS does not suffer from the same issue).</span></span>

<span data-ttu-id="e5298-199">En DTLS-handskakning börjar när klienten skickar ett *sitt hälsnings* -meddelande till en DTLS-Server, vilket indikerar att de vill starta en DTLS-session.</span><span class="sxs-lookup"><span data-stu-id="e5298-199">A DTLS handshake begins when the Client sends a *ClientHello* message to a DTLS server, indicating its desire to start a DTLS session.</span></span> <span data-ttu-id="e5298-200">Meddelandet innehåller information om den kryptering som klienten vill använda för sessionen, tillsammans med information som används för att generera sessionsnycklar senare i hand skakningen.</span><span class="sxs-lookup"><span data-stu-id="e5298-200">The message contains information about the encryption the client would like to use for the session, along with information used to generate the session keys later in the handshake.</span></span> <span data-ttu-id="e5298-201">Alla meddelanden i DTLS-handskakningen krypteras inte förrän sessionsnycklarna har skapats.</span><span class="sxs-lookup"><span data-stu-id="e5298-201">Until the session keys are generated, all messages in the DTLS handshake are not encrypted.</span></span> <span data-ttu-id="e5298-202">Som nämnts ovan kan DTLS-servern skicka en HelloVerifyRequest som svar på sitt hälsnings, vilket tvingar klienten att svara med en andra uppdaterad sitt hälsnings.</span><span class="sxs-lookup"><span data-stu-id="e5298-202">As mentioned above, the DTLS Server may send a HelloVerifyRequest in response to the ClientHello, forcing the client to respond with a second updated ClientHello.</span></span>

<span data-ttu-id="e5298-203">Vid mottagandet av det andra sitt hälsnings verifierar DTLS-servern cookien och om korrekt svarar med ett ServerHello-meddelande som anger ett val från de krypterings alternativ som anges av klienten.</span><span class="sxs-lookup"><span data-stu-id="e5298-203">Upon receiving the second ClientHello message, the DTLS Server will verify the cookie and if correct will respond with a ServerHello message indicating a selection from the encryption options provided by the client.</span></span> <span data-ttu-id="e5298-204">ServerHello följs av ett certifikat meddelande där servern tillhandahåller ett digitalt certifikat för att autentisera sin identitet för klienten (om X. 509-verifiering används).</span><span class="sxs-lookup"><span data-stu-id="e5298-204">The ServerHello is followed by a Certificate message, in which the server provides a digital certificate to authenticate its identity to the client (if X.509 verification is used).</span></span> <span data-ttu-id="e5298-205">Slutligen skickar servern ett ServerHelloDone-meddelande som anger att det inte finns några fler meddelanden att skicka.</span><span class="sxs-lookup"><span data-stu-id="e5298-205">Finally, the server sends a ServerHelloDone message to indicate it has no more messages to send.</span></span> <span data-ttu-id="e5298-206">Servern kan eventuellt skicka andra meddelanden efter ServerHello och i vissa fall kan det inte skicka ett certifikat meddelande (till exempel när i förväg delade nycklar används), och därför måste ServerHelloDone-meddelandet.</span><span class="sxs-lookup"><span data-stu-id="e5298-206">The server may optionally send other messages following the ServerHello and in some cases it may not send a Certificate message (such as when Pre-Shared Keys are used), hence the need for the ServerHelloDone message.</span></span>

<span data-ttu-id="e5298-207">När klienten har tagit emot alla serverns meddelanden har den tillräckligt med information för att generera sessionsnycklar.</span><span class="sxs-lookup"><span data-stu-id="e5298-207">Once the client has received all the server’s messages, it has enough information to generate the session keys.</span></span> <span data-ttu-id="e5298-208">TLS/DTLS gör detta genom att skapa en delad bit av slumpmässiga data som kallas för *huvud hemlighet*, som är en fast storlek och som används som ett Seed för att generera alla nycklar som behövs när kryptering har Aktiver ATS.</span><span class="sxs-lookup"><span data-stu-id="e5298-208">TLS/DTLS does this by creating a shared bit of random data called the *Pre-Master Secret*, which is a fixed-size and is used as a seed to generate all the keys needed once encryption is enabled.</span></span> <span data-ttu-id="e5298-209">Hemligheten för huvud repliken krypteras med algoritmen för offentlig nyckel (t. ex. RSA) som anges i Hello-meddelandena (se nedan för information om algoritmer för offentliga nycklar) och den offentliga nyckel som tillhandahålls av servern i dess certifikat.</span><span class="sxs-lookup"><span data-stu-id="e5298-209">The Pre-Master Secret is encrypted using the public key algorithm (e.g. RSA) specified in the Hello messages (see below for information on public key algorithms) and the public key provided by the server in its certificate.</span></span> <span data-ttu-id="e5298-210">En valfri TLS/DTLS-funktion som kallas PSK (i förväg delade nycklar) aktiverar krypteringssviter som inte använder ett certifikat utan använder i stället ett hemligt värde som delas mellan värdarna (vanligt vis via fysisk överföring eller annan säker metod).</span><span class="sxs-lookup"><span data-stu-id="e5298-210">An optional TLS/DTLS feature called Pre-Shared Keys (PSK) enables ciphersuites that do not use a certificate but instead use a secret value shared between the hosts (usually through physical transfer or other secured method).</span></span> <span data-ttu-id="e5298-211">När PSK är aktiverat används den i förväg delade hemliga nyckeln för att generera den hemliga hemligheten.</span><span class="sxs-lookup"><span data-stu-id="e5298-211">When PSK is enabled, the pre-shared secret key is used to generate the Pre-Master Secret.</span></span> <span data-ttu-id="e5298-212">Se avsnittet om i förväg delade nycklar i "autentiseringsmetoder" nedan.</span><span class="sxs-lookup"><span data-stu-id="e5298-212">See the section on Pre-Shared Keys in “Authentication Methods” below.</span></span>

<span data-ttu-id="e5298-213">I en vanlig TLS/DTLS-handskakning skickas den krypterade huvud hemligheten till-servern i ClientKeyExchange-meddelandet.</span><span class="sxs-lookup"><span data-stu-id="e5298-213">In a usual TLS/DTLS handshake, the encrypted Pre-Master Secret is sent to the server in the ClientKeyExchange message.</span></span> <span data-ttu-id="e5298-214">Servern, vid mottagning av ClientKeyExchange-meddelandet, dekrypterar hemligheten för huvud repliken med dess privata nyckel och fortsätter att generera sessionsnycklar parallellt med TLS/DTLS-klienten.</span><span class="sxs-lookup"><span data-stu-id="e5298-214">The server, upon receiving the ClientKeyExchange message, decrypts the Pre-Master Secret using its private key and proceeds to generate the session keys in parallel with the TLS/DTLS client.</span></span>

<span data-ttu-id="e5298-215">När sessionsnycklarna har genererats kan alla ytterligare meddelanden krypteras med hjälp av algoritmen för privat nyckel (t. ex. AES) som valts i Hello-meddelandena.</span><span class="sxs-lookup"><span data-stu-id="e5298-215">Once the session keys are generated, all further messages can be encrypted using the private-key algorithm (e.g. AES) selected in the Hello messages.</span></span> <span data-ttu-id="e5298-216">Ett slutligt okrypterat meddelande som kallas ChangeCipherSpec skickas av både klienten och servern för att indikera att alla ytterligare meddelanden kommer att krypteras.</span><span class="sxs-lookup"><span data-stu-id="e5298-216">One final un-encrypted message called ChangeCipherSpec is sent by both the client and server to indicate that all further messages will be encrypted.</span></span>

<span data-ttu-id="e5298-217">Det första krypterade meddelandet som skickas av både klienten och servern är också det sista TLS-handskaknings meddelandet, som kallas slutfört.</span><span class="sxs-lookup"><span data-stu-id="e5298-217">The first encrypted message sent by both the client and server is also the final TLS handshake message, called Finished.</span></span> <span data-ttu-id="e5298-218">Det här meddelandet innehåller en hash av alla handskaknings meddelanden som har tagits emot och skickats.</span><span class="sxs-lookup"><span data-stu-id="e5298-218">This message contains a hash of all the handshake messages received and sent.</span></span> <span data-ttu-id="e5298-219">Denna hash används för att kontrol lera att inget av meddelandena i hand skakningen har manipulerats eller skadats (vilket innebär att säkerheten kan brytas).</span><span class="sxs-lookup"><span data-stu-id="e5298-219">This hash is used to verify that none of the messages in the handshake have been tampered with or corrupted (indicating a possible breach of security).</span></span>

<span data-ttu-id="e5298-220">När de färdiga meddelandena tas emot och hand skaknings-hasharna verifieras, börjar TLS/DTLS-sessionen och programmet börjar skicka och ta emot data.</span><span class="sxs-lookup"><span data-stu-id="e5298-220">Once the Finished messages are received and the handshake hashes are verified, the TLS/DTLS session begins, and the application begins sending and receiving data.</span></span> <span data-ttu-id="e5298-221">Alla data som skickas på endera sidan under TLS/DTLS-sessionen hashas först med den hash-algoritm som valts i Hello-meddelandena (för att tillhandahålla meddelande integritet) och krypteras med den valda algoritmen för privat nyckel med de genererade sessionsnycklarna.</span><span class="sxs-lookup"><span data-stu-id="e5298-221">All data sent by either side during the TLS/DTLS session is first hashed using the hash algorithm chosen in the Hello messages (to provide message integrity) and encrypted using the chosen private-key algorithm with the generated session keys.</span></span>

<span data-ttu-id="e5298-222">Slutligen kan en TLS/DTLS-session endast avslutas om antingen klienten eller servern väljer att göra det.</span><span class="sxs-lookup"><span data-stu-id="e5298-222">Finally, a TLS/DTLS session can only be successfully ended if either the Client or Server chooses to do so.</span></span> <span data-ttu-id="e5298-223">En trunkerad session betraktas som en säkerhets överträdelse (eftersom en angripare kan försöka förhindra att alla data som skickas tas emot) så att ett särskilt meddelande skickas när någon sida vill avsluta sessionen, som kallas en CloseNotify-avisering.</span><span class="sxs-lookup"><span data-stu-id="e5298-223">A truncated session is considered a security breach (since an attacker may be attempting to prevent all the data being sent from being received) so a special notification is sent when either side wants to end the session, called a CloseNotify alert.</span></span> <span data-ttu-id="e5298-224">Både klienten och servern måste skicka och bearbeta en CloseNotify-avisering för att en lyckad session ska kunna stängas.</span><span class="sxs-lookup"><span data-stu-id="e5298-224">Both the client and server must send and process a CloseNotify alert for a successful session shutdown.</span></span>

![Diagram över en typisk DTLS-handskaknings session.](media/image4.png)

<span data-ttu-id="e5298-226">**Bild 3 – typisk DTLS-handskakning**</span><span class="sxs-lookup"><span data-stu-id="e5298-226">**Figure 3- Typical DTLS handshake**</span></span>

### <a name="initialization"></a><span data-ttu-id="e5298-227">Initiering</span><span class="sxs-lookup"><span data-stu-id="e5298-227">Initialization</span></span>

<span data-ttu-id="e5298-228">NetX-eller NetXDuo-stacken måste initieras innan du använder NetX Secure DTLS.</span><span class="sxs-lookup"><span data-stu-id="e5298-228">The NetX or NetXDuo stack must be initialized prior to using NetX Secure DTLS.</span></span> <span data-ttu-id="e5298-229">I användar handboken för NetX eller NetXDuo hittar du information om hur du korrekt initierar TCP/IP-stacken för UDP-åtgärder.</span><span class="sxs-lookup"><span data-stu-id="e5298-229">Refer to the NetX or NetXDuo User Guide for information on how to properly initialize the TCP/IP stack for UDP operation.</span></span>

<span data-ttu-id="e5298-230">När NetX-UDP har initierats kan DTLS aktive ras.</span><span class="sxs-lookup"><span data-stu-id="e5298-230">Once NetX UDP has been initialized, DTLS can be enabled.</span></span> <span data-ttu-id="e5298-231">Internt hanteras all DTLS nätverks trafik och bearbetning av NetX/NetXDuo-stacken utan att användaren behöver göra något.</span><span class="sxs-lookup"><span data-stu-id="e5298-231">Internally, all DTLS network traffic and processing is handled by the NetX/NetXDuo stack without requiring user intervention.</span></span> <span data-ttu-id="e5298-232">DTLS har dock vissa särskilda krav som måste hanteras separat från den underliggande nätverks stacken.</span><span class="sxs-lookup"><span data-stu-id="e5298-232">However, DTLS has some specific requirements that must be handled separately from the underlying network stack.</span></span> <span data-ttu-id="e5298-233">DTLS klient åtgärd dessa parametrar tilldelas till DTLS-kontroll blocket som kallas \***NX_SECURE_DTLS_SESSION** _.</span><span class="sxs-lookup"><span data-stu-id="e5298-233">DTLS Client operation these parameters are assigned to the DTLS control block called \***NX_SECURE_DTLS_SESSION** _.</span></span> <span data-ttu-id="e5298-234">För DTLS-server åtgärd kallas kontroll block _ *_NX_SECURE_DTLS_SERVER_*\* och innehåller den infrastruktur som krävs för att hantera flera DTLS-sessioner på en enskild UDP-port – Observera att detta skiljer sig från TLS där varje TLS-session är kopplad till en enda TCP-port.</span><span class="sxs-lookup"><span data-stu-id="e5298-234">For DTLS Server operation, control block is called _ *_NX_SECURE_DTLS_SERVER_*\* and it contains the infrastructure needed to handle multiple DTLS sessions on a single UDP port – note that this is different from TLS where a each TLS session is bound to a single TCP port.</span></span>

<span data-ttu-id="e5298-235">De två DTLS lägena, server och klient, kan aktive ras i ett program (men bara ett läge per NetX-socket) och varje har sina egna specifika krav, som beskrivs nedan.</span><span class="sxs-lookup"><span data-stu-id="e5298-235">The two DTLS modes, Server and Client, may be enabled in an application (but only one mode per NetX socket), and each have their own specific requirements, detailed below.</span></span>

### <a name="initialization--dtls-server"></a><span data-ttu-id="e5298-236">Initiering – DTLS-Server</span><span class="sxs-lookup"><span data-stu-id="e5298-236">Initialization – DTLS Server</span></span>

<span data-ttu-id="e5298-237">NetX Secure DTLS Server mode skiljer sig från TLS server mode på grund av användningen av UDP för det underliggande protokollet för nätverks transport.</span><span class="sxs-lookup"><span data-stu-id="e5298-237">NetX Secure DTLS Server mode differs from TLS Server mode due to the use of UDP for the underlying network transport protocol.</span></span> <span data-ttu-id="e5298-238">Med TCP är porten kopplad till en enda fjärrvärd under TLS-sessionens varaktighet.</span><span class="sxs-lookup"><span data-stu-id="e5298-238">With TCP, the port is bound to a single remote host for the duration of the TLS session.</span></span> <span data-ttu-id="e5298-239">UDP har ingen teoretiskt tillstånd med avseende på Fjärrvärdet, så DTLS-begäranden från olika värdar kommer att tas emot i samma UDP-gränssnitt.</span><span class="sxs-lookup"><span data-stu-id="e5298-239">UDP has no notion of state with regard to the remote host so DTLS requests from different hosts will all be received on the same UDP interface.</span></span> <span data-ttu-id="e5298-240">Därför måste DTLS underhålla sessionstillstånd i stället för att förlita dig på socketen som TLS och TCP.</span><span class="sxs-lookup"><span data-stu-id="e5298-240">Therefore, DTLS must maintain session state rather than relying on the socket as with TLS and TCP.</span></span> <span data-ttu-id="e5298-241">Av den anledningen har DTLS Server Control Block (NX_SECURE_DTLS_SERVER) en mappning av fjär värd information (IP-adress och port) till DTLS-sessioner.</span><span class="sxs-lookup"><span data-stu-id="e5298-241">For this reason, the DTLS Server control block (NX_SECURE_DTLS_SERVER) maintains a mapping of remote host information (IP address and port) to DTLS sessions.</span></span> <span data-ttu-id="e5298-242">Alla inkommande data på UDP-socketen som tilldelats en DTLS-Server mappas till en befintlig eller ny DTLS-session baserat på fjärrvärden.</span><span class="sxs-lookup"><span data-stu-id="e5298-242">All incoming data on the UDP socket assigned to a DTLS Server will be mapped to an existing or new DTLS session based on the remote host.</span></span> <span data-ttu-id="e5298-243">Därför kräver skapandet av DTLS-servern flera ytterligare parametrar utöver vad TLS-och DTLS-klienten behöver.</span><span class="sxs-lookup"><span data-stu-id="e5298-243">For this reason, the DTLS server creation requires several additional parameters beyond what TLS and DTLS Client need.</span></span>

<span data-ttu-id="e5298-244">Förutom DTLS Server Control Block, TLS-krypteringssviter och chiffrering ScratchSpace/metadata kräver DTLS-servrar en buffert för att underhålla DTLS-sessioner och en paket omassembly-buffert som används för att dekryptera inkommande DTLS-poster.</span><span class="sxs-lookup"><span data-stu-id="e5298-244">In addition to the DTLS Server control block, TLS ciphersuites, and cipher scratchspace/metadata buffer, DTLS Servers require a buffer to maintain DTLS sessions and a packet reassembly buffer used to decrypt incoming DTLS records.</span></span>

<span data-ttu-id="e5298-245">Förutom session-buffertarna kräver DTLS-servrar ett *digitalt certifikat*, vilket är ett dokument som används för att identifiera TLS-servern för den anslutande TLS-klienten och certifikat motsvarande *privata nyckel*, vanligt vis för RSA-krypteringsalgoritmen.</span><span class="sxs-lookup"><span data-stu-id="e5298-245">In addition to the session buffers, DTLS Servers require a *Digital Certificate*, which is a document used to identify the TLS server to the connecting TLS client, and the certificates corresponding *Private Key*, usually for the RSA encryption algorithm.</span></span> <span data-ttu-id="e5298-246">International tele Union X. 509 standard anger det certifikat format som används av TLS/DTLS och det finns flera olika verktyg för att skapa X. 509-digitala certifikat.</span><span class="sxs-lookup"><span data-stu-id="e5298-246">The International Telecommunications Union X.509 standard specifies the certificate format used by TLS/DTLS and there are numerous utilities for creating X.509 digital certificates.</span></span>

<span data-ttu-id="e5298-247">För NetX Secure DTLS måste X. 509-certifikatet vara Binary-kodat med Distinguished Encoding Rules (DER)-formatet för ASN. 1.</span><span class="sxs-lookup"><span data-stu-id="e5298-247">For NetX Secure DTLS, the X.509 certificate must be binary-encoded using the Distinguished Encoding Rules (DER) format of ASN.1.</span></span> <span data-ttu-id="e5298-248">DER är standard TLS-formatet för TLS-överföring för certifikat.</span><span class="sxs-lookup"><span data-stu-id="e5298-248">DER is the standard TLS over-the-wire binary format for certificates.</span></span>

<span data-ttu-id="e5298-249">Den privata nyckeln som är associerad med det tillhandahållna certifikatet måste vara i DER-Encoded PKCS # 1-format.</span><span class="sxs-lookup"><span data-stu-id="e5298-249">The private key associated with the provided certificate must be in DER-Encoded PKCS#1 format.</span></span> <span data-ttu-id="e5298-250">Den privata nyckeln används bara på enheten och skickas aldrig över kabeln.</span><span class="sxs-lookup"><span data-stu-id="e5298-250">The private key is only used on the device and will never be transmitted over the wire.</span></span> <span data-ttu-id="e5298-251">Håll privata nycklar säkra eftersom de ger säkerhet för TLS/DTLS-kommunikation!</span><span class="sxs-lookup"><span data-stu-id="e5298-251">Keep private keys safe as they provide the security for TLS/DTLS communications!</span></span>

<span data-ttu-id="e5298-252">För att initiera DTLS-servercertifikatet måste programmet tillhandahålla en pekare till en buffert som innehåller det DER-kodade X. 509-certifikatet och en DER-kodad PKCS # 1 RSA-Datadata med hjälp av tjänsten ***nx_secure_x509_certificate_intialize*** , som fyller **NX_SECURE_X509_CERT** -strukturen med lämpliga certifikat data som ska användas av TLS.</span><span class="sxs-lookup"><span data-stu-id="e5298-252">To initialize the DTLS Server certificate, the application must provide a pointer to a buffer containing the DER-encoded X.509 certificate and optional DER-encoded PKCS#1 RSA private key data using the ***nx_secure_x509_certificate_intialize*** service, which populates the **NX_SECURE_X509_CERT** structure with the appropriate certificate data for use by TLS.</span></span>

<span data-ttu-id="e5298-253">När Server certifikatet har initierats måste det läggas till i TLS-kontroll-blocket med hjälp av tjänsten ***nx_secure_dtls_server_local_certificate_add*** .</span><span class="sxs-lookup"><span data-stu-id="e5298-253">Once the server certificate has been initialized, it must be added to the TLS control block using the ***nx_secure_dtls_server_local_certificate_add*** service.</span></span>

<span data-ttu-id="e5298-254">När serverns certifikat har lagts till i DTLS Server Control Block kan servern användas för säker DTLS-kommunikation (se exemplet ovan).</span><span class="sxs-lookup"><span data-stu-id="e5298-254">Once the server’s certificate has been added to the DTLS Server control block, the server can be used for secure DTLS communications (see example above).</span></span>

### <a name="initialization--dtls-client"></a><span data-ttu-id="e5298-255">Initiering – DTLS-klient</span><span class="sxs-lookup"><span data-stu-id="e5298-255">Initialization – DTLS Client</span></span>

<span data-ttu-id="e5298-256">NetX Secure DTLS client mode är enkelt i drift jämfört med DTLS-servern eftersom det bara finns en enda utgående anslutning till fjärrvärden över UDP-socketen.</span><span class="sxs-lookup"><span data-stu-id="e5298-256">NetX Secure DTLS Client mode is simple in operation compared to the DTLS server since there is only a single outgoing connection to the remote host over the UDP socket.</span></span>

<span data-ttu-id="e5298-257">För att kunna konfigurera en DTLS-klient kräver det ett *betrott certifikat Arkiv*, som är en samling X. 509 digitala certifikat från betrodda certifikat utfärdare (ca: er).</span><span class="sxs-lookup"><span data-stu-id="e5298-257">To setup a DTLS Client, it requires a *Trusted Certificate Store*, which is a collection of X.509-encoded digital certificates from trusted Certificate Authorities (CA’s).</span></span> <span data-ttu-id="e5298-258">Dessa certifikat antas av att DTLS-protokollet är "betrott" och fungerar som underlag för att autentisera certifikat som tillhandahålls av DTLS-Server enheter till NetX säkra DTLS-klient programmet.</span><span class="sxs-lookup"><span data-stu-id="e5298-258">These certificates are assumed by the DTLS protocol to be “trusted” and serve as the basis for authenticating certificates provided by DTLS server entities to the NetX Secure DTLS Client application.</span></span>

<span data-ttu-id="e5298-259">Ett certifikat för betrodd certifikat utfärdare kan antingen vara *självsignerat* eller signerat av en annan certifikat utfärdare, vilket innebär att certifikatet kallas *mellanliggande ca* (ICA).</span><span class="sxs-lookup"><span data-stu-id="e5298-259">A trusted CA certificate may either be *self-signed* or signed by another CA, in which case that certificate is called an *Intermediate CA* (ICA).</span></span> <span data-ttu-id="e5298-260">I ett typiskt TLS/DTLS-program tillhandahåller servern ICA-certifikat tillsammans med dess server certifikat, men det enda kravet för lyckad autentisering är att en kedja av utfärdare (certifikat som används för att signera andra certifikat) kan spåras från Server certifikatet tillbaka till ett certifikat för betrodd certifikat utfärdare i det betrodda certifikat arkivet.</span><span class="sxs-lookup"><span data-stu-id="e5298-260">In a typical TLS/DTLS application, the server provides the ICA certificates along with its server certificate, but the only requirement for successful authentication is that a chain of issuers (certificates used to sign other certificates) can be traced from the server certificate back to a trusted CA certificate in the Trusted Certificate Store.</span></span> <span data-ttu-id="e5298-261">Den här kedjan kallas en *kedja av förtroende* eller en *certifikat kedja*.</span><span class="sxs-lookup"><span data-stu-id="e5298-261">This chain is known as a *chain of trust* or *certificate chain*.</span></span>

<span data-ttu-id="e5298-262">För att initiera en betrodd certifikat utfärdare eller ett ICA-certifikat måste programmet tillhandahålla en pekare till en buffert som innehåller det DER-kodade X. 509-certifikatet med hjälp av tjänsten ***nx_secure_x509_certificate_intialize** _, som fyller i strukturen _ *NX_SECURE_X509_CERT** med lämpliga certifikat data som ska användas av TLS.</span><span class="sxs-lookup"><span data-stu-id="e5298-262">To initialize a trusted CA or ICA certificate, the application must provide a pointer to a buffer containing the DER-encoded X.509 certificate using the ***nx_secure_x509_certificate_intialize** _ service, which populates the _ *NX_SECURE_X509_CERT** structure with the appropriate certificate data for use by TLS.</span></span>

<span data-ttu-id="e5298-263">DTLS-klienten behöver också utrymme för att det inkommande server certifikatet ska tilldelas (förutsatt att ett i förväg delad nyckel läge inte används) och en buffert för montering av paket i DTLS-poster som ska dekrypteras.</span><span class="sxs-lookup"><span data-stu-id="e5298-263">The DTLS Client also needs space for the incoming server certificate to be allocated (assuming a Pre-Shared Key mode is not being used) and a buffer for assembling packets into DTLS records to be decrypted.</span></span> <span data-ttu-id="e5298-264">Dessa buffertar skickas in som parametrar till tjänsten ***nx_secure_dtls_session_create*** (mer information finns i API-referensen).</span><span class="sxs-lookup"><span data-stu-id="e5298-264">These buffers are passed in as parameters to the ***nx_secure_dtls_session_create*** service (see API reference for more information).</span></span>

<span data-ttu-id="e5298-265">Betrodda certifikat som har initierats läggs sedan till i det skapade DTLS session Control-blocket med hjälp av tjänsten ***nx_secure_dtls_session_trusted_certificate_add*** .</span><span class="sxs-lookup"><span data-stu-id="e5298-265">Trusted certificates that have been initialized are then added to the created DTLS session control block using the ***nx_secure_dtls_session_trusted_certificate_add*** service.</span></span> <span data-ttu-id="e5298-266">Om du inte lägger till ett certifikat Miss lyckas DTLS-klientsessionen eftersom det inte finns något sätt för DTLS-protokollet att autentisera fjärrserver-värdar.</span><span class="sxs-lookup"><span data-stu-id="e5298-266">Failure to add a certificate will cause the DTLS Client session to fail as there will be no way for the DTLS protocol to authenticate remote server hosts.</span></span>

<span data-ttu-id="e5298-267">När det betrodda certifikat arkivet har skapats kan sessionen användas för att upprätta en säker TLS-klient anslutning.</span><span class="sxs-lookup"><span data-stu-id="e5298-267">Once the Trusted Certificate Store has been created the session may be used to establish a secure TLS Client connection.</span></span>

### <a name="application-interface-calls"></a><span data-ttu-id="e5298-268">Program gränssnitts anrop</span><span class="sxs-lookup"><span data-stu-id="e5298-268">Application Interface Calls</span></span>

<span data-ttu-id="e5298-269">NetX säkra DTLS-program gör vanligt vis att funktions anrop inifrån program trådar som körs under ThreadX-återställnings tider.</span><span class="sxs-lookup"><span data-stu-id="e5298-269">NetX Secure DTLS applications will typically make function calls from within application threads running under the ThreadX RTOS.</span></span> <span data-ttu-id="e5298-270">Vissa initieringar, särskilt för underliggande nätverks protokoll för nätverks kommunikation (t. ex. UDP och IP), kan anropas från \*\**tx_application_define *.**</span><span class="sxs-lookup"><span data-stu-id="e5298-270">Some initialization, particularly for the underlying network communications protocols (e.g. UDP and IP) may be called from \***tx_application_define\*.**</span></span> <span data-ttu-id="e5298-271">Mer information om hur du initierar nätverkskommunikation finns i användar handboken för NetX/NetXDuo.</span><span class="sxs-lookup"><span data-stu-id="e5298-271">See the NetX/NetXDuo User Guide for more information on initializing network communications.</span></span>

<span data-ttu-id="e5298-272">DTLS gör den stora användningen av krypterings rutiner som är processor intensiva åtgärder.</span><span class="sxs-lookup"><span data-stu-id="e5298-272">DTLS makes heavy use of encryption routines which are processor-intensive operations.</span></span> <span data-ttu-id="e5298-273">De här åtgärderna utförs vanligt vis inom ramen för anrop av tråd.</span><span class="sxs-lookup"><span data-stu-id="e5298-273">Generally, these operations will be performed within the context of calling thread.</span></span>

### <a name="dtls-session-start"></a><span data-ttu-id="e5298-274">DTLS-session startades</span><span class="sxs-lookup"><span data-stu-id="e5298-274">DTLS Session Start</span></span>

<span data-ttu-id="e5298-275">DTLS kräver ett underliggande nätverks protokoll för transport skikt för att fungera.</span><span class="sxs-lookup"><span data-stu-id="e5298-275">DTLS requires an underlying transport-layer network protocol in order to function.</span></span> <span data-ttu-id="e5298-276">Protokollet används vanligt vis för TCP.</span><span class="sxs-lookup"><span data-stu-id="e5298-276">The protocol typically used is TCP.</span></span> <span data-ttu-id="e5298-277">För att kunna upprätta en NetX säker TLS-session måste en **NX_UDP_SOCKET** skapas och skickas till **_nx_secure_dtls_client_session_start_** -tjänsten för DTLS-klienter.</span><span class="sxs-lookup"><span data-stu-id="e5298-277">In order to establish a NetX Secure TLS session an **NX_UDP_SOCKET** must be created and passed into the **_nx_secure_dtls_client_session_start_** service for DTLS Clients.</span></span>

<span data-ttu-id="e5298-278">DTLS-servrar fungerar annorlunda.</span><span class="sxs-lookup"><span data-stu-id="e5298-278">DTLS Servers operate differently.</span></span> <span data-ttu-id="e5298-279">UDP-socketen som används för inkommande DTLS-klient begär Anden finns i NX_SECURE_DTLS_SERVER kontroll block och initieras i anropet till \***nx_secure_dtls_server_create** _, som tar den lokala UDP-porten som en parameter.</span><span class="sxs-lookup"><span data-stu-id="e5298-279">The UDP socket used for incoming DTLS Client requests is contained within the NX_SECURE_DTLS_SERVER control block and is initialized in the call to \***nx_secure_dtls_server_create** _, which takes the local UDP port as a parameter.</span></span> <span data-ttu-id="e5298-280">Tjänsten _*_nx_secure_dtls_server_start_*_ används sedan för att starta DTLS-servern för att hantera inkommande begär Anden.</span><span class="sxs-lookup"><span data-stu-id="e5298-280">The service _*_nx_secure_dtls_server_start_*_ is then used to start the DTLS Server to handle incoming requests.</span></span> <span data-ttu-id="e5298-281">Alla inkommande begär Anden hanteras i callback-rutiner som ges till _nx_secure_dtls_server_create \*: en för anslutningar och en för att ta emot meddelanden. Det är upp till programmet för att hantera start av DTLS-sessionen när ett anslutnings meddelande tas emot (anslutnings anropet för att meddela om att det anropas av DTLS) genom att anropa \***nx_secure_dtls_server_session_start**_.</span><span class="sxs-lookup"><span data-stu-id="e5298-281">All incoming requests are handled in callback routines provided to _nx_secure_dtls_server_create\*: one for connections and one for receive notifications. It is up to the application to handle starting the DTLS session when a connection notification is received (the connect notify callback is invoked by DTLS) by calling \***nx_secure_dtls_server_session_start**_.</span></span> <span data-ttu-id="e5298-282">Programmet måste också hantera inkommande data när motringningen ta emot meddelande anropas (som följer en slutförd DTLS-handskakning) genom att anropa _ *_nx_secure_dtls_session_receive_* \*.</span><span class="sxs-lookup"><span data-stu-id="e5298-282">The application also must handle incoming data when the receive notify callback is invoked (which follows a completed DTLS handshake) by calling _\*_nx_secure_dtls_session_receive_\*\*.</span></span> <span data-ttu-id="e5298-283">Informationen om detta finns i exemplet ovan och i API-referensen för var och en av de ovan nämnda tjänsterna.</span><span class="sxs-lookup"><span data-stu-id="e5298-283">The details of this are provided in the example above and in the API reference for each of the above mentioned services.</span></span>

### <a name="dtls-packet-allocation"></a><span data-ttu-id="e5298-284">DTLS paket tilldelning</span><span class="sxs-lookup"><span data-stu-id="e5298-284">DTLS Packet Allocation</span></span>

<span data-ttu-id="e5298-285">NetX Secure DTLS använder samma paket struktur som NetX/NetXDuo TCP (***NX_PACKET** _), förutom att i stället för att anropa tjänsten _*_nx_packet_allocate_*_ måste tjänsten _ *_nx_secure_dtls_packet_allocate_** anropas så att utrymmet för DTLS-huvudet kan allokeras korrekt.</span><span class="sxs-lookup"><span data-stu-id="e5298-285">NetX Secure DTLS uses the same packet structure as NetX/NetXDuo TCP (***NX_PACKET** _) except that instead of calling the _*_nx_packet_allocate_*_ service, the _ *_nx_secure_dtls_packet_allocate_** service must be called so that space for the DTLS header may be allocated properly.</span></span>

### <a name="dtls-session-send"></a><span data-ttu-id="e5298-286">Skicka DTLS-session</span><span class="sxs-lookup"><span data-stu-id="e5298-286">DTLS Session Send</span></span>

<span data-ttu-id="e5298-287">När TLS-sessionen har startats kan programmet skicka data med hjälp av tjänsten ***nx_secure_dtls_session_send*** .</span><span class="sxs-lookup"><span data-stu-id="e5298-287">Once the TLS session has started, the application may send data using the ***nx_secure_dtls_session_send*** service.</span></span> <span data-ttu-id="e5298-288">Sändnings tjänsten är identisk med ***nx_udp_socket_send** _-tjänsten, med en _ *_NX_PACKET_** data struktur som innehåller de data som skickas, en mål-IP-adress och en UDP-målport.</span><span class="sxs-lookup"><span data-stu-id="e5298-288">The send service is identical in use to the ***nx_udp_socket_send** _ service, taking an _ *_NX_PACKET_** data structure containing the data being sent, a target IP address, and a target UDP port.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="e5298-289">När du skickar data med hjälp av nx_secure_dtls_session_send, är det viktigt att använda samma IP-adress och port som användes för att upprätta DTLS-sessionen, om det inte finns någon mekanism för att flytta sessionen till en ny adress och UDP-port på plats (detta är inte vanligt).</span><span class="sxs-lookup"><span data-stu-id="e5298-289">When sending data using nx_secure_dtls_session_send, it is important to use the same IP address and port that were used to establish the DTLS session, unless there is a mechanism in place to move the session to a new address and UDP port on-the-fly (this is not common).</span></span>

<span data-ttu-id="e5298-290">Alla data som skickas över DTLS krypteras av NX Secure DTLS-stacken och de konfigurerade krypterings rutinerna innan de skickas.</span><span class="sxs-lookup"><span data-stu-id="e5298-290">Any data sent over DTLS will be encrypted by the NX Secure DTLS stack and the configured encryption routines before being sent.</span></span>

### <a name="dtls-session-receive"></a><span data-ttu-id="e5298-291">Ta emot DTLS-session</span><span class="sxs-lookup"><span data-stu-id="e5298-291">DTLS Session Receive</span></span>

<span data-ttu-id="e5298-292">När DTLS-sessionen har startats kan programmet ta emot data med hjälp av tjänsten \***nx_secure_Dtls_session_receive** _.</span><span class="sxs-lookup"><span data-stu-id="e5298-292">Once the DTLS session has started, the application may begin receiving data using the \***nx_secure_Dtls_session_receive** _ service.</span></span> <span data-ttu-id="e5298-293">Precis som DTLS-sessionen skickar, är den här tjänsten identisk med _ *_nx_udp_socket_receive_* \*, förutom att inkommande data dekrypteras och verifieras av DTLS-stacken innan de returneras i paket strukturen.</span><span class="sxs-lookup"><span data-stu-id="e5298-293">Like the DTLS Session send, this service is identical in use to _\*_nx_udp_socket_receive_\*\*, except that the incoming data is decrypted and verified by the DTLS stack before being returned in the packet structure.</span></span>

### <a name="tls-session-close"></a><span data-ttu-id="e5298-294">Sessionen stängs av TLS</span><span class="sxs-lookup"><span data-stu-id="e5298-294">TLS Session Close</span></span>

<span data-ttu-id="e5298-295">När en DTLS-session har slutförts måste både DTLS-klienten och servern skicka en CloseNotify-avisering till den andra sidan för att stänga av sessionen.</span><span class="sxs-lookup"><span data-stu-id="e5298-295">Once a DTLS session is complete, both the DTLS client and server must send a CloseNotify alert to the other side to shut down the session.</span></span> <span data-ttu-id="e5298-296">Båda sidorna måste ta emot och bearbeta aviseringen för att säkerställa att en lyckad session stängs av.</span><span class="sxs-lookup"><span data-stu-id="e5298-296">Both sides must receive and process the alert to ensure a successful session shutdown.</span></span>

<span data-ttu-id="e5298-297">Om fjärrvärden skickar en CloseNotify avisering, bearbetar alla anrop till \***nx_secure_dtls_session_receive** _-tjänsten aviseringen, skickar motsvarande avisering tillbaka till fjärrvärden och returnerar värdet _ *_NX_SECURE_TLS_SESSION_CLOSED_* \*.</span><span class="sxs-lookup"><span data-stu-id="e5298-297">If the remote host sends a CloseNotify alert, any calls to the ***nx_secure_dtls_session_receive** _ service will process the alert, send the corresponding alert back to the remote host, and return a value of _*_NX_SECURE_TLS_SESSION_CLOSED_\*\*.</span></span> <span data-ttu-id="e5298-298">När sessionen har stängts Miss lyckas ytterligare försök att skicka eller ta emot data med den DTLS sessionen.</span><span class="sxs-lookup"><span data-stu-id="e5298-298">Once the session is closed, any further attempts to send or receive data with that DTLS session will fail.</span></span>

<span data-ttu-id="e5298-299">Om programmet vill stänga TLS-sessionen måste tjänsten \***nx_secure_dtls_session_end** _ anropas.</span><span class="sxs-lookup"><span data-stu-id="e5298-299">If the application wishes to close the TLS session, the \***nx_secure_dtls_session_end** _ service must be called.</span></span> <span data-ttu-id="e5298-300">Tjänsten kommer att skicka CloseNotify-aviseringen och bearbeta svars CloseNotify.</span><span class="sxs-lookup"><span data-stu-id="e5298-300">The service will send the CloseNotify alert and process the response CloseNotify.</span></span> <span data-ttu-id="e5298-301">Om svaret inte tas emot returneras ett felvärde på _ \*_NX_SECURE_TLS_SESSION_CLOSE_FAIL_\*\*, vilket tyder på att DTLS-sessionen inte stängdes på rätt sätt, vilket möjliggör en säkerhets överträdelse.</span><span class="sxs-lookup"><span data-stu-id="e5298-301">If the response is not received, an error value of _ *_NX_SECURE_TLS_SESSION_CLOSE_FAIL_*\* will be returned, indicating that the DTLS session was not cleanly shutdown, a possible security breach.</span></span>

### <a name="tlsdtls-alerts"></a><span data-ttu-id="e5298-302">TLS/DTLS-aviseringar</span><span class="sxs-lookup"><span data-stu-id="e5298-302">TLS/DTLS Alerts</span></span>

<span data-ttu-id="e5298-303">TLS/DTLS har utformats för att ge maximal säkerhet, så alla Errant beteenden i protokollet betraktas som en potentiell säkerhets överträdelse.</span><span class="sxs-lookup"><span data-stu-id="e5298-303">TLS/DTLS is designed to provide maximum security, so any errant behavior in the protocol is considered a potential security breach.</span></span> <span data-ttu-id="e5298-304">Av den anledningen betraktas eventuella fel vid meddelande bearbetning eller kryptering/dekryptering av allvarliga fel som avslutar hand skakningen eller sessionen omedelbart.</span><span class="sxs-lookup"><span data-stu-id="e5298-304">For this reason, any errors in message processing or encryption/decryption are considered fatal errors that terminate the handshake or session immediately.</span></span>

<span data-ttu-id="e5298-305">Vid hantering av fel i ett lokalt program är det relativt enkelt att ta reda på att ett fel har inträffat för att hantera situationen på ett korrekt sätt och förhindra ytterligare eventuella säkerhets överträdelser.</span><span class="sxs-lookup"><span data-stu-id="e5298-305">While handling errors in a local application is relatively straightforward, the remote host needs to know that an error has occurred in order to properly handle the situation and prevent any further possible security breaches.</span></span> <span data-ttu-id="e5298-306">Av den anledningen skickar TLS/DTLS ett *varnings* meddelande till fjärrvärden vid eventuella fel.</span><span class="sxs-lookup"><span data-stu-id="e5298-306">For this reason, TLS/DTLS will send an *Alert* message to the remote host upon any error.</span></span>

<span data-ttu-id="e5298-307">Aviseringar behandlas på samma sätt som andra TLS/DTLS-meddelanden och krypteras under sessionen för att förhindra att en angripare samlar in information från den typ av avisering som tillhandahålls.</span><span class="sxs-lookup"><span data-stu-id="e5298-307">Alerts are treated in the same manner as any other TLS/DTLS messages and are encrypted during the session to prevent an attacker from gathering information from the type of alert provided.</span></span> <span data-ttu-id="e5298-308">Under hand skakningen är de skickade aviseringarna begränsade inom räckvidden för att begränsa den mängd information som kan erhållas av en potentiell angripare.</span><span class="sxs-lookup"><span data-stu-id="e5298-308">During the handshake, the alerts sent are limited in scope to limit the amount of information that could be obtained by a potential attacker.</span></span>

<span data-ttu-id="e5298-309">CloseNotify-aviseringen som används för att stänga TLS/DTLS-sessionen är den enda icke-allvarliga varningen.</span><span class="sxs-lookup"><span data-stu-id="e5298-309">The CloseNotify alert, used to close the TLS/DTLS session, is the only non-fatal alert.</span></span> <span data-ttu-id="e5298-310">Även om det anses vara en avisering och skickas som ett varnings meddelande, är en CloseNotify till skillnad från andra aviseringar i att det inte indikerar att ett fel har uppstått.</span><span class="sxs-lookup"><span data-stu-id="e5298-310">While it is considered an alert and sent as an alert message, a CloseNotify is unlike other alerts in that it does not indicate an error has occurred.</span></span>

### <a name="tlsdtls-session-renegotiation-and-resumption"></a><span data-ttu-id="e5298-311">TLS/DTLS för att återförhandla och återupptas</span><span class="sxs-lookup"><span data-stu-id="e5298-311">TLS/DTLS Session Renegotiation and Resumption</span></span>

<span data-ttu-id="e5298-312">TLS stöder begreppet "omförhandling" som bara är en omförhandling av TLS-sessionens parametrar inom kontexten för en befintlig TLS-session.</span><span class="sxs-lookup"><span data-stu-id="e5298-312">TLS supports the notion of “renegotiation” which is simply a renegotiation of the TLS session parameters within the context of an existing TLS session.</span></span>

<span data-ttu-id="e5298-313">Återupptagning av TLS- *sessioner bör inte* förväxlas med *omförhandling* av sessionen, trots vissa likheter.</span><span class="sxs-lookup"><span data-stu-id="e5298-313">TLS session *resumption* should not be confused with session *renegotiation*, despite some similarities.</span></span> <span data-ttu-id="e5298-314">Om omstarten av *sessionen innebär att* starta en ny hand skakning inom en befintlig TLS *-session* är sessionen återupptagning en helt valfri funktion som inbegriper omstart av en stängd TLS-session utan att utföra en fullständig TLS-handskakning.</span><span class="sxs-lookup"><span data-stu-id="e5298-314">Where session *renegotiation* involves starting a new handshake within an existing TLS session, session *resumption* is a purely optional feature that involves restarting a closed TLS session without performing a complete TLS handshake.</span></span>

<span data-ttu-id="e5298-315">NX Secure DTLS hanterar inkommande begär Anden om omförhandling från fjärranslutna värdar.</span><span class="sxs-lookup"><span data-stu-id="e5298-315">NX Secure DTLS handles incoming renegotiation requests from remote hosts.</span></span> <span data-ttu-id="e5298-316">Den har **inte** stöd för att återuppta sessionen.</span><span class="sxs-lookup"><span data-stu-id="e5298-316">It does **not** support session resumption.</span></span> <span data-ttu-id="e5298-317">En mer fullständig beskrivning av de här funktionerna finns i kapitel 3 i användar handboken för Secure TLS-NetX.</span><span class="sxs-lookup"><span data-stu-id="e5298-317">A more complete discussion of these features can be found in Chapter 3 of the NetX Secure TLS User Guide.</span></span>

### <a name="protocol-layering"></a><span data-ttu-id="e5298-318">Protokoll skikt</span><span class="sxs-lookup"><span data-stu-id="e5298-318">Protocol Layering</span></span>

<span data-ttu-id="e5298-319">TLS-protokollet (och därmed även DTLS) passar i nätverks stacken mellan transport lagret (t. ex. TCP eller UDP) och program skiktet.</span><span class="sxs-lookup"><span data-stu-id="e5298-319">The TLS protocol (and therefore DTLS as well) fits into the networking stack between the transport layer (e.g. TCP or UDP) and the application layer.</span></span> <span data-ttu-id="e5298-320">TLS anses ibland vara ett transport skikt protokoll (därmed *Transport Layer* Security), men eftersom det fungerar som ett program med avseende på de underliggande nätverks protokollen, grupperas ibland i program lagret.</span><span class="sxs-lookup"><span data-stu-id="e5298-320">TLS is sometimes considered a transport-layer protocol (hence *Transport Layer* Security) but because it acts as an application with regard to the underlying network protocols it is sometimes grouped into the application layer.</span></span>

<span data-ttu-id="e5298-321">TLS kräver ett transport lager protokoll som stöder in-och förlustfri överföring, till exempel TCP.</span><span class="sxs-lookup"><span data-stu-id="e5298-321">TLS requires a transport layer protocol that supports in-order and lossless delivery, such as TCP.</span></span> <span data-ttu-id="e5298-322">På grund av detta krav kan TLS inte köras ovanpå UDP eftersom UDP inte garanterar leverans av datagram.</span><span class="sxs-lookup"><span data-stu-id="e5298-322">Due to this requirement, TLS cannot run on top of UDP since UDP does not guarantee delivery of datagrams.</span></span> <span data-ttu-id="e5298-323">*DTLS* är en modifierad version av TLS, används för program som behöver TLS-TLS över ett datagram-protokoll som UDP.</span><span class="sxs-lookup"><span data-stu-id="e5298-323">*DTLS* is a modified version of TLS, is used for applications that need the security of TLS over a datagram protocol like UDP.</span></span>

![Diagram över TLS-protokoll skiktning.](media/image6.png)

<span data-ttu-id="e5298-325">**Bild 4 – TCP/IP, UDP och TLS/DTLS protokoll lager**</span><span class="sxs-lookup"><span data-stu-id="e5298-325">**Figure 4- TCP/IP, UDP and TLS/DTLS protocol layers**</span></span>

## <a name="network-communications-security-and-encryption"></a><span data-ttu-id="e5298-326">Säkerhet och kryptering för nätverks kommunikation</span><span class="sxs-lookup"><span data-stu-id="e5298-326">Network Communications Security and Encryption</span></span>

<span data-ttu-id="e5298-327">Att skydda kommunikation över offentliga nätverk och Internet är ett kritiskt viktigt ämne och ämnet för ett stort antal böcker, artiklar och lösningar.</span><span class="sxs-lookup"><span data-stu-id="e5298-327">Securing communications over public networks and the Internet is a critically important topic and the subject of vast numbers of books, articles, and solutions.</span></span> <span data-ttu-id="e5298-328">Avsnittet är en bogglingly komplex, men det kan minskas till en enkel idé: att skicka information via ett nätverk så att endast det avsedda målet kan komma åt eller ändra informationen.</span><span class="sxs-lookup"><span data-stu-id="e5298-328">The topic is mind-bogglingly complex, but can be reduced to a simple idea: sending information over a network so that only the intended target can access or change that information.</span></span> <span data-ttu-id="e5298-329">Detta bryts ned i tre viktiga begrepp: sekretess, integritet och autentisering.</span><span class="sxs-lookup"><span data-stu-id="e5298-329">This breaks down into three important concepts: secrecy, integrity, and authentication.</span></span> <span data-ttu-id="e5298-330">TLS/DTLS-protokollet tillhandahåller lösningar för alla tre.</span><span class="sxs-lookup"><span data-stu-id="e5298-330">The TLS/DTLS protocol provides solutions for all three.</span></span>

<span data-ttu-id="e5298-331">Kryptering används på olika sätt för att tillhandahålla sekretess, integritet och autentisering inom TLS-och DTLS-protokollen.</span><span class="sxs-lookup"><span data-stu-id="e5298-331">Encryption is used in different ways to provide secrecy, integrity, and authentication within the TLS and DTLS protocols.</span></span> <span data-ttu-id="e5298-332">Krypteringen måste anges till TLS eller DTLS när en session eller Server instans skapas som TLS, vilket ger ett flexibelt ramverk för att använda kryptering och inte själva krypteringen.</span><span class="sxs-lookup"><span data-stu-id="e5298-332">The encryption must be supplied to TLS or DTLS upon creation of a session or server instance as TLS provides a flexible framework for using encryption and not the encryption itself.</span></span> <span data-ttu-id="e5298-333">NetX Secure DTLS innehåller de nödvändiga krypterings rutinerna för de flesta program, så du behöver inte bekymra dig om att hitta lämplig kryptering.</span><span class="sxs-lookup"><span data-stu-id="e5298-333">NetX Secure DTLS provides the necessary encryption routines for most applications so you do not have to be concerned about finding appropriate encryption.</span></span>

<span data-ttu-id="e5298-334">En mer detaljerad beskrivning av de här ämnena finns i kapitel 3 i användar handboken för Secure TLS-NetX.</span><span class="sxs-lookup"><span data-stu-id="e5298-334">A more detailed description of these topics can be found in Chapter 3 of the NetX Secure TLS User Guide.</span></span>

## <a name="tls-and-dtls-extensions"></a><span data-ttu-id="e5298-335">TLS-och DTLS-tillägg</span><span class="sxs-lookup"><span data-stu-id="e5298-335">TLS and DTLS Extensions</span></span>

<span data-ttu-id="e5298-336">TLS (och därför DTLS) innehåller ett antal tillägg som ger ytterligare funktioner för vissa program.</span><span class="sxs-lookup"><span data-stu-id="e5298-336">TLS (and therefore DTLS) provides a number of extensions that provide additional functionality for certain applications.</span></span> <span data-ttu-id="e5298-337">Dessa tillägg skickas vanligt vis som en del av sitt hälsnings-eller ServerHello-meddelandena, vilket indikerar att en fjärrvärd vill använda ett tillägg eller tillhandahålla ytterligare information som används för att upprätta en säker TLS-session.</span><span class="sxs-lookup"><span data-stu-id="e5298-337">These extensions are typically sent as part of the ClientHello or ServerHello messages, indicating to a remote host the desire to use an extension or providing additional details for use in establishing the secure TLS session.</span></span>

<span data-ttu-id="e5298-338">NetX Secure DTLS stöder alla tillägg som finns i NetX Secure TLS, och en fullständig beskrivning av dem finns i NetX Secure TLS user guide, kapitel 3.</span><span class="sxs-lookup"><span data-stu-id="e5298-338">NetX Secure DTLS supports all of the extensions found in NetX Secure TLS, and a complete description of those can be found in the NetX Secure TLS User Guide, Chapter 3.</span></span>

## <a name="authentication-methods"></a><span data-ttu-id="e5298-339">Autentiseringsmetoder</span><span class="sxs-lookup"><span data-stu-id="e5298-339">Authentication Methods</span></span>

<span data-ttu-id="e5298-340">TLS och DTLS ger ramverket för att upprätta en säker anslutning mellan två enheter över ett oskyddat nätverk, men en del av problemet är att känna till identiteten för enheten i den andra änden av anslutningen.</span><span class="sxs-lookup"><span data-stu-id="e5298-340">TLS and DTLS provide the framework for establishing a secure connection between two devices over an insecure network, but part of the problem is knowing the identity of the device on the other end of that connection.</span></span> <span data-ttu-id="e5298-341">Utan en mekanism för att autentisera identiteten för fjärranslutna värdar blir det en trivial åtgärd för en angripare att utgöra en betrodd enhet.</span><span class="sxs-lookup"><span data-stu-id="e5298-341">Without a mechanism for authenticating the identity of remote hosts, it becomes a trivial operation for an attacker to pose as a trusted device.</span></span>

<span data-ttu-id="e5298-342">Inlednings vis kan det verka som att använda IP-adresser, MAC-adresser för maskin vara eller DNS ger en relativt hög exakthet för att identifiera värdar i ett nätverk, men med tanke på vilken typ av TCP/IP-teknik som kan vara falska och vilka adresser som kan vara falska och DNS-poster skadas (t. ex. genom DNS-cachelagring av data), är det klart att TLS behöver ett extra skydd mot bedrägliga identiteter.</span><span class="sxs-lookup"><span data-stu-id="e5298-342">Initially, it may seem that using IP addresses, hardware MAC addresses, or DNS would provide a relatively high level of confidence for identifying hosts on a network, but given the nature of TCP/IP technology and the ease with which addresses can be spoofed and DNS entries corrupted (e.g. through DNS cache poisoning), it becomes clear that TLS needs an additional layer of protection against fraudulent identities.</span></span>

<span data-ttu-id="e5298-343">Det finns olika mekanismer som kan ge detta extra lager av autentisering för TLS, men det vanligaste är det *digitala certifikatet.*</span><span class="sxs-lookup"><span data-stu-id="e5298-343">There are various mechanisms that can provide this extra layer of authentication for TLS, but the most common is the *digital certificate.*</span></span> <span data-ttu-id="e5298-344">Andra mekanismer är i förväg delade nycklar (PSK) och lösen ords scheman.</span><span class="sxs-lookup"><span data-stu-id="e5298-344">Other mechanisms include Pre-Shared Keys (PSK) and password schemes.</span></span>

### <a name="digital-cerificates"></a><span data-ttu-id="e5298-345">Digital certifikat</span><span class="sxs-lookup"><span data-stu-id="e5298-345">Digital Cerificates</span></span>

<span data-ttu-id="e5298-346">Digitala certifikat är den vanligaste metoden för att autentisera en fjärran sluten värd i TLS.</span><span class="sxs-lookup"><span data-stu-id="e5298-346">Digital certificates are the most common method for authenticating a remote host in TLS.</span></span> <span data-ttu-id="e5298-347">I stort sett är ett digitalt certifikat ett dokument med en speciell formatering som ger identitets information för en enhet i ett dator nätverk.</span><span class="sxs-lookup"><span data-stu-id="e5298-347">Essentially, a digital certificate is a document with specific formatting that provides identity information for a device on a computer network.</span></span>

<span data-ttu-id="e5298-348">TLS använder normalt ett format som kallas X. 509, en standard som utvecklats av International Telecommunication union, även om andra certifikat utfärdare kan användas om TLS-värdarna kan komma överens om det format som används.</span><span class="sxs-lookup"><span data-stu-id="e5298-348">TLS normally uses a format called X.509, a standard developed by the International Telecommunication Union, though other formats of certificates may be used if the TLS hosts can agree on the format being used.</span></span> <span data-ttu-id="e5298-349">X. 509 definierar ett särskilt format för certifikat och olika kodningar som kan användas för att skapa ett digitalt dokument.</span><span class="sxs-lookup"><span data-stu-id="e5298-349">X.509 defines a specific format for certificates and various encodings that can be used to produce a digital document.</span></span> <span data-ttu-id="e5298-350">De flesta X. 509-certifikat som används med TLS kodas med hjälp av en variant av ASN. 1, en annan telekommunikations standard.</span><span class="sxs-lookup"><span data-stu-id="e5298-350">Most X.509 certificates used with TLS are encoded using a variant of ASN.1, another telecommunications standard.</span></span> <span data-ttu-id="e5298-351">I ASN. 1 finns olika digitala kodningar, men den vanligaste kodningen för TLS-certifikat är Distinguished Encoding Rules (DER) standard.</span><span class="sxs-lookup"><span data-stu-id="e5298-351">Within ASN.1 there are various digital encodings, but the most common encoding for TLS certificates is the Distinguished Encoding Rules (DER) standard.</span></span> <span data-ttu-id="e5298-352">DER är en förenklad del av de grundläggande kodnings reglerna för ASN. 1 (BER) som är utformade för att vara entydiga, vilket gör det enklare att parsa.</span><span class="sxs-lookup"><span data-stu-id="e5298-352">DER is a simplified subset of the ASN.1 Basic Encoding Rules (BER) that is designed to be unambiguous, making parsing easier.</span></span> <span data-ttu-id="e5298-353">TLS-certifikat kodas vanligt vis i binärt DER, och detta är det format som NetX säkrar för X. 509-certifikat.</span><span class="sxs-lookup"><span data-stu-id="e5298-353">Over the wire, TLS certificates are usually encoded in binary DER, and this is the format that NetX Secure expects for X.509 certificates.</span></span>

<span data-ttu-id="e5298-354">Även om DER-formaterade binära certifikat används i det faktiska TLS-protokollet kan de skapas och lagras i ett antal olika kodningar, med fil namns tillägg som. PEM,. CRT och. p12.</span><span class="sxs-lookup"><span data-stu-id="e5298-354">Though DER-formatted binary certificates are used in the actual TLS protocol, they may be generated and stored in a number of different encodings, with file extensions such as .pem, .crt, and .p12.</span></span> <span data-ttu-id="e5298-355">Olika varianter används av olika program från olika tillverkare, men alla kan ofta konverteras till DER med hjälp av mycket tillgängliga verktyg.</span><span class="sxs-lookup"><span data-stu-id="e5298-355">The different variants are used by different applications from different manufacturers, but generally all can be converted into DER using widely available tools.</span></span>

<span data-ttu-id="e5298-356">De vanligaste av de alternativa certifikat kodningarna är PEM.</span><span class="sxs-lookup"><span data-stu-id="e5298-356">The most common of the alternative certificate encodings is PEM.</span></span> <span data-ttu-id="e5298-357">PEM-formatet (från Privacy-Enhanced mail) är en Base-64-kodad version av DER-kodningen som ofta används eftersom kodningen resulterar i utskrivbar text som enkelt kan skickas via e-post eller webbaserade protokoll.</span><span class="sxs-lookup"><span data-stu-id="e5298-357">The PEM format (from Privacy-Enhanced Mail) is a base-64 encoded version of the DER encoding that is often used because the encoding results in printable text that can be easily sent using email or web-based protocols.</span></span>

<span data-ttu-id="e5298-358">Att skapa ett certifikat för ditt NetX-säkra program ligger vanligt vis utanför omfånget för den här hand boken, men kommando rads verktyget OpenSSL ([www.openssl.org](http://www.openssl.org)) är mycket tillgängligt och kan konverteras mellan de flesta format.</span><span class="sxs-lookup"><span data-stu-id="e5298-358">Generating a certificate for your NetX Secure application is generally outside the scope of this manual, but the OpenSSL command-line tool ([www.openssl.org](http://www.openssl.org)) is widely available and can convert between most formats.</span></span>

<span data-ttu-id="e5298-359">Beroende på ditt program kan du skapa egna certifikat, tillhandahålla certifikat av en tillverkare eller myndighets organisation eller köpa certifikat från en kommersiell certifikat utfärdare.</span><span class="sxs-lookup"><span data-stu-id="e5298-359">Depending on your application, you may generate your own certificates, be provided certificates by a manufacturer or government organization, or purchase certificates from a commercial certificate authority.</span></span>

<span data-ttu-id="e5298-360">Om du vill använda ett digitalt certifikat i NetX-skyddat program måste du först konvertera certifikatet till ett binärformat och eventuellt konvertera den tillhör ande privata nyckeln ("privat exponent" för RSA, till exempel) till ett binärformat, vanligt vis en PKCS # 1-formaterad, DER-kodad RSA-nyckel.</span><span class="sxs-lookup"><span data-stu-id="e5298-360">To use a digital certificate in your NetX Secure application, you must first convert your certificate into a binary DER format and, optionally, convert the associated private key (the “private exponent” for RSA, for example) into a binary format, typically a PKCS#1-formatted, DER-encoded RSA key.</span></span> <span data-ttu-id="e5298-361">När konverteringen är klar är det upp till dig att läsa in certifikatet och den privata nyckeln på enheten.</span><span class="sxs-lookup"><span data-stu-id="e5298-361">Once the conversion is complete, it is up to you to load the certificate and private key onto the device.</span></span> <span data-ttu-id="e5298-362">Möjliga alternativ är att använda ett Flash-baserat fil system eller skapa en C-matris från data (med ett verktyg som "XXD" från Linux) och kompilera certifikatet och nyckeln till ditt program som konstant data.</span><span class="sxs-lookup"><span data-stu-id="e5298-362">Possible options include using a flash-based file system or generating a C array from the data (using a tool such as “xxd” from Linux) and compiling the certificate and key into your application as constant data.</span></span>

<span data-ttu-id="e5298-363">När ditt certifikat har lästs in på enheten kan DTLS-API: et användas för att koppla certifikatet till en DTLS-session eller-server.</span><span class="sxs-lookup"><span data-stu-id="e5298-363">Once your certificate is loaded onto the device, the DTLS API can be used to associate your certificate with a DTLS session or server.</span></span>

<span data-ttu-id="e5298-364">Mer information och exempel på hur du använder X. 509-certifikat med NetX Secure DTLS finns i avsnittet "Importera X. 509-certifikat till NetX Secure" i användar handboken för NetX Secure TLS.</span><span class="sxs-lookup"><span data-stu-id="e5298-364">For details and examples on how to use X.509 certificates with NetX Secure DTLS, see the section “Importing X.509 certificates into NetX Secure” in the NetX Secure TLS User Guide.</span></span>

<span data-ttu-id="e5298-365">Mer information hittar du i följande DTLS-tjänster i API-referensen:</span><span class="sxs-lookup"><span data-stu-id="e5298-365">Refer to the following DTLS services in the API reference for more information:</span></span>

- <span data-ttu-id="e5298-366">nx_secure_x509_certificate_initialize,</span><span class="sxs-lookup"><span data-stu-id="e5298-366">nx_secure_x509_certificate_initialize,</span></span>
- <span data-ttu-id="e5298-367">nx_secure_dtls_session_local_certificate_add,</span><span class="sxs-lookup"><span data-stu-id="e5298-367">nx_secure_dtls_session_local_certificate_add,</span></span>
- <span data-ttu-id="e5298-368">nx_secure_dtls_server_local_certificate_add,</span><span class="sxs-lookup"><span data-stu-id="e5298-368">nx_secure_dtls_server_local_certificate_add,</span></span>
- <span data-ttu-id="e5298-369">nx_secure_dtls_session_local_certificate_remove,</span><span class="sxs-lookup"><span data-stu-id="e5298-369">nx_secure_dtls_session_local_certificate_remove,</span></span>
- <span data-ttu-id="e5298-370">nx_secure_dtls_server_local_certificate_remove,</span><span class="sxs-lookup"><span data-stu-id="e5298-370">nx_secure_dtls_server_local_certificate_remove,</span></span>
- <span data-ttu-id="e5298-371">nx_secure_dtls_session_trusted_certificate_add,</span><span class="sxs-lookup"><span data-stu-id="e5298-371">nx_secure_dtls_session_trusted_certificate_add,</span></span>
- <span data-ttu-id="e5298-372">nx_secure_dtls_server_trusted_certificate_add,</span><span class="sxs-lookup"><span data-stu-id="e5298-372">nx_secure_dtls_server_trusted_certificate_add,</span></span>
- <span data-ttu-id="e5298-373">nx_secure_dtls_session_trusted_certificate_remove</span><span class="sxs-lookup"><span data-stu-id="e5298-373">nx_secure_dtls_session_trusted_certificate_remove</span></span>
- <span data-ttu-id="e5298-374">nx_secure_dtls_server_trusted_certificate_remove</span><span class="sxs-lookup"><span data-stu-id="e5298-374">nx_secure_dtls_server_trusted_certificate_remove</span></span>

### <a name="tls-client-certificate-specifics"></a><span data-ttu-id="e5298-375">Certifikats information för TLS-klient</span><span class="sxs-lookup"><span data-stu-id="e5298-375">TLS Client Certificate Specifics</span></span>

<span data-ttu-id="e5298-376">DTLS-klientens implementeringar kräver vanligt vis inte att ett lokalt certifikat ska läsas in på enheten.</span><span class="sxs-lookup"><span data-stu-id="e5298-376">DTLS Client implementations generally do not require a local certificate to be loaded onto the device.</span></span> <span data-ttu-id="e5298-377">Ett lokalt certifikat är ett certifikat som identifierar den lokala enheten.</span><span class="sxs-lookup"><span data-stu-id="e5298-377">A local certificate is a certificate that identifies the local device.</span></span> <span data-ttu-id="e5298-378">Mer specifikt ger ett lokalt certifikat identitets information för den enhet som TLS/DTLS-programmet har lästs in på.</span><span class="sxs-lookup"><span data-stu-id="e5298-378">Specifically, a local certificate provides identity information for the device upon which the TLS/DTLS application is loaded.</span></span> <span data-ttu-id="e5298-379">Undantaget till detta är när autentisering av klient certifikat är aktiverat, men detta är mindre vanligt.</span><span class="sxs-lookup"><span data-stu-id="e5298-379">The exception to this is when Client Certificate Authentication is enabled, but this is less common.</span></span>

<span data-ttu-id="e5298-380">En DTLS-klient kräver att minst ett betrott certifikat läses in (mer kan läsas in om det behövs) och att ett fjärrcertifikat ska tilldelas.</span><span class="sxs-lookup"><span data-stu-id="e5298-380">A DTLS Client requires at least one trusted certificate to be loaded (more may be loaded if required), and space for a remote certificate to be allocated.</span></span> <span data-ttu-id="e5298-381">Ett betrott certifikat är ett certifikat som tillhandahåller en grund för förtroende och autentisering av fjär renheten, antingen direkt eller via en PKI (Public Key Infrastructure).</span><span class="sxs-lookup"><span data-stu-id="e5298-381">A trusted certificate is a certificate that provides a basis for trust and authentication of the remote device, either directly or through a Public Key Infrastructure (PKI).</span></span> <span data-ttu-id="e5298-382">Roten i förtroende kedjan kallas vanligt vis för en certifikat utfärdare eller CA-certifikat.</span><span class="sxs-lookup"><span data-stu-id="e5298-382">The root of the chain of trust is usually called a Certification Authority or CA certificate.</span></span> <span data-ttu-id="e5298-383">Ett fjärrcertifikat syftar på det certifikat som skickas av fjärrvärden under TLS-handskakningen.</span><span class="sxs-lookup"><span data-stu-id="e5298-383">A remote certificate refers to the certificate sent by the remote host during the TLS handshake.</span></span> <span data-ttu-id="e5298-384">Den ger identitet för den fjärranslutna värden och autentiseras genom att jämföra den med ett betrott certifikat på den lokala enheten.</span><span class="sxs-lookup"><span data-stu-id="e5298-384">It provides identity for that remote host and is authenticated by comparing it to a trusted certificate on the local device.</span></span>

<span data-ttu-id="e5298-385">Mer information om hur du lägger till betrodda certifikat och hur du allokerar utrymme för fjärrcertifikat finns i TLS API-referensen för följande tjänster: nx_secure_dtls_session_create nx_secure_dtls_session_trusted_certificate_add.</span><span class="sxs-lookup"><span data-stu-id="e5298-385">For more information on adding trusted certificates and allocating space for remote certificates, see the TLS API reference for the following services: nx_secure_dtls_session_create, nx_secure_dtls_session_trusted_certificate_add.</span></span>

### <a name="tlsdtls-server-certificate-specifics"></a><span data-ttu-id="e5298-386">TLS/DTLS Server-certifikat information</span><span class="sxs-lookup"><span data-stu-id="e5298-386">TLS/DTLS Server Certificate Specifics</span></span>

<span data-ttu-id="e5298-387">DTLS Server-implementeringar kräver vanligt vis inte "betrodda" certifikat att läsas in på enheten eller fjärrcertifikaten som ska allokeras.</span><span class="sxs-lookup"><span data-stu-id="e5298-387">DTLS Server implementations generally do not require “trusted” certificates to be loaded onto the device or remote certificates to be allocated.</span></span> <span data-ttu-id="e5298-388">Det här undantaget är när autentisering av klient certifikat är aktiverat.</span><span class="sxs-lookup"><span data-stu-id="e5298-388">The exception to this being when Client Certificate Authentication is enabled.</span></span>

<span data-ttu-id="e5298-389">En TLS-server kräver att ett "lokalt" certifikat (eller "identitets certifikat)" läses in så att servern kan ge den till fjärrklienten under TLS-handskakningen för att autentisera servern för klienten.</span><span class="sxs-lookup"><span data-stu-id="e5298-389">A TLS Server requires a “local” (or “identity”) certificate to be loaded so the server can provide it to the remote client during the TLS handshake to authenticate the server to the client.</span></span>

<span data-ttu-id="e5298-390">Mer information om hur du läser in lokala certifikat för användning med NetX TLS server-program finns i API-referensen för följande tjänster: nx_secure_dtls_server_local_certificate_add nx_secure_dtls_server_local_certificate_remove.</span><span class="sxs-lookup"><span data-stu-id="e5298-390">For more information about loading local certificates for use with NetX TLS server applications, see the API reference for the following services: nx_secure_dtls_server_local_certificate_add, nx_secure_dtls_server_local_certificate_remove.</span></span>


### <a name="pre-shared-keys-psk"></a><span data-ttu-id="e5298-391">I förväg delade nycklar (PSK)</span><span class="sxs-lookup"><span data-stu-id="e5298-391">Pre-Shared Keys (PSK)</span></span>

<span data-ttu-id="e5298-392">En alternativ mekanism för att tillhandahålla identifierings autentisering i TLS är begreppet i förväg delade nycklar (PSK).</span><span class="sxs-lookup"><span data-stu-id="e5298-392">An alternative mechanism for providing identification authentication in TLS is the notion of Pre-Shared Keys (PSK).</span></span> <span data-ttu-id="e5298-393">Om du använder en PSK-ciphersuite elimineras behovet av att utföra processor intensiva krypterings åtgärder för offentliga nycklar, en Boon för resurs begränsade inbäddade enheter.</span><span class="sxs-lookup"><span data-stu-id="e5298-393">Using a PSK ciphersuite removes the need to do the processor-intensive public-key encryption operations, a boon for resource-constrained embedded devices.</span></span> <span data-ttu-id="e5298-394">PSK ersätter certifikatet i TLS/DTLS-handskakningen och används i stället för den krypterade huvud repliken för generering av TLS/DTLS-sessionsnycklar.</span><span class="sxs-lookup"><span data-stu-id="e5298-394">The PSK replaces the certificate in the TLS/DTLS handshake and is used in place of the encrypted Pre-Master Secret for TLS/DTLS session key generation.</span></span>

<span data-ttu-id="e5298-395">PSK-krypteringssviter är begränsade i den mening att en delad hemlighet måste finnas på båda enheterna innan en TLS/DTLS-session kan upprättas.</span><span class="sxs-lookup"><span data-stu-id="e5298-395">The PSK ciphersuites are limited in the sense that that a shared secret must be present on both devices before a TLS/DTLS session can be established.</span></span> <span data-ttu-id="e5298-396">Det innebär att enheterna måste ha lästs in med den hemligheten med hjälp av ett säkert sätt än en TLS PSK-anslutning – PSKs kan uppdateras via en TLS PSK-anslutning, men enheten måste nödvändigt vis börja med en PSK som läses in via någon annan mekanism.</span><span class="sxs-lookup"><span data-stu-id="e5298-396">This means that the devices must have been loaded with that secret using some secure means other than a TLS PSK connection - PSKs may be updated over a TLS PSK connection, but the device must necessarily start with a PSK that is loaded through some other mechanism.</span></span> <span data-ttu-id="e5298-397">Till exempel kan en sensor enhet och dess gateway-enhet läsas in med PSKs i fabriken innan det levereras, eller en standard-TLS-anslutning (med ett certifikat) kan användas för att läsa in PSK.</span><span class="sxs-lookup"><span data-stu-id="e5298-397">For example, a sensor device and its gateway device could be loaded with PSKs in the factory before shipping, or a standard TLS connection (with a certificate) could be used to load the PSK.</span></span>

<span data-ttu-id="e5298-398">PSK-krypteringssviter levereras i ett par formulär som beskrivs i RFC 4279.</span><span class="sxs-lookup"><span data-stu-id="e5298-398">PSK ciphersuites come in a couple of forms, described in RFC 4279.</span></span> <span data-ttu-id="e5298-399">Först används RSA-eller Diffie-Hellman nycklar som används på samma sätt som de offentliga nycklar som skickas i certifikatet i standard-TLS-handskakning.</span><span class="sxs-lookup"><span data-stu-id="e5298-399">The first uses RSA or Diffie-Hellman keys which are used in the same manner as the public keys transmitted in the certificate in standard TLS handshakes.</span></span> <span data-ttu-id="e5298-400">Det andra formuläret, som används i en resurs begränsad miljö, använder en PSK som används för att direkt generera sessionsnycklar (för användning av AES, till exempel), så att du undviker användningen av dyra RSA-eller Diffie-Hellman-åtgärder.</span><span class="sxs-lookup"><span data-stu-id="e5298-400">The second form, which is of more use in a resource-constrained environment, uses a PSK that is used to directly generate the session keys (for use by AES, for example), avoiding the use of the expensive RSA or Diffie-Hellman operations.</span></span>

<span data-ttu-id="e5298-401">NetX Secure stöder den andra formen av PSK-krypteringssviter, vilket gör det möjligt för program att ta bort all krypterings kod för offentliga nycklar och minnes användning.</span><span class="sxs-lookup"><span data-stu-id="e5298-401">NetX Secure supports the second form of PSK ciphersuites, enabling applications to remove all public-key cryptography code and memory usage.</span></span> <span data-ttu-id="e5298-402">Själva PSK är inte en AES-nyckel, men kan anses som ett lösen ord som de faktiska nycklarna genereras från.</span><span class="sxs-lookup"><span data-stu-id="e5298-402">The PSK itself is not an AES key, but can be considered as being more like a password from which the actual keys are generated.</span></span> <span data-ttu-id="e5298-403">Det finns några begränsningar för vad PSK-värdet kan vara, även om längre värden ger högre säkerhet (samma som med lösen ord).</span><span class="sxs-lookup"><span data-stu-id="e5298-403">There are few restrictions on what the PSK value can be, though longer values will provide more security (same as with passwords).</span></span>

<span data-ttu-id="e5298-404">Om du vill använda PSK med ditt NetX-säkra program måste du först definiera det globala makrot **NX_SECURE_ENABLE_PSK_CIPHERSUITES**.</span><span class="sxs-lookup"><span data-stu-id="e5298-404">To use PSK with your NetX Secure application, you must first define the global macro **NX_SECURE_ENABLE_PSK_CIPHERSUITES**.</span></span> <span data-ttu-id="e5298-405">Detta görs vanligt vis via dina kompilator inställningar, men definitionen kan också placeras i huvud filen nx_secure_tls. h.</span><span class="sxs-lookup"><span data-stu-id="e5298-405">This is usually done through your compiler settings, but the definition can also be placed in the nx_secure_tls.h header file.</span></span> <span data-ttu-id="e5298-406">Med det definierade makrot kommer PSK ciphersuite-stödet att kompileras till ditt NetX-säkra DTLS-program.</span><span class="sxs-lookup"><span data-stu-id="e5298-406">With the macro defined, PSK ciphersuite support will be compiled into your NetX Secure DTLS application.</span></span>

<span data-ttu-id="e5298-407">När PSK-stödet är aktiverat kan du använda DTLS-API: et för att konfigurera PSKs för ditt program.</span><span class="sxs-lookup"><span data-stu-id="e5298-407">With PSK support enabled, you can then use the DTLS API to set up PSKs for your application.</span></span> <span data-ttu-id="e5298-408">Varje PSK kräver ett PSK-värde (den faktiska hemliga nyckeln "– Behåll det här värdet säkert), ett" Identity "-värde som används för att identifiera specifika PSK och ett" identitets tips "som används av en TLS-server för att välja ett visst PSK-värde.</span><span class="sxs-lookup"><span data-stu-id="e5298-408">Each PSK will require a PSK value (the actual secret “key” – keep this value safe), an “identity” value used to identify the specific PSK, and an “identity hint” that is used by a TLS server to choose a particular PSK value.</span></span>

<span data-ttu-id="e5298-409">Själva PSK-objektet kan vara ett binärt värde eftersom det aldrig skickas via en nätverks anslutning.</span><span class="sxs-lookup"><span data-stu-id="e5298-409">The PSK itself can be any binary value as it is never sent over a network connection.</span></span> <span data-ttu-id="e5298-410">PSK kan vara valfritt värde upp till 64 byte långt.</span><span class="sxs-lookup"><span data-stu-id="e5298-410">The PSK can be any value up to 64 bytes in length.</span></span>

<span data-ttu-id="e5298-411">Identiteten och tipset måste vara utskrivbara sträng strängar formaterade med UTF-8.</span><span class="sxs-lookup"><span data-stu-id="e5298-411">The identity and hint must be printable character strings formatted using UTF-8.</span></span> <span data-ttu-id="e5298-412">Värdena för identitet och ledtråd kan vara en valfri längd på upp till 128 byte.</span><span class="sxs-lookup"><span data-stu-id="e5298-412">The identity and hint values may be any length up to 128 bytes.</span></span>

<span data-ttu-id="e5298-413">Identiteten och PSK-formen bildar ett unikt par som läses in på varje enhet i nätverket som behöver kommunicera med varandra.</span><span class="sxs-lookup"><span data-stu-id="e5298-413">The identity and PSK form a unique pair that is loaded onto every device in the network that need to communicate with one another.</span></span>

<span data-ttu-id="e5298-414">"Tipset" används främst för att definiera specifika program profiler för att gruppera PSKs efter funktion eller tjänst.</span><span class="sxs-lookup"><span data-stu-id="e5298-414">The “hint” is primarily used for defining specific application profiles to group PSKs by function or service.</span></span> <span data-ttu-id="e5298-415">Dessa värden måste överenskommas i förväg och är beroende av program.</span><span class="sxs-lookup"><span data-stu-id="e5298-415">These values must be agreed upon in advance and are application dependent.</span></span> <span data-ttu-id="e5298-416">Som exempel använder OpenSSL kommando rads serverprogram (med PSK aktiverat) standard strängen "Client_identity", som måste tillhandahållas av en TLS-klient för att kunna fortsätta med TLS-handskakningen.</span><span class="sxs-lookup"><span data-stu-id="e5298-416">As an example, the OpenSSL command-line server application (with PSK enabled) uses the default string “Client_identity”, which must be provided by a TLS client in order to continue with the TLS handshake.</span></span>

<span data-ttu-id="e5298-417">Mer information om PSKs finns i NetX Secure API-referens för följande tjänster: nx_secure_dtls_psk_add nx_secure_dtls_server_psk_add.</span><span class="sxs-lookup"><span data-stu-id="e5298-417">For more information on PSKs, see the NetX Secure API reference for the following services: nx_secure_dtls_psk_add, nx_secure_dtls_server_psk_add.</span></span>

## <a name="importing-x509-certificates-into-netx-secure"></a><span data-ttu-id="e5298-418">Importerar X. 509-certifikat till NetX Secure</span><span class="sxs-lookup"><span data-stu-id="e5298-418">Importing X.509 certificates into NetX Secure</span></span>

<span data-ttu-id="e5298-419">Digitala certifikat krävs för de flesta TLS-anslutningar på Internet.</span><span class="sxs-lookup"><span data-stu-id="e5298-419">Digital certificates are required for most TLS connections on the Internet.</span></span> <span data-ttu-id="e5298-420">Certifikat ger en metod för att autentisera tidigare okända värdar via Internet genom användning av betrodda mellanhänder, vanligt vis kallade *certifikat utfärdare eller certifikat* utfärdare.</span><span class="sxs-lookup"><span data-stu-id="e5298-420">Certificates provide a method for authenticating previously unknown hosts over the Internet through the use of trusted intermediaries, usually called *Certificate Authorities* or CAs.</span></span> <span data-ttu-id="e5298-421">Om du vill ansluta din NetX-enhet till en kommersiell moln tjänst (till exempel Amazon Web Services) måste du importera certifikat till ditt program genom att läsa in dem på enheten.</span><span class="sxs-lookup"><span data-stu-id="e5298-421">To connect your NetX Secure device with a commercial cloud service (such as Amazon Web Services), you will need to import certificates into your application by loading them onto your device.</span></span>

<span data-ttu-id="e5298-422">Tillsammans med certifikat behöver du ibland även en *privat nyckel* som är kopplad till ditt certifikat.</span><span class="sxs-lookup"><span data-stu-id="e5298-422">Along with certificates, you will also sometimes need a *private key* that is associated with your certificate.</span></span> <span data-ttu-id="e5298-423">I vissa program (t. ex. TLS-klient när autentisering av klient certifikat används inte) är certifikatet tillräckligt, men om ditt certifikat används för att identifiera din enhet behöver du en privat nyckel.</span><span class="sxs-lookup"><span data-stu-id="e5298-423">In some applications (such as TLS Client when Client Certificate Authentication is not being used) the certificate alone will be sufficient, but if your certificate is being used to identify your device you will need a private key.</span></span> <span data-ttu-id="e5298-424">Privata nycklar skapas vanligt vis när du skapar ditt certifikat och lagras i en separat fil, ofta krypterat med ett lösen ord.</span><span class="sxs-lookup"><span data-stu-id="e5298-424">Private keys are typically generated when you create your certificate and are stored in a separate file, often encrypted with a password.</span></span>

<span data-ttu-id="e5298-425">En detaljerad beskrivning av hur du importerar certifikat till NetX-säkra program finns i kapitel 3 i användar handboken för NetX Secure TLS.</span><span class="sxs-lookup"><span data-stu-id="e5298-425">For a detailed description of importing certificates into NetX Secure applications, please refer to Chapter 3 in the NetX Secure TLS User Guide.</span></span>

## <a name="client-certificate-authentication-in-netx-secure-tls"></a><span data-ttu-id="e5298-426">Autentisering av klient certifikat i NetX Secure TLS</span><span class="sxs-lookup"><span data-stu-id="e5298-426">Client Certificate Authentication in NetX Secure TLS</span></span>

<span data-ttu-id="e5298-427">När du använder autentisering med X. 509-certifikat kräver TLS/DTLS-protokollet att DTLS-serverinstansen ger ett certifikat för identifiering, men som standard behöver DTLS-klient instansen inte tillhandahålla ett certifikat för autentisering med hjälp av en annan form av autentisering i stället (t. ex. en kombination av användar namn/lösen ord).</span><span class="sxs-lookup"><span data-stu-id="e5298-427">When using X.509 certificate authentication, the TLS/DTLS protocol requires that the DTLS Server instance provide a certificate for identification, but by default the DTLS Client instance does not need to provide a certificate for authentication, using another form of authentication instead (e.g. a username/password combination).</span></span> <span data-ttu-id="e5298-428">Detta matchar den vanligaste användningen av TLS på Internet för webbplatser.</span><span class="sxs-lookup"><span data-stu-id="e5298-428">This matches the most common use of TLS on the Internet for Web sites.</span></span> <span data-ttu-id="e5298-429">Till exempel måste en detaljist webbplats bevisa för en potentiell kund som använder en webbläsare som servern är legitim, men användaren använder ett inloggnings-/lösen ord för att få åtkomst till ett speciellt konto.</span><span class="sxs-lookup"><span data-stu-id="e5298-429">For example, an online retail site must prove to a potential customer using a web browser that the server is legitimate, but the user will use a login/password to access a specific account.</span></span>

<span data-ttu-id="e5298-430">Standard fallet är dock inte alltid önskvärt, så TLS/DTLS kan också tillåta att DTLS-serverinstansen begär ett certifikat från fjärrklienten.</span><span class="sxs-lookup"><span data-stu-id="e5298-430">However, the default case is not always desirable, so TLS/DTLS optionally allows for the DTLS Server instance to request a certificate from the remote Client.</span></span> <span data-ttu-id="e5298-431">När den här funktionen är aktive rad skickar DTLS-servern ett CertificateRequest-meddelande till DTLS-klienten under hand skakningen.</span><span class="sxs-lookup"><span data-stu-id="e5298-431">When this feature is enabled, the DTLS Server will send a CertificateRequest message to the DTLS Client during the handshake.</span></span> <span data-ttu-id="e5298-432">Klienten måste svara med ett eget certifikat och ett CertificateVerify-meddelande som innehåller en kryptografisk token som styrker att klienten äger den matchande privata nyckeln som är kopplad till certifikatet.</span><span class="sxs-lookup"><span data-stu-id="e5298-432">The Client must respond with a certificate of its own and a CertificateVerify message which contains a cryptographic token proving that the Client owns the matching private key associated with that certificate.</span></span> <span data-ttu-id="e5298-433">Om verifieringen Miss lyckas eller om certifikatet inte är anslutet till ett betrott certifikat på servern Miss lyckas TLS-handskakningen.</span><span class="sxs-lookup"><span data-stu-id="e5298-433">If the verification fails or the certificate is not connected to a trusted certificate on the Server, the TLS handshake fails.</span></span>

<span data-ttu-id="e5298-434">Det finns två separata fall för autentisering av klient certifikat i TLS – följande avsnitt beskriver båda fallen.</span><span class="sxs-lookup"><span data-stu-id="e5298-434">There are two separate cases for Client Certificate Authentication in TLS – the following sections cover both cases.</span></span>

### <a name="client-certificate-authentication-for-dtls-clients"></a><span data-ttu-id="e5298-435">Autentisering av klient certifikat för DTLS-klienter</span><span class="sxs-lookup"><span data-stu-id="e5298-435">Client Certificate Authentication for DTLS Clients</span></span>

<span data-ttu-id="e5298-436">En DTLS-klient kan försöka ansluta till en server som begär ett certifikat för klientautentisering.</span><span class="sxs-lookup"><span data-stu-id="e5298-436">A DTLS Client may attempt a connection to a server that requests a certificate for client authentication.</span></span> <span data-ttu-id="e5298-437">I det här fallet måste klienten ange ett certifikat för servern och kontrol lera att den äger den matchande privata nyckeln eller att servern avslutar DTLS-handskakningen.</span><span class="sxs-lookup"><span data-stu-id="e5298-437">In this case the Client must provide a certificate to the server and verify that it owns the matching private key or the Server will terminate the DTLS handshake.</span></span>

<span data-ttu-id="e5298-438">I NetX Secure DTLS finns det ingen särskild konfiguration som stöder den här funktionen, men programmet måste ange ett lokalt identifierings certifikat för TLS-klientcertifikatet med hjälp av tjänsten *nx_secure_tls_session_local_certificate_add* .</span><span class="sxs-lookup"><span data-stu-id="e5298-438">In NetX Secure DTLS, there is no special configuration to support this feature but the application will have to provide a local identification certificate for the TLS Client instance using the *nx_secure_tls_session_local_certificate_add* service.</span></span> <span data-ttu-id="e5298-439">Om inget certifikat tillhandahålls av programmet men fjärrservern använder autentisering av klient certifikat och begär ett certifikat, kommer DTLS-handskakningen att Miss läge.</span><span class="sxs-lookup"><span data-stu-id="e5298-439">If no certificate is provided by the application but the remote server is using Client Certificate Authentication and requests a certificate, the DTLS handshake will fail.</span></span> <span data-ttu-id="e5298-440">Det certifikat som angavs för DTLS-sessionen med *nx_secure_dtls_session_local_certificate_add* måste identifieras av fjärrservern för att DTLS-handskakningen ska kunna slutföras.</span><span class="sxs-lookup"><span data-stu-id="e5298-440">The certificate provided to the DTLS Session with *nx_secure_dtls_session_local_certificate_add* must be recognized by the remote server in order to complete the DTLS handshake.</span></span>

### <a name="client-certificate-authentication-for-tls-servers"></a><span data-ttu-id="e5298-441">Autentisering av klient certifikat för TLS-servrar</span><span class="sxs-lookup"><span data-stu-id="e5298-441">Client Certificate Authentication for TLS Servers</span></span>

<span data-ttu-id="e5298-442">DTLS-serverns fall för autentisering av klient certifikat är något mer komplicerat än DTLS-klientens fall på grund av att funktionen är valfri.</span><span class="sxs-lookup"><span data-stu-id="e5298-442">The DTLS Server case for Client Certificate Authentication is slightly more complex than the DTLS Client case due to the feature being optional.</span></span> <span data-ttu-id="e5298-443">I det här fallet måste TLS-servern uttryckligen begära ett certifikat från fjärr-TLS-klienten, sedan bearbeta CertificateVerify-meddelandet för att verifiera att den fjärranslutna klienten äger den matchande privata nyckeln och servern måste kontrol lera att det certifikat som tillhandahålls av klienten kan spåras till ett certifikat i det lokala betrodda certifikat arkivet.</span><span class="sxs-lookup"><span data-stu-id="e5298-443">In this case, the TLS Server needs to specifically request a certificate from the remote TLS Client, then process the CertificateVerify message to verify that the remote Client owns the matching private key, and then the Server must check that the certificate provided by the Client can be traced to a certificate in the local trusted certificate store.</span></span>

<span data-ttu-id="e5298-444">I NetX Secure TLS Server-instanser kontrol leras klient certifikatets autentisering av *nx_secure_dtls_server_x509_client_verify_configure* -och *nx_secure_dtls_server_x509_client_verify_disable* -tjänsterna.</span><span class="sxs-lookup"><span data-stu-id="e5298-444">In NetX Secure TLS Server instances, Client Certificate Authentication is controlled by the *nx_secure_dtls_server_x509_client_verify_configure* and *nx_secure_dtls_server_x509_client_verify_disable* services.</span></span>

<span data-ttu-id="e5298-445">Om du vill aktivera autentisering av klient certifikat måste ett program anropa *nx_secure_dtls_server_x509_client_verify_configure* med DTLS innan du anropar *nx_secure_dtls_server_start*.</span><span class="sxs-lookup"><span data-stu-id="e5298-445">To enable Client Certificate Authentication, an application must call *nx_secure_dtls_server_x509_client_verify_configure* with the DTLS Server session instance before calling *nx_secure_dtls_server_start*.</span></span> <span data-ttu-id="e5298-446">Verifieringen kräver att utrymme allokeras för inkommande klient certifikat som anges som en parameter för att *nx_secure_dtls_server_x509_client_verify_configure.*</span><span class="sxs-lookup"><span data-stu-id="e5298-446">The verification requires space to be allocated for incoming client certificates which is provided as a parameter to *nx_secure_dtls_server_x509_client_verify_configure.*</span></span> <span data-ttu-id="e5298-447">Observera att bufferten måste vara tillräckligt stor för att rymma den högsta certifikat kedja som tillhandahålls av en klient *gånger antalet DTLS Server-sessioner*.</span><span class="sxs-lookup"><span data-stu-id="e5298-447">Note that the buffer must be large enough to hold the maximum-size certificate chain provided by a client *times the number of DTLS server sessions*.</span></span> <span data-ttu-id="e5298-448">Varje server session kräver utrymme som kommer att allokeras från den angivna bufferten.</span><span class="sxs-lookup"><span data-stu-id="e5298-448">Each server session requires space which will be allocated from the single provided buffer.</span></span> <span data-ttu-id="e5298-449">Kontrol lera att bufferten är tillräckligt stor eller att det uppstår ett fel om den angivna klient certifikat kedjan är för stor.</span><span class="sxs-lookup"><span data-stu-id="e5298-449">Make sure the buffer is large enough or an error will occur if the provided Client certificate chain is too large.</span></span>

<span data-ttu-id="e5298-450">När autentisering av klient certifikat är aktiverat kommer DTLS-servern begära ett certifikat från DTLS-klienten under DTLS-handskakningen.</span><span class="sxs-lookup"><span data-stu-id="e5298-450">When Client Certificate Authentication is enabled, the DTLS Server will request a certificate from the remote DTLS Client during the DTLS handshake.</span></span> <span data-ttu-id="e5298-451">I NetX Secure DTLS-servern kontrol leras klient certifikatet mot arkivet med betrodda certifikat som skapats med *nx_secure_dtls_server_trusted_certificate_add* genom att följa kedjan för X. 509-utfärdaren.</span><span class="sxs-lookup"><span data-stu-id="e5298-451">In NetX Secure DTLS Server, the Client certificate is checked against the store of trusted certificates created with *nx_secure_dtls_server_trusted_certificate_add* by following the X.509 issuer chain.</span></span> <span data-ttu-id="e5298-452">Fjärrklienten måste ange en kedja som ansluter sitt identitets certifikat till ett certifikat i det betrodda arkivet eller så Miss DTLS-handskakningen.</span><span class="sxs-lookup"><span data-stu-id="e5298-452">The remote Client must provide a chain that connects its identity certificate to a certificate in the trusted store or the DTLS handshake will fail.</span></span> <span data-ttu-id="e5298-453">Även om bearbetningen av CertificateVerify-meddelanden Miss lyckas kommer DTLS-handskakningen att Miss lyckas.</span><span class="sxs-lookup"><span data-stu-id="e5298-453">Additionally, if the CertificateVerify message processing fails, the DTLS handshake will also fail.</span></span>

<span data-ttu-id="e5298-454">De autentiseringsmetoder som används för metoden CertificateVerify är fasta för TLS version 1,0 och TLS-version 1,1 och anges av TLS-servern i TLS version 1,2, då NetX Secure DTLS är baserad.</span><span class="sxs-lookup"><span data-stu-id="e5298-454">The signature methods used for the CertificateVerify method are fixed for TLS version 1.0 and TLS version 1.1, and are specified by the TLS Server in TLS version 1.2, upon which NetX Secure DTLS is based.</span></span> <span data-ttu-id="e5298-455">För DTLS 1,2 följer de autentiseringsmetoder som stöds vanligt vis de relevanta metoder som anges i tabellen med kryptografiska metoder, men vanligt vis RSA med SHA-256 (se avsnittet "kryptografi i NetX Secure TLS" för mer information om att initiera TLS med kryptografiska metoder).</span><span class="sxs-lookup"><span data-stu-id="e5298-455">For DTLS 1.2, the signature methods supported generally follow the relevant methods supplied in the cryptographic method table, but typically RSA with SHA-256 (see the section “Cryptography in NetX Secure TLS” for more information on initializing TLS with cryptographic methods).</span></span>

## <a name="cryptography-in-netx-secure-tls"></a><span data-ttu-id="e5298-456">Kryptografi i NetX Secure TLS</span><span class="sxs-lookup"><span data-stu-id="e5298-456">Cryptography in NetX Secure TLS</span></span>

<span data-ttu-id="e5298-457">TLS definierar ett protokoll där kryptografi kan användas för att skydda nätverkskommunikation.</span><span class="sxs-lookup"><span data-stu-id="e5298-457">TLS defines a protocol in which cryptography can be used to secure network communications.</span></span> <span data-ttu-id="e5298-458">Därför lämnar den den faktiska kryptografin att använda ganska stor öppen för TLS-användare.</span><span class="sxs-lookup"><span data-stu-id="e5298-458">As such, it leaves the actual cryptography to be used fairly wide open for TLS users.</span></span> <span data-ttu-id="e5298-459">För specifikationen krävs bara att en enda ciphersuite implementeras – i händelse av TLS 1,2 är ciphersuite TLS_RSA_WITH_AES_128_CBC_SHA, vilket indikerar användningen av RSA för offentliga nyckel åtgärder, AES i CBC-läge med 128-bitars nycklar för sessions kryptering och SHA-1 för hash-meddelanden för meddelandeautentisering.</span><span class="sxs-lookup"><span data-stu-id="e5298-459">The specification only requires a single ciphersuite to be implemented – in the case of TLS 1.2, that ciphersuite is TLS_RSA_WITH_AES_128_CBC_SHA, indicating the use of RSA for public-key operations, AES in CBC mode with 128-bit keys for session encryption, and SHA-1 for message authentication hashes.</span></span>

<span data-ttu-id="e5298-460">Som standard är TLS 1,2-kompatibel och den obligatoriska TLS_RSA_WITH_AES_128_CBC_SHA ciphersuite som standard, men med tanke på antalet möjliga implementeringar för var och en av de kryptografiska metoderna på grund av maskin varu funktioner och andra överväganden, är NetX Secure en allmän krypterings-API som gör att en användare kan ange vilka kryptografiska metoder som ska användas med TLS.</span><span class="sxs-lookup"><span data-stu-id="e5298-460">Being TLS 1.2-compliant, NetX Secure enables the mandatory TLS_RSA_WITH_AES_128_CBC_SHA ciphersuite by default, but given the number of possible implementations for each of the cryptographic methods due to hardware capabilities and other considerations, NetX Secure provides a generic cryptographic API that allows a user to specify which cryptographic methods to use with TLS.</span></span>

> [!NOTE]
> <span data-ttu-id="e5298-461">Med den allmänna kryptografiska API-mekanismen kan användare implementera sina egna krypteringssviter, men detta rekommenderas för avancerade användare som är bekanta med TLS-krypteringssviter och-tillägg.</span><span class="sxs-lookup"><span data-stu-id="e5298-461">The generic cryptographic API mechanism also allows users to implement their own ciphersuites, but this is recommended for advanced users who are familiar with the TLS ciphersuites and extensions.</span></span> <span data-ttu-id="e5298-462">Kontakta din uttryckliga Logic-representant om du är intresse rad av att stödja din egen krypteringssviter.</span><span class="sxs-lookup"><span data-stu-id="e5298-462">Please contact your Express Logic representative if you are interested in supporting your own ciphersuites.</span></span>

<span data-ttu-id="e5298-463">Mer information om hur du konfigurerar kryptografiska metoder för DTLS finns i NetX Secure TLS user guide, kapitel 3.</span><span class="sxs-lookup"><span data-stu-id="e5298-463">Please see the NetX Secure TLS User Guide, Chapter 3 for a detailed discussion about how to configure cryptographic methods for DTLS.</span></span> <span data-ttu-id="e5298-464">Samma process gäller både TLS-och DTLS.</span><span class="sxs-lookup"><span data-stu-id="e5298-464">The same process applies to both TLS and DTLS.</span></span>
