---
title: Kapitel 3 – Beskrivning av internt tjänst-cache
description: 'NetX Duo mDNS-modulen hanterar två interna tjänst-cacheminnen: den lokala tjänstecachen och peer-tjänstecache.'
author: philmea
ms.author: philmea
ms.date: 07/09/2020
ms.topic: article
ms.service: rtos
ms.openlocfilehash: 007f1080a076730cfbcdedc9f063ac0c427a414c
ms.sourcegitcommit: e3d42e1f2920ec9cb002634b542bc20754f9544e
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 03/22/2021
ms.locfileid: "104825914"
---
# <a name="chapter-3---description-of-internal-service-cache"></a><span data-ttu-id="6c4f9-103">Kapitel 3 – Beskrivning av internt tjänst-cache</span><span class="sxs-lookup"><span data-stu-id="6c4f9-103">Chapter 3 - Description of internal service cache</span></span>

<span data-ttu-id="6c4f9-104">NetX Duo mDNS-modulen hanterar två interna tjänst-cacheminnen: den lokala tjänstecachen och peer-tjänstecache.</span><span class="sxs-lookup"><span data-stu-id="6c4f9-104">NetX Duo mDNS module manages two internal services caches: the local service cache, and the peer service cache.</span></span> <span data-ttu-id="6c4f9-105">I cachen för lokal tjänst lagras resurs poster relaterade till tjänster som erbjuds av program som körs på noden.</span><span class="sxs-lookup"><span data-stu-id="6c4f9-105">The local service cache stores Resource Records related to services offered by applications running on the node.</span></span> <span data-ttu-id="6c4f9-106">För inkommande frågor, om frågan matchar tjänsten som erbjuds, mDNS svar med svar lagrade i cacheminnet för den lokala tjänsten.</span><span class="sxs-lookup"><span data-stu-id="6c4f9-106">For incoming queries, if the question matches the service offered, mDNS responses with answers stored in the local service cache.</span></span> <span data-ttu-id="6c4f9-107">Programmen registrerar tjänster genom att anropa API *-nx_mdns_service_add ()*.</span><span class="sxs-lookup"><span data-stu-id="6c4f9-107">Applications register services by calling the API *nx_mdns_service_add()*.</span></span> <span data-ttu-id="6c4f9-108">För att ta bort tjänster använder programmen API- *nx_mdns_service_delete ()*, som i sin tur skickar "tar bort" meddelanden innan motsvarande poster i den lokala tjänstecachen tas bort.</span><span class="sxs-lookup"><span data-stu-id="6c4f9-108">To remove services, applications use the API *nx_mdns_service_delete()*, which will in turn send "goodbye" messages before removing the corresponding entries in the local service cache.</span></span>

<span data-ttu-id="6c4f9-109">När en tjänst läggs till, behåller mDNS minst 3 resurs poster i cacheminnet för den lokala tjänsten: SRV, PTR och TXT.</span><span class="sxs-lookup"><span data-stu-id="6c4f9-109">When a service is added, mDNS maintains at least 3 Resource Records in the local service cache: SRV, PTR, and TXT.</span></span> <span data-ttu-id="6c4f9-110">Ytterligare PTR-resursposter kan läggas till om tjänst typen innehåller undertyp.</span><span class="sxs-lookup"><span data-stu-id="6c4f9-110">Additional PTR Resource Record may be added if the service type includes subtype.</span></span> <span data-ttu-id="6c4f9-111">Ett program registrerar till exempel en tjänst:</span><span class="sxs-lookup"><span data-stu-id="6c4f9-111">For example, an application registers a service:</span></span>

```
*name*._*subtype*._sub._*type*._tcp.local,
```

<span data-ttu-id="6c4f9-112">två PTR-resursposter läggs till i cacheminnet för den lokala tjänsten, en för</span><span class="sxs-lookup"><span data-stu-id="6c4f9-112">two PTR Resource Records are added to the local service cache, one for</span></span>

```
“*_subtype._*sub*._type._*tcp.local *PTR name.type._*tcp*.*local”
```

<span data-ttu-id="6c4f9-113">och den andra för</span><span class="sxs-lookup"><span data-stu-id="6c4f9-113">and the other one for</span></span>

```
*“_type._*tcp*.*local *PTR name.type._*tcp*.*local”.
```

<span data-ttu-id="6c4f9-114">Peer-tjänstecache innehåller mDNS resurs poster som tagits emot från närliggande noder.</span><span class="sxs-lookup"><span data-stu-id="6c4f9-114">The peer service cache contains mDNS Resource Records received from neighboring nodes.</span></span> <span data-ttu-id="6c4f9-115">mDNS-modulen samlar in resurs poster som annonseras av andra noder i nätverket och lagrar den mottagna informationen i peer-tjänstens cacheminne.</span><span class="sxs-lookup"><span data-stu-id="6c4f9-115">mDNS module collects Resource Records advertised by other nodes on the network, and stores the received information in the peer service cache.</span></span> <span data-ttu-id="6c4f9-116">När programmet frågar efter information som värd-IPv4-eller IPv6-adresser söker mDNS i peer service-cachen efter lokalt cachelagrade svar.</span><span class="sxs-lookup"><span data-stu-id="6c4f9-116">When application queries for information such as host IPv4 or IPv6 addresses, mDNS searches the peer service cache for locally cached responses.</span></span> <span data-ttu-id="6c4f9-117">När program frågor för tjänster som erbjuds av peer-datorer söker mDNS i cacheminnet efter relaterade PTR-, SRV-, TXT-och IPv4-/IPv6-adress poster.</span><span class="sxs-lookup"><span data-stu-id="6c4f9-117">When application queries for services offered by peers, mDNS searches through the cache for related PTR, SRV, TXT, and IPv4/IPv6 address records.</span></span> <span data-ttu-id="6c4f9-118">Cacheminnet för peer-tjänsten lagrar också frågor som skickats till noden.</span><span class="sxs-lookup"><span data-stu-id="6c4f9-118">The peer service cache also stores queries sent to the node.</span></span> <span data-ttu-id="6c4f9-119">Ett program kan till exempel begära en viss tjänst genom att anropa *nx_mdns_service_one_shot_query.*</span><span class="sxs-lookup"><span data-stu-id="6c4f9-119">For example, an application may request a particular service by calling *nx_mdns_service_one_shot_query.*</span></span> <span data-ttu-id="6c4f9-120">Om tjänsten inte finns i peer-tjänstecachen skapar mDNS frågor (PTR, SRV och TXT) i peer-tjänstecachen.</span><span class="sxs-lookup"><span data-stu-id="6c4f9-120">If the service is not found in the peer service cache, mDNS creates query questions (PTR, SRV, and TXT) in the peer service cache.</span></span> <span data-ttu-id="6c4f9-121">De här frågorna skickas regelbundet till nätverket när tjänsten löses, eller tids gränsen uppnås. På liknande sätt kan programmet använda API- *nx_mdns_service_continous_query ()* för att begära en viss tjänst under en lång tids period (programmet avbryter en tidigare utfärdad kontinuerlig fråga med hjälp av API- *nx_mdns_service_query_stop ()* ).</span><span class="sxs-lookup"><span data-stu-id="6c4f9-121">These query questions will be sent to the network periodically till the service is resolved, or times out. Similar, the application may use the API *nx_mdns_service_continous_query()* to request a particular service over a long period of time (application cancels a previously issued continuous query by using the API *nx_mdns_service_query_stop()* ).</span></span> <span data-ttu-id="6c4f9-122">Om du vill söka efter en viss tjänst i peer-tjänstecachen utan att skicka frågor till nätverket, kan program använda API *-nx_mdns_serivce_lookup ().*</span><span class="sxs-lookup"><span data-stu-id="6c4f9-122">To search for a particular service in the peer service cache without sending queries to the network, applications can use the API *nx_mdns_serivce_lookup().*</span></span> <span data-ttu-id="6c4f9-123">Detta API söker bara igenom resurs posterna i peer-tjänstecachen.</span><span class="sxs-lookup"><span data-stu-id="6c4f9-123">This API only searches the resource records in the peer service cache.</span></span>

<span data-ttu-id="6c4f9-124">Varje resurs post lagras i en data struktur *NX_MDNS_RR* i tjänstens cacheminnen.</span><span class="sxs-lookup"><span data-stu-id="6c4f9-124">Each Resource Record is stored in a data structure *NX_MDNS_RR* in the service caches.</span></span> <span data-ttu-id="6c4f9-125">Strängar i resurs poster är variabel längd och lagras därför inte i *NX_MDNS_RRs* strukturen.</span><span class="sxs-lookup"><span data-stu-id="6c4f9-125">Strings in Resource Records are variable length, therefore are not stored in the *NX_MDNS_RR* structure.</span></span> <span data-ttu-id="6c4f9-126">Resurs posten innehåller en pekare till den faktiska minnes platsen där strängen lagras.</span><span class="sxs-lookup"><span data-stu-id="6c4f9-126">The Resource Record contains a pointer to the actual memory location where the string is stored.</span></span> <span data-ttu-id="6c4f9-127">Sträng tabellen och resurs posterna delar tjänstens cacheminne.</span><span class="sxs-lookup"><span data-stu-id="6c4f9-127">The string table and the Resource Records share the service cache.</span></span> <span data-ttu-id="6c4f9-128">Resurs poster lagras i början av tjänstecachen och växer mot slutet av cachen.</span><span class="sxs-lookup"><span data-stu-id="6c4f9-128">Resource Records are stored from the beginning of the service cache, and grow towards the end of the cache.</span></span> <span data-ttu-id="6c4f9-129">Sträng tabellen startar från slutet av tjänstecachen och växer till början av cachen.</span><span class="sxs-lookup"><span data-stu-id="6c4f9-129">The string table starts from the end of the service cache and grows towards the beginning of the cache.</span></span> <span data-ttu-id="6c4f9-130">Varje sträng i sträng tabellen har fältet längd och ett räknar fält.</span><span class="sxs-lookup"><span data-stu-id="6c4f9-130">Each string in the string table has a length field and a counter field.</span></span> <span data-ttu-id="6c4f9-131">När en sträng läggs till i sträng tabellen, och om samma sträng redan finns i tabellen, ökar räknarvärdet och inget minne allokeras för strängen.</span><span class="sxs-lookup"><span data-stu-id="6c4f9-131">When a string is added to the string table, if the same string is already present in the table, the counter value is incremented and no memory is allocated for the string.</span></span> <span data-ttu-id="6c4f9-132">Tjänstecachen anses vara full om inga fler resurs poster eller nya strängar kan läggas till i cachen för tjänsten.</span><span class="sxs-lookup"><span data-stu-id="6c4f9-132">The service cache is considered full if no more resource records or new strings can be added to the service cache.</span></span>

<span data-ttu-id="6c4f9-133">Det finns två sätt för ett program att hitta tjänster som erbjuds i det lokala nätverket.</span><span class="sxs-lookup"><span data-stu-id="6c4f9-133">There are two ways for an application to find services offered on the local network.</span></span> <span data-ttu-id="6c4f9-134">Det kan antingen utfärda en speciell tjänst genom en enda bilds fråga, eller så kan den initiera en kontinuerlig fråga till "övervaka" aktiviteterna i nätverket.</span><span class="sxs-lookup"><span data-stu-id="6c4f9-134">It can either issue a specific service look up through a one-shot query, or it can initiate a continuous query to “monitor” the activities on the network.</span></span> <span data-ttu-id="6c4f9-135">I ett scenario med en kort fråga måste programmet ange tjänst typen.</span><span class="sxs-lookup"><span data-stu-id="6c4f9-135">In the one-short query scenario, the application must specify the service type.</span></span> <span data-ttu-id="6c4f9-136">mDNS söker igenom cacheminnet för den lokala tjänsten och peer-tjänstecachen.</span><span class="sxs-lookup"><span data-stu-id="6c4f9-136">mDNS searches through the local service cache and the peer service cache.</span></span> <span data-ttu-id="6c4f9-137">Om det finns en tjänst instans, returnerar den ensidiga frågan den information som finns i resurs posterna.</span><span class="sxs-lookup"><span data-stu-id="6c4f9-137">If a service instances is located, the one-shot query returns with the information found in the Resource Records.</span></span> <span data-ttu-id="6c4f9-138">Om det inte finns några poster i den lokala tjänstecachen eller peer-tjänstecachen skickar mDNS meddelanden.</span><span class="sxs-lookup"><span data-stu-id="6c4f9-138">If there are no records in the local service cache or peer service cache, mDNS sends out query messages.</span></span> <span data-ttu-id="6c4f9-139">Om instans namnet anges skickas en *valfri* typ (fråga SRV-och txt-typ) med det specifika instans namnet, i formatet "namn. Type. local", till det lokala nätverket.</span><span class="sxs-lookup"><span data-stu-id="6c4f9-139">If the instance name is specified, an *ANY* type (query the SRV and TXT type) with the specific instance name, in the form of “name.type.local”, is sent to the local network.</span></span> <span data-ttu-id="6c4f9-140">Om instans namnet inte anges skickas en PTR-typ av fråga till det lokala nätverket.</span><span class="sxs-lookup"><span data-stu-id="6c4f9-140">If the instance name is not specified, a PTR type of query is sent to the local network.</span></span> <span data-ttu-id="6c4f9-141">Den första fullständiga tjänsten som togs emot returneras till anroparen.</span><span class="sxs-lookup"><span data-stu-id="6c4f9-141">The first complete service received is returned to the caller.</span></span>

<span data-ttu-id="6c4f9-142">Kontinuerlig fråga fungerar på olika sätt.</span><span class="sxs-lookup"><span data-stu-id="6c4f9-142">Continuous query works differently.</span></span> <span data-ttu-id="6c4f9-143">Det vanligaste användnings fallet för en kontinuerlig fråga är att övervaka det lokala nätverket för en speciell tjänst (till exempel för att ständigt söka efter utskrifts tjänster i det lokala nätverket).</span><span class="sxs-lookup"><span data-stu-id="6c4f9-143">The typical use case for a continuous query is to monitor the local network for a specific service (for example to constantly look for printing services on the local network).</span></span> <span data-ttu-id="6c4f9-144">I det här fallet utfärdar programmet en Sök fråga (via API- *nx_mdns_service_continious_* fråga) för vissa typer av tjänster.</span><span class="sxs-lookup"><span data-stu-id="6c4f9-144">In this case the application issues a search query (via the API *nx_mdns_service_continious_* query) for certain type of services.</span></span> <span data-ttu-id="6c4f9-145">Anroparen väntar vanligt vis inte på ett särskilt svar.</span><span class="sxs-lookup"><span data-stu-id="6c4f9-145">The caller typically does not wait for a particular response.</span></span> <span data-ttu-id="6c4f9-146">För frågor som skickats som kontinuerliga frågor, skickar mDNS-modulen frågor med jämna mellanrum med exponentiellt ökande intervall.</span><span class="sxs-lookup"><span data-stu-id="6c4f9-146">For queries submitted as continuous query, the mDNS module transmits the queries periodically with exponentially increasing intervals.</span></span> <span data-ttu-id="6c4f9-147">För att stoppa frågan måste programmet använda API- *nx_mdns_service_query_stop* för att stoppa den interna timern i dessa frågor.</span><span class="sxs-lookup"><span data-stu-id="6c4f9-147">To stop the query, application must use the API *nx_mdns_service_query_stop* to stop the internal timer in these queries.</span></span> <span data-ttu-id="6c4f9-148">Typen av fråga kan vara NULL. i så fall har frågetyp angetts till speciell PTR-typ "_services. _DNS-SD. _udp. local".</span><span class="sxs-lookup"><span data-stu-id="6c4f9-148">The query type can be NULL, in which case the query type is set to special PTR type “_services._dns-sd._udp.local”.</span></span> <span data-ttu-id="6c4f9-149">Den här tjänst typen definieras av mDNS som ett sätt att identifiera alla tjänster som är tillgängliga i det lokala nätverket.</span><span class="sxs-lookup"><span data-stu-id="6c4f9-149">This service type is defined by mDNS as a way to discover all services available on the local network.</span></span> <span data-ttu-id="6c4f9-150">Om instans namnet anges skickas en valfri typ (fråga SRV-och TXT-typ) med det angivna instans namnet "Name. Type. local" till det lokala nätverket.</span><span class="sxs-lookup"><span data-stu-id="6c4f9-150">If the instance name is supplied, an ANY type (query the SRV and TXT type) with the specific instance name “name.type.local” is sent to the local network.</span></span> <span data-ttu-id="6c4f9-151">Om instans namnet är NULL skickas en PTR-typ av fråga till det lokala nätverket.</span><span class="sxs-lookup"><span data-stu-id="6c4f9-151">If the instance name is NULL, a PTR type of query is sent to the local network,</span></span>

<span data-ttu-id="6c4f9-152">Alla svar, inklusive svar från oönskade frågor, registreras i peer-tjänstecacheminnet.</span><span class="sxs-lookup"><span data-stu-id="6c4f9-152">All responses, including responses from unsolicited queries, are recorded in the peer service cache.</span></span> <span data-ttu-id="6c4f9-153">Vid ett senare tillfälle använder programmet API- *nx_mdns_service_lookup* för att hämta specifika tjänster från peer-tjänstecachen.</span><span class="sxs-lookup"><span data-stu-id="6c4f9-153">At a later time, the application uses the API *nx_mdns_service_lookup* to retrieve specific service from the peer service cache.</span></span>

<span data-ttu-id="6c4f9-154">Särskild anmärkning om fragmentering: varje *NX_MDNS_RRs* struktur är fast i storlek och är därför inte föremål för fragmentering eftersom mdns lägger till och tar bort resurs poster.</span><span class="sxs-lookup"><span data-stu-id="6c4f9-154">Special note on fragmentation: Each *NX_MDNS_RR* structure is fixed in size, and therefore is not subject to fragmentation as mDNS adds and deletes RRs.</span></span> <span data-ttu-id="6c4f9-155">Däremot är strängarna variabel längd.</span><span class="sxs-lookup"><span data-stu-id="6c4f9-155">However strings are variable length.</span></span> <span data-ttu-id="6c4f9-156">När en sträng har tagits bort blir utrymmet tillgängligt och kan användas för en ny sträng om den nya strängen kan anpassas i.</span><span class="sxs-lookup"><span data-stu-id="6c4f9-156">After a string is deleted, the space becomes available and could be used for a new string if the new string is able to fit in.</span></span> <span data-ttu-id="6c4f9-157">Men den här åtgärden gör att minnet fragmenteras.</span><span class="sxs-lookup"><span data-stu-id="6c4f9-157">But this operation causes the memory to fragment.</span></span> <span data-ttu-id="6c4f9-158">När tjänster läggs till och tas bort kan sträng tabellen fragmenteras till den punkt där det inte går att lägga till några nya strängar, trots att tjänstens cacheminne innehåller tillräckligt många oanvända byte för strängen.</span><span class="sxs-lookup"><span data-stu-id="6c4f9-158">As services are added and removed, the string table may be fragmented to the point that no new strings can be added even though the service cache contains enough unused bytes for the string.</span></span> <span data-ttu-id="6c4f9-159">Lokala program är ofta mer stabila och förutsägbara.</span><span class="sxs-lookup"><span data-stu-id="6c4f9-159">Local applications tend to be more stable and predictable.</span></span> <span data-ttu-id="6c4f9-160">Därför är den lokala tjänstecachen mindre sannolik för fragmentering.</span><span class="sxs-lookup"><span data-stu-id="6c4f9-160">Therefore the local service cache is less likely to suffer from fragmentation.</span></span> <span data-ttu-id="6c4f9-161">Peer service-cachen, å andra sidan, lägger ständigt till resurs poster när tjänsterna blir tillgängliga eller tar bort resurs poster som tjänster tas bort av noderna i nätverket.</span><span class="sxs-lookup"><span data-stu-id="6c4f9-161">The peer service cache, on the other hand, constantly add RRs as the services become available, or remove RRs as services are deleted by the nodes on the network.</span></span> <span data-ttu-id="6c4f9-162">Tjänster i nätverket kommer och går, vilket orsakar mer frekvent allokera/ta bort-åtgärder i sträng tabellen.</span><span class="sxs-lookup"><span data-stu-id="6c4f9-162">Services on the network come and go, causing more frequent allocate/delete operations on the string table.</span></span> <span data-ttu-id="6c4f9-163">Det är möjligt att sträng tabellen är fragmenterad med tiden.</span><span class="sxs-lookup"><span data-stu-id="6c4f9-163">Over time it is possible the string table becomes fragmented.</span></span> <span data-ttu-id="6c4f9-164">När den här situationen inträffar är en enkel lösning att tömma hela peer-tjänstecacheminnet.</span><span class="sxs-lookup"><span data-stu-id="6c4f9-164">When this situation happens, a simple solution is to flush the entire peer service cache.</span></span> <span data-ttu-id="6c4f9-165">Detta kan göras genom att anropa API- *nx_mdns_peer_cache_clear ().*</span><span class="sxs-lookup"><span data-stu-id="6c4f9-165">This can be done by calling the API *nx_mdns_peer_cache_clear().*</span></span> <span data-ttu-id="6c4f9-166">Observera att detta API automatiskt avslutar alla väntande kontinuerliga frågor.</span><span class="sxs-lookup"><span data-stu-id="6c4f9-166">Note that this API automatically terminates any outstanding continuous queries.</span></span>
