---
title: Kapitel 6 – Azure återställnings tider FileX fel tolerans modul
description: Det här kapitlet innehåller en beskrivning av den feltoleranta modulen i Azure återställnings tider FileX som är utformad för att underhålla fil systemets integritet om mediet förlorar ström eller matas ut i mitten av en fil skrivnings åtgärd.
author: philmea
ms.author: philmea
ms.date: 05/19/2020
ms.topic: article
ms.service: rtos
ms.openlocfilehash: 68a24f0345a2c4d3e824270699b00a2daab32f8e
ms.sourcegitcommit: e3d42e1f2920ec9cb002634b542bc20754f9544e
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 03/22/2021
ms.locfileid: "104826505"
---
# <a name="chapter-6---azure-rtos-filex-fault-tolerant-module"></a><span data-ttu-id="6428d-103">Kapitel 6 – Azure återställnings tider FileX fel tolerans modul</span><span class="sxs-lookup"><span data-stu-id="6428d-103">Chapter 6 - Azure RTOS FileX fault tolerant module</span></span>

<span data-ttu-id="6428d-104">Det här kapitlet innehåller en beskrivning av den feltoleranta modulen i Azure återställnings tider FileX som är utformad för att underhålla fil systemets integritet om mediet förlorar ström eller matas ut i mitten av en fil skrivnings åtgärd.</span><span class="sxs-lookup"><span data-stu-id="6428d-104">This chapter contains a description of the Azure RTOS FileX Fault Tolerant Module that is designed to maintain file system integrity if the media loses power or is ejected in the middle of a file write operation.</span></span>

## <a name="filex-fault-tolerant-module-overview"></a><span data-ttu-id="6428d-105">Översikt över FileX feltolerant modul</span><span class="sxs-lookup"><span data-stu-id="6428d-105">FileX Fault Tolerant Module Overview</span></span>

<span data-ttu-id="6428d-106">När ett program skriver data till en fil, uppdaterar FileX både data kluster och system information.</span><span class="sxs-lookup"><span data-stu-id="6428d-106">When an application writes data into a file, FileX updates both data clusters and system information.</span></span> <span data-ttu-id="6428d-107">Dessa uppdateringar måste utföras som en atomisk åtgärd för att hålla informationen i fil systemet konsekvent.</span><span class="sxs-lookup"><span data-stu-id="6428d-107">These updates must be completed as an atomic operation to keep information in the file system coherent.</span></span> <span data-ttu-id="6428d-108">Om du till exempel lägger till data i en fil måste FileX hitta ett tillgängligt kluster i mediet, uppdatera FAT-kedjan, uppdatera längden som har arkiverats i katalog posten och eventuellt uppdatera det första kluster numret i katalog posten.</span><span class="sxs-lookup"><span data-stu-id="6428d-108">For example, when appending data to a file, FileX needs to find an available cluster in the media, update the FAT chain, update the length filed in the directory entry, and possibly update the starting cluster number in the directory entry.</span></span> <span data-ttu-id="6428d-109">Antingen ett strömavbrott eller en medie utmatning kan avbryta sekvensen av uppdateringar, vilket lämnar fil systemet i ett inkonsekvent tillstånd.</span><span class="sxs-lookup"><span data-stu-id="6428d-109">Either a power failure or media ejection can interrupt the sequence of updates, which will leave the file system in an inconsistent state.</span></span> <span data-ttu-id="6428d-110">Om det inkonsekventa läget inte korrigeras kan data som uppdateras gå förlorade och på grund av skada på system informationen kan efterföljande fil system åtgärder skada andra filer eller kataloger på mediet.</span><span class="sxs-lookup"><span data-stu-id="6428d-110">If the inconsistent state is not corrected, the data being updated can be lost, and because of damage to the system information, subsequent file system operation may damage other files or directories on the media.</span></span>

<span data-ttu-id="6428d-111">Den feltoleranta modulen FileX fungerar med de Journal steg som krävs för att uppdatera en fil *innan* de här stegen tillämpas på fil systemet.</span><span class="sxs-lookup"><span data-stu-id="6428d-111">The FileX Fault Tolerant Module works by journaling steps required to update a file *before* these steps are applied to the file system.</span></span> <span data-ttu-id="6428d-112">Om fil uppdateringen lyckas tas dessa logg poster bort.</span><span class="sxs-lookup"><span data-stu-id="6428d-112">If the file update is successful, these log entries are removed.</span></span> <span data-ttu-id="6428d-113">Men om fil uppdateringen avbryts lagras logg posterna på mediet.</span><span class="sxs-lookup"><span data-stu-id="6428d-113">However, if the file update is interrupted, the log entries are stored on the media.</span></span> <span data-ttu-id="6428d-114">Nästa gången mediet monteras identifierar FileX dessa logg poster från den tidigare (oavslutade) Skriv åtgärden.</span><span class="sxs-lookup"><span data-stu-id="6428d-114">Next time the media is mounted, FileX detects these log entries from the previous (unfinished) write operation.</span></span> <span data-ttu-id="6428d-115">I sådana fall kan FileX återställas efter fel genom att antingen återställa de ändringar som redan har gjorts i fil systemet eller genom att tillämpa de nödvändiga ändringarna för att slutföra den tidigare åtgärden.</span><span class="sxs-lookup"><span data-stu-id="6428d-115">In such cases, FileX can recover from a failure by either rolling back the changes already made to the file system, or by reapplying the required changes to complete the previous operation.</span></span> <span data-ttu-id="6428d-116">På så sätt upprätthåller FileX-feltolerant modul fil systemets integritet om mediet förlorar ström under en uppdaterings åtgärd.</span><span class="sxs-lookup"><span data-stu-id="6428d-116">In this way, the FileX Fault Tolerant Module maintains file system integrity if the media loses power during an update operation.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="6428d-117">*FileX feltolerant modul är inte utformad för att förhindra skada av fil system som orsakas av fysiskt medie fel med giltiga data.*</span><span class="sxs-lookup"><span data-stu-id="6428d-117">*The FileX Fault Tolerant Module is not designed to prevent file system corruption caused by physical media corruption with valid data in it.*</span></span>

> [!IMPORTANT]
> <span data-ttu-id="6428d-118">*När FileX-feltolerant modul skyddar ett medium, får inte mediet monteras av något annat än FileX med feltolerant aktiverat. Detta kan orsaka att logg posterna i fil systemet är inkonsekventa med system information på mediet. Om FileX feltolerant module försöker bearbeta logg poster när mediet har uppdaterats av ett annat fil system, kan återställnings proceduren Miss lyckas, vilket lämnar hela fil systemet i ett oförutsägbart tillstånd.*</span><span class="sxs-lookup"><span data-stu-id="6428d-118">*After the FileX Fault Tolerant module protects a media, the media must not be mounted by anything other than FileX with Fault Tolerant enabled. Doing so can cause the log entries in the file system to be inconsistent with system information on the media. If the FileX Fault Tolerant module attempts to process log entries after the media is updated by another file system, the recovery procedure may fail, leaving the entire file system in an unpredictable state.*</span></span>

## <a name="use-of-the-fault-tolerant-module"></a><span data-ttu-id="6428d-119">Användning av fel tolerans modulen</span><span class="sxs-lookup"><span data-stu-id="6428d-119">Use of the Fault Tolerant Module</span></span>

<span data-ttu-id="6428d-120">FileX-feltolerant funktion är tillgänglig för alla FAT-filsystem som stöds av FileX, inklusive FAT12, FAT16, FAT32 och exFAT.</span><span class="sxs-lookup"><span data-stu-id="6428d-120">The FileX Fault Tolerant feature is available to all FAT file systems supported by FileX, including FAT12, FAT16, FAT32, and exFAT.</span></span> <span data-ttu-id="6428d-121">Om du vill aktivera den feltoleranta funktionen måste FileX skapas med symbolen **FX_ENABLE_FAULT_TOLERANT** definierad.</span><span class="sxs-lookup"><span data-stu-id="6428d-121">To enable the fault tolerant feature, FileX must be built with the symbol **FX_ENABLE_FAULT_TOLERANT** defined.</span></span> <span data-ttu-id="6428d-122">Vid körning startar programmet feltolerant tjänst genom att anropa **_fx_fault_tolerant_enable_*_ omedelbart efter anropet till _*_fx_media_open_**.</span><span class="sxs-lookup"><span data-stu-id="6428d-122">At run time, application starts fault tolerant service by calling **_fx_fault_tolerant_enable_*_ immediately after the call to _*_fx_media_open_**.</span></span> <span data-ttu-id="6428d-123">När fel tolerans har Aktiver ATS skyddas alla fil skrivnings åtgärder till det angivna mediet.</span><span class="sxs-lookup"><span data-stu-id="6428d-123">After fault tolerant is enabled, all file write operations to the designated media are protected.</span></span> <span data-ttu-id="6428d-124">Fel tolerans modulen är som standard inte aktive rad.</span><span class="sxs-lookup"><span data-stu-id="6428d-124">By default the fault tolerant module is not enabled.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="6428d-125">\* Programmet måste se till att fil systemet inte kommer åt före \***fx_fault_tolerant_enable** _ anropas.</span><span class="sxs-lookup"><span data-stu-id="6428d-125">\*Application needs to make sure the file system is not being accessed prior to \***fx_fault_tolerant_enable** _ being called.</span></span> <span data-ttu-id="6428d-126">Om programmet skriver data till fil systemet före den feltoleranta aktiveringen, kan Skriv åtgärden skada mediet om tidigare Skriv åtgärder inte hade slutförts och fil systemet inte återställdes med feltolerant logg entries._</span><span class="sxs-lookup"><span data-stu-id="6428d-126">If application writes data to the file system prior to fault tolerant enable, the write operation could corrupt the media if prior write operations were not completed, and the file system was not restored using fault tolerant log entries._</span></span>

## <a name="filex-fault-tolerant-module-log"></a><span data-ttu-id="6428d-127">Logg för FileX feltolerant modul</span><span class="sxs-lookup"><span data-stu-id="6428d-127">FileX Fault Tolerant Module Log</span></span>

<span data-ttu-id="6428d-128">FileX fel tolerans loggen tar upp ett logiskt kluster i Flash.</span><span class="sxs-lookup"><span data-stu-id="6428d-128">The FileX fault tolerant log takes up one logical cluster in flash.</span></span> <span data-ttu-id="6428d-129">Indexet till Start kluster numret för klustret registreras i Start sektorn för mediet, med en förskjutning som anges av symbolen **FX_FAULT_TOLERANT_BOOT_INDEX**.</span><span class="sxs-lookup"><span data-stu-id="6428d-129">The index to the starting cluster number of that cluster is recorded in the boot sector of the media, with an offset specified by the symbol **FX_FAULT_TOLERANT_BOOT_INDEX**.</span></span> <span data-ttu-id="6428d-130">Som standard är den här symbolen definierad som 116.</span><span class="sxs-lookup"><span data-stu-id="6428d-130">By default this symbol is defined to be 116.</span></span> <span data-ttu-id="6428d-131">Den här platsen väljs eftersom den är markerad som reserverad i FAT12/16/32-och exFAT-specifikationen.</span><span class="sxs-lookup"><span data-stu-id="6428d-131">This location is chosen because it is marked as reserved in FAT12/ 16/32 and exFAT specification.</span></span>

<span data-ttu-id="6428d-132">Bild 5, "logg strukturens layout", visar logg strukturens allmänna layout.</span><span class="sxs-lookup"><span data-stu-id="6428d-132">Figure 5, "Log Structure Layout," shows the general layout of the log structure.</span></span> <span data-ttu-id="6428d-133">Logg strukturen innehåller tre avsnitt: logg huvud, FAT-kedja och logg poster.</span><span class="sxs-lookup"><span data-stu-id="6428d-133">The log structure contains three sections: Log Header, FAT Chain, and Log Entries.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="6428d-134">*Alla värden för flera byte som lagras i logg posterna är i litet endian-format.*</span><span class="sxs-lookup"><span data-stu-id="6428d-134">*All multi-byte values stored in the log entries are in Little Endian format.*</span></span>

![Layout för logg struktur](./media/user-guide/log-structure-layout.png)

<span data-ttu-id="6428d-136">**Bild 5. Layout för logg struktur**</span><span class="sxs-lookup"><span data-stu-id="6428d-136">**Figure 5. Log Structure Layout**</span></span>

<span data-ttu-id="6428d-137">Logg huvud området innehåller information som beskriver hela logg strukturen och förklarar varje fält i detalj.</span><span class="sxs-lookup"><span data-stu-id="6428d-137">The Log Header area contains information that describes the entire log structure and explains each field in detail.</span></span>

<span data-ttu-id="6428d-138">**TABELL 8. Logg huvuds Area**</span><span class="sxs-lookup"><span data-stu-id="6428d-138">**TABLE 8. Log Header Area**</span></span>

|<span data-ttu-id="6428d-139">Fält</span><span class="sxs-lookup"><span data-stu-id="6428d-139">Field</span></span>|<span data-ttu-id="6428d-140">Storlek (i byte)</span><span class="sxs-lookup"><span data-stu-id="6428d-140">Size(in bytes)</span></span>|<span data-ttu-id="6428d-141">Description</span><span class="sxs-lookup"><span data-stu-id="6428d-141">Description</span></span>|
|-----|--------------|-----------|
|<span data-ttu-id="6428d-142">ID</span><span class="sxs-lookup"><span data-stu-id="6428d-142">ID</span></span>|<span data-ttu-id="6428d-143">4</span><span class="sxs-lookup"><span data-stu-id="6428d-143">4</span></span>|<span data-ttu-id="6428d-144">Identifierar en feltolerant logg struktur för FileX.</span><span class="sxs-lookup"><span data-stu-id="6428d-144">Identifies a FileX Fault Tolerant Log structure.</span></span> <span data-ttu-id="6428d-145">Logg strukturen betraktas som ogiltig om ID-värdet inte är 0x46544C52.</span><span class="sxs-lookup"><span data-stu-id="6428d-145">The log structure is considered invalid if the ID value is not 0x46544C52.</span></span>|
|<span data-ttu-id="6428d-146">Total storlek</span><span class="sxs-lookup"><span data-stu-id="6428d-146">Total Size</span></span>|<span data-ttu-id="6428d-147">2</span><span class="sxs-lookup"><span data-stu-id="6428d-147">2</span></span>|<span data-ttu-id="6428d-148">Anger den totala storleken (i byte) för hela logg strukturen.</span><span class="sxs-lookup"><span data-stu-id="6428d-148">Indicates the total size (in bytes) of the entire log structure.</span></span>|
|<span data-ttu-id="6428d-149">Huvud kontroll Summa</span><span class="sxs-lookup"><span data-stu-id="6428d-149">Header Checksum</span></span>|<span data-ttu-id="6428d-150">2</span><span class="sxs-lookup"><span data-stu-id="6428d-150">2</span></span>|<span data-ttu-id="6428d-151">Kontroll summa som konverterar logg huvuds ytan.</span><span class="sxs-lookup"><span data-stu-id="6428d-151">Checksum that converts the log header area.</span></span> <span data-ttu-id="6428d-152">Logg strukturen betraktas som ogiltig om huvud fälten inte kan verifiera kontroll summan.</span><span class="sxs-lookup"><span data-stu-id="6428d-152">The log structure is considered invalid if the header fields fail the checksum verification.</span></span>|
|<span data-ttu-id="6428d-153">Versionsnummer</span><span class="sxs-lookup"><span data-stu-id="6428d-153">Version Number</span></span>|<span data-ttu-id="6428d-154">2</span><span class="sxs-lookup"><span data-stu-id="6428d-154">2</span></span>|<span data-ttu-id="6428d-155">FileX-feltoleranta huvud-och del versions nummer.</span><span class="sxs-lookup"><span data-stu-id="6428d-155">FileX Fault Tolerant major and minor version numbers.</span></span>|
|<span data-ttu-id="6428d-156">Reserverat</span><span class="sxs-lookup"><span data-stu-id="6428d-156">Reserved</span></span>|<span data-ttu-id="6428d-157">2</span><span class="sxs-lookup"><span data-stu-id="6428d-157">2</span></span>|<span data-ttu-id="6428d-158">För framtida expansion.</span><span class="sxs-lookup"><span data-stu-id="6428d-158">For future expansion.</span></span>|

<span data-ttu-id="6428d-159">Logg huvuds ytan följs av logg ytan FAT-kedja.</span><span class="sxs-lookup"><span data-stu-id="6428d-159">The Log Header area is followed by the FAT Chain Log area.</span></span> <span data-ttu-id="6428d-160">Bild 9 innehåller information som beskriver hur FAT-kedjan ska ändras.</span><span class="sxs-lookup"><span data-stu-id="6428d-160">Figure 9 contains information that describes how the FAT chain should be modified.</span></span> <span data-ttu-id="6428d-161">Det här logg området innehåller information om de kluster som allokeras till en fil, de kluster som tas bort från en fil och där infogningen/borttagningen ska vara och beskriver varje fält i logg området FAT-kedja.</span><span class="sxs-lookup"><span data-stu-id="6428d-161">This log area contains information on the clusters being allocated to a file, the clusters being removed from a file, and where the insertion/deletion should be and describes each field in the FAT Chain Log area.</span></span>

<span data-ttu-id="6428d-162">**TABELL 9. Logg områden för FAT-kedja**</span><span class="sxs-lookup"><span data-stu-id="6428d-162">**TABLE 9. FAT Chain Log Area**</span></span>

|<span data-ttu-id="6428d-163">Fält</span><span class="sxs-lookup"><span data-stu-id="6428d-163">Field</span></span>|<span data-ttu-id="6428d-164">Storlek (i byte)</span><span class="sxs-lookup"><span data-stu-id="6428d-164">Size(in bytes)</span></span>|<span data-ttu-id="6428d-165">Beskrivning</span><span class="sxs-lookup"><span data-stu-id="6428d-165">Description</span></span>|
|-----|--------------|-----------|
|<span data-ttu-id="6428d-166">Logg kontroll summa för FAT-kedja</span><span class="sxs-lookup"><span data-stu-id="6428d-166">FAT Chain Log Checksum</span></span>|<span data-ttu-id="6428d-167">2</span><span class="sxs-lookup"><span data-stu-id="6428d-167">2</span></span>|<span data-ttu-id="6428d-168">Kontroll summa för hela logg ytan FAT-kedja.</span><span class="sxs-lookup"><span data-stu-id="6428d-168">Checksum of the entire FAT Chain Log area.</span></span> <span data-ttu-id="6428d-169">Logg arean för FAT-kedjan betraktas som ogiltig om verifieringen av kontroll summan Miss lyckas.</span><span class="sxs-lookup"><span data-stu-id="6428d-169">The FAT Chain Log area is considered invalid if the it fails the checksum verification.</span></span>|
|<span data-ttu-id="6428d-170">Flagga</span><span class="sxs-lookup"><span data-stu-id="6428d-170">Flag</span></span>|<span data-ttu-id="6428d-171">1</span><span class="sxs-lookup"><span data-stu-id="6428d-171">1</span></span>|<span data-ttu-id="6428d-172">Giltiga flagg värden är:</span><span class="sxs-lookup"><span data-stu-id="6428d-172">Valid flag values are:</span></span><br/><span data-ttu-id="6428d-173">0x01 FAT-kedja giltig</span><span class="sxs-lookup"><span data-stu-id="6428d-173">0x01 FAT Chain Valid</span></span><br /><span data-ttu-id="6428d-174">protokollnumret 0x02-BITMAPP används</span><span class="sxs-lookup"><span data-stu-id="6428d-174">0x02 BITMAP is being used</span></span>|
|<span data-ttu-id="6428d-175">Reserverat</span><span class="sxs-lookup"><span data-stu-id="6428d-175">Reserved</span></span>|<span data-ttu-id="6428d-176">1</span><span class="sxs-lookup"><span data-stu-id="6428d-176">1</span></span>|<span data-ttu-id="6428d-177">Reserverad för framtida användning</span><span class="sxs-lookup"><span data-stu-id="6428d-177">Reserved for future use</span></span>|
|<span data-ttu-id="6428d-178">Insättnings punkt – överst</span><span class="sxs-lookup"><span data-stu-id="6428d-178">Insertion Point – Front</span></span>|<span data-ttu-id="6428d-179">4</span><span class="sxs-lookup"><span data-stu-id="6428d-179">4</span></span>|<span data-ttu-id="6428d-180">Klustret (som hör till den ursprungliga FAT-kedjan) där den nya kedjan ska kopplas till.</span><span class="sxs-lookup"><span data-stu-id="6428d-180">The cluster (that belongs to the original FAT chain) where the newly created chain is going to be attached to.</span></span>|
|<span data-ttu-id="6428d-181">Huvud kluster för ny FAT-kedja</span><span class="sxs-lookup"><span data-stu-id="6428d-181">Head Cluster of New FAT Chain</span></span>|<span data-ttu-id="6428d-182">4</span><span class="sxs-lookup"><span data-stu-id="6428d-182">4</span></span>|<span data-ttu-id="6428d-183">Det första klustret i den nyligen skapade FAT-kedjan</span><span class="sxs-lookup"><span data-stu-id="6428d-183">The first cluster of the newly created FAT Chain</span></span>|
|<span data-ttu-id="6428d-184">Huvud kluster för ursprunglig FAT-kedja</span><span class="sxs-lookup"><span data-stu-id="6428d-184">Head Cluster of Original FAT Chain</span></span>|<span data-ttu-id="6428d-185">4</span><span class="sxs-lookup"><span data-stu-id="6428d-185">4</span></span>|<span data-ttu-id="6428d-186">Det första klustret i den del av den ursprungliga FAT-kedjan som ska tas bort.</span><span class="sxs-lookup"><span data-stu-id="6428d-186">The first cluster of the portion of the original FAT Chain that is to be removed.</span></span>|
|<span data-ttu-id="6428d-187">Insättnings punkt – bakåt</span><span class="sxs-lookup"><span data-stu-id="6428d-187">Insertion Point – Back</span></span>|<span data-ttu-id="6428d-188">4</span><span class="sxs-lookup"><span data-stu-id="6428d-188">4</span></span>|<span data-ttu-id="6428d-189">Det ursprungliga klustret där den nyligen skapade FAT-kedjan kopplas till.</span><span class="sxs-lookup"><span data-stu-id="6428d-189">The original cluster where the newly created FAT chain joins at.</span></span>|
|<span data-ttu-id="6428d-190">Nästa borttagnings punkt</span><span class="sxs-lookup"><span data-stu-id="6428d-190">Next Deletion Point</span></span>|<span data-ttu-id="6428d-191">4</span><span class="sxs-lookup"><span data-stu-id="6428d-191">4</span></span>|<span data-ttu-id="6428d-192">Det här fältet hjälper till med rensnings proceduren för FAT-kedjan.</span><span class="sxs-lookup"><span data-stu-id="6428d-192">This field assists the FAT chain cleanup procedure.</span></span>|

<span data-ttu-id="6428d-193">Fältet logg poster innehåller logg poster som beskriver de ändringar som krävs för att återställa efter ett fel.</span><span class="sxs-lookup"><span data-stu-id="6428d-193">The Log Entries Area contains log entries that describe the changes needed to recover from a failure.</span></span> <span data-ttu-id="6428d-194">Det finns tre typer av logg poster som stöds i FileX feltolerant modul: FAT-loggpost; Katalog logg post; och Bitmap-loggpost.</span><span class="sxs-lookup"><span data-stu-id="6428d-194">There are three types of log entry supported in the FileX fault tolerant module: FAT Log Entry; Directory Log Entry; and Bitmap Log Entry.</span></span>

<span data-ttu-id="6428d-195">Följande tre figurer och tre tabeller beskriver dessa logg poster i detalj.</span><span class="sxs-lookup"><span data-stu-id="6428d-195">The following three figures and three tables describe these log entries in detail.</span></span>

![Logg post för FAT](./media/user-guide/fat-log-entry.png)

<span data-ttu-id="6428d-197">**Bild 6. Logg post för FAT**</span><span class="sxs-lookup"><span data-stu-id="6428d-197">**Figure 6. FAT Log Entry**</span></span>

<span data-ttu-id="6428d-198">**TABELL 10. Logg post för FAT**</span><span class="sxs-lookup"><span data-stu-id="6428d-198">**TABLE 10. FAT Log Entry**</span></span>

|<span data-ttu-id="6428d-199">Fält</span><span class="sxs-lookup"><span data-stu-id="6428d-199">Field</span></span>|<span data-ttu-id="6428d-200">Storlek (i byte)</span><span class="sxs-lookup"><span data-stu-id="6428d-200">Size(in bytes)</span></span>|<span data-ttu-id="6428d-201">Beskrivning</span><span class="sxs-lookup"><span data-stu-id="6428d-201">Description</span></span>|
|-----|--------------|-----------|
<span data-ttu-id="6428d-202">Typ</span><span class="sxs-lookup"><span data-stu-id="6428d-202">Type</span></span>|<span data-ttu-id="6428d-203">2</span><span class="sxs-lookup"><span data-stu-id="6428d-203">2</span></span>|<span data-ttu-id="6428d-204">Typ av post måste vara FX_FAULT_TOLERANT_FAT_LOG_TYPE</span><span class="sxs-lookup"><span data-stu-id="6428d-204">Type of Entry, must be FX_FAULT_TOLERANT_FAT_LOG_TYPE</span></span>|
|<span data-ttu-id="6428d-205">Storlek</span><span class="sxs-lookup"><span data-stu-id="6428d-205">Size</span></span>|<span data-ttu-id="6428d-206">2</span><span class="sxs-lookup"><span data-stu-id="6428d-206">2</span></span>|<span data-ttu-id="6428d-207">Storlek på posten</span><span class="sxs-lookup"><span data-stu-id="6428d-207">Size of this entry</span></span>|
|<span data-ttu-id="6428d-208">Kluster nummer</span><span class="sxs-lookup"><span data-stu-id="6428d-208">Cluster Number</span></span>|<span data-ttu-id="6428d-209">4</span><span class="sxs-lookup"><span data-stu-id="6428d-209">4</span></span>|<span data-ttu-id="6428d-210">Kluster nummer</span><span class="sxs-lookup"><span data-stu-id="6428d-210">Cluster number</span></span>|
|<span data-ttu-id="6428d-211">Värde</span><span class="sxs-lookup"><span data-stu-id="6428d-211">Value</span></span>|<span data-ttu-id="6428d-212">4</span><span class="sxs-lookup"><span data-stu-id="6428d-212">4</span></span>|<span data-ttu-id="6428d-213">Värde som ska skrivas till FAT-posten</span><span class="sxs-lookup"><span data-stu-id="6428d-213">Value to be written into the FAT entry</span></span>|

![Katalog logg post](./media/user-guide/directory-log-entry.png)

<span data-ttu-id="6428d-215">**Bild 7. Katalog logg post**</span><span class="sxs-lookup"><span data-stu-id="6428d-215">**Figure 7. Directory Log Entry**</span></span>

<span data-ttu-id="6428d-216">**TABELL 11. Katalog logg post**</span><span class="sxs-lookup"><span data-stu-id="6428d-216">**TABLE 11. Directory Log Entry**</span></span>

|<span data-ttu-id="6428d-217">Fält</span><span class="sxs-lookup"><span data-stu-id="6428d-217">Field</span></span>|<span data-ttu-id="6428d-218">Storlek (i byte)</span><span class="sxs-lookup"><span data-stu-id="6428d-218">Size(in bytes)</span></span>|<span data-ttu-id="6428d-219">Beskrivning</span><span class="sxs-lookup"><span data-stu-id="6428d-219">Description</span></span>|
|-----|--------------|-----------|
|<span data-ttu-id="6428d-220">Typ</span><span class="sxs-lookup"><span data-stu-id="6428d-220">Type</span></span>|<span data-ttu-id="6428d-221">2</span><span class="sxs-lookup"><span data-stu-id="6428d-221">2</span></span>|<span data-ttu-id="6428d-222">Typ av post måste vara FX_FAULT_TOLERANT_DIRECTORY_LOG_TYPE</span><span class="sxs-lookup"><span data-stu-id="6428d-222">Type of Entry, must be FX_FAULT_TOLERANT_DIRECTORY_LOG_TYPE</span></span>|
|<span data-ttu-id="6428d-223">Storlek</span><span class="sxs-lookup"><span data-stu-id="6428d-223">Size</span></span>|<span data-ttu-id="6428d-224">2</span><span class="sxs-lookup"><span data-stu-id="6428d-224">2</span></span>|<span data-ttu-id="6428d-225">Storlek på posten</span><span class="sxs-lookup"><span data-stu-id="6428d-225">Size of this entry</span></span>|
|<span data-ttu-id="6428d-226">Sektor förskjutning</span><span class="sxs-lookup"><span data-stu-id="6428d-226">Sector Offset</span></span>|<span data-ttu-id="6428d-227">4</span><span class="sxs-lookup"><span data-stu-id="6428d-227">4</span></span>|<span data-ttu-id="6428d-228">Offset (i byte) i den sektor där katalogen finns.</span><span class="sxs-lookup"><span data-stu-id="6428d-228">Offset (in bytes) into the sector where this directory is located.</span></span>|
|<span data-ttu-id="6428d-229">Logg sektor</span><span class="sxs-lookup"><span data-stu-id="6428d-229">Log Sector</span></span>|<span data-ttu-id="6428d-230">4</span><span class="sxs-lookup"><span data-stu-id="6428d-230">4</span></span>|<span data-ttu-id="6428d-231">Den sektor där katalog posten finns</span><span class="sxs-lookup"><span data-stu-id="6428d-231">The sector where the directory entry is located</span></span>|
|<span data-ttu-id="6428d-232">Loggdata</span><span class="sxs-lookup"><span data-stu-id="6428d-232">Log Data</span></span>|<span data-ttu-id="6428d-233">Variabel</span><span class="sxs-lookup"><span data-stu-id="6428d-233">Variable</span></span>|<span data-ttu-id="6428d-234">Katalog postens innehåll</span><span class="sxs-lookup"><span data-stu-id="6428d-234">Content of the directory entry</span></span>|

![Loggpost för Bitmap](./media/user-guide/bitmap-log-entry.png)

<span data-ttu-id="6428d-236">**Figur 8. Loggpost för Bitmap**</span><span class="sxs-lookup"><span data-stu-id="6428d-236">**Figure 8. Bitmap Log Entry**</span></span>

<span data-ttu-id="6428d-237">**TABELL 12. Loggpost för Bitmap**</span><span class="sxs-lookup"><span data-stu-id="6428d-237">**TABLE 12. Bitmap Log Entry**</span></span>

|<span data-ttu-id="6428d-238">Fält</span><span class="sxs-lookup"><span data-stu-id="6428d-238">Field</span></span>|<span data-ttu-id="6428d-239">Storlek (i byte)</span><span class="sxs-lookup"><span data-stu-id="6428d-239">Size(in bytes)</span></span>|<span data-ttu-id="6428d-240">Beskrivning</span><span class="sxs-lookup"><span data-stu-id="6428d-240">Description</span></span>|
|-----|--------------|-----------|
|<span data-ttu-id="6428d-241">Typ</span><span class="sxs-lookup"><span data-stu-id="6428d-241">Type</span></span>|<span data-ttu-id="6428d-242">2</span><span class="sxs-lookup"><span data-stu-id="6428d-242">2</span></span>|<span data-ttu-id="6428d-243">Typ av post måste vara FX_FAULT_TOLERANT_BITMAP_LOG_TYPE</span><span class="sxs-lookup"><span data-stu-id="6428d-243">Type of Entry, must be FX_FAULT_TOLERANT_BITMAP_LOG_TYPE</span></span>|
|<span data-ttu-id="6428d-244">Storlek</span><span class="sxs-lookup"><span data-stu-id="6428d-244">Size</span></span>|<span data-ttu-id="6428d-245">2</span><span class="sxs-lookup"><span data-stu-id="6428d-245">2</span></span>|<span data-ttu-id="6428d-246">Storlek på posten</span><span class="sxs-lookup"><span data-stu-id="6428d-246">Size of this entry</span></span>|
|<span data-ttu-id="6428d-247">Kluster nummer</span><span class="sxs-lookup"><span data-stu-id="6428d-247">Cluster Number</span></span>|<span data-ttu-id="6428d-248">4</span><span class="sxs-lookup"><span data-stu-id="6428d-248">4</span></span>|<span data-ttu-id="6428d-249">Kluster nummer</span><span class="sxs-lookup"><span data-stu-id="6428d-249">Cluster number</span></span>|
|<span data-ttu-id="6428d-250">Värde</span><span class="sxs-lookup"><span data-stu-id="6428d-250">Value</span></span>|<span data-ttu-id="6428d-251">4</span><span class="sxs-lookup"><span data-stu-id="6428d-251">4</span></span>|<span data-ttu-id="6428d-252">Värde som ska skrivas till FAT-posten</span><span class="sxs-lookup"><span data-stu-id="6428d-252">Value to be written into the FAT entry</span></span>|

## <a name="fault-tolerant-protection"></a><span data-ttu-id="6428d-253">Fel tolerans skydd</span><span class="sxs-lookup"><span data-stu-id="6428d-253">Fault Tolerant Protection</span></span>

<span data-ttu-id="6428d-254">När FileX-feltolerant modul startar söker den först efter en befintlig feltolerant loggfil på mediet.</span><span class="sxs-lookup"><span data-stu-id="6428d-254">After the FileX Fault Tolerant Module starts, it first searches for an existing fault tolerant log file in the media.</span></span> <span data-ttu-id="6428d-255">Om det inte går att hitta en giltig loggfil anser FileX att mediet inte är skyddat.</span><span class="sxs-lookup"><span data-stu-id="6428d-255">If a valid log file cannot be found, FileX considers the media unprotected.</span></span> <span data-ttu-id="6428d-256">I det här fallet kommer FileX att skapa en feltolerant logg fil på mediet.</span><span class="sxs-lookup"><span data-stu-id="6428d-256">In this case FileX will create a fault tolerant log file on the media.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="6428d-257">\* FileX kan inte skydda ett fil system om det var skadat innan den FileX feltoleranta modulen startar.</span><span class="sxs-lookup"><span data-stu-id="6428d-257">\*FileX is not able to protect a file system if it was corrupted before the FileX Fault Tolerant Module starts.</span></span> *

<span data-ttu-id="6428d-258">Om det finns en feltolerant logg fil söker FileX efter befintliga logg poster.</span><span class="sxs-lookup"><span data-stu-id="6428d-258">If a fault tolerant log file is located, FileX checks for existing log entries.</span></span> <span data-ttu-id="6428d-259">En loggfil utan loggpost indikerar att en tidigare fil har genomförts och alla logg poster togs bort.</span><span class="sxs-lookup"><span data-stu-id="6428d-259">A log file with no log entry indicates prior file operation was successful, and all log entries were removed.</span></span> <span data-ttu-id="6428d-260">I det här fallet kan programmet börja använda fil systemet med feltolerant skydd.</span><span class="sxs-lookup"><span data-stu-id="6428d-260">In this case the application can start using the file system with fault tolerant protection.</span></span>

<span data-ttu-id="6428d-261">Men om det finns logg poster måste FileX antingen slutföra den tidigare fil åtgärden eller återställa ändringarna som redan har tillämpats på fil systemet, ångra ändringarna.</span><span class="sxs-lookup"><span data-stu-id="6428d-261">However if log entries are located, FileX needs to either complete the prior file operation, or revert the changes already applied to the file system, effectively undo the changes.</span></span> <span data-ttu-id="6428d-262">I båda fallen återställs fil systemet till ett enhetligt tillstånd efter att logg posterna har tillämpats på fil systemet och programmet kan börja använda fil systemet igen.</span><span class="sxs-lookup"><span data-stu-id="6428d-262">In either case, after the log entries are applied to the file system, the file system is restored into a coherent state, and application can start using the file system again.</span></span>

<span data-ttu-id="6428d-263">För mediet som skyddas av FileX, under fil uppdaterings åtgärden, skrivs data delen direkt till mediet.</span><span class="sxs-lookup"><span data-stu-id="6428d-263">For media protected by FileX, during file update operation, the data portion is written directly to the media.</span></span> <span data-ttu-id="6428d-264">När FileX skriver data registreras även alla ändringar som krävs för att tillämpas på katalog poster, FAT-tabell.</span><span class="sxs-lookup"><span data-stu-id="6428d-264">As FileX writes data, it also records any changes needed to be applied to directory entries, FAT table.</span></span> <span data-ttu-id="6428d-265">Den här informationen registreras i de File-toleranta logg posterna.</span><span class="sxs-lookup"><span data-stu-id="6428d-265">This information is recorded in the file tolerant log entries.</span></span> <span data-ttu-id="6428d-266">Den här metoden garanterar att uppdateringar av fil systemet sker efter att data har skrivits till mediet.</span><span class="sxs-lookup"><span data-stu-id="6428d-266">This approach guarantees that updates to the file system occur after the data is written to the media.</span></span> <span data-ttu-id="6428d-267">Om mediet matas ut under data skrivnings fasen har viktig fil system information ännu inte ändrats.</span><span class="sxs-lookup"><span data-stu-id="6428d-267">If the media is ejected during the data-write phase, crucial file system information has not been changed yet.</span></span> <span data-ttu-id="6428d-268">Därför påverkas inte fil systemet av avbrottet.</span><span class="sxs-lookup"><span data-stu-id="6428d-268">Therefore the file system is not affected by the interruption.</span></span>

<span data-ttu-id="6428d-269">När alla data har skrivits till mediet kan FileX följa informationen i logg posterna för att tillämpa ändringarna i system information, en post i taget.</span><span class="sxs-lookup"><span data-stu-id="6428d-269">After all the data is successfully written to the media, FileX then follows information in the log entries to applies the changes to system information, one entry at a time.</span></span> <span data-ttu-id="6428d-270">När all system information har allokerats till mediet tas logg posterna bort från fel tolerans loggen.</span><span class="sxs-lookup"><span data-stu-id="6428d-270">After all the system information is committed to the media, the log entries are removed from the fault tolerant log.</span></span> <span data-ttu-id="6428d-271">Vid det här tillfället Slutför FileX fil uppdaterings åtgärden.</span><span class="sxs-lookup"><span data-stu-id="6428d-271">At this point, FileX completes the file update operation.</span></span>

<span data-ttu-id="6428d-272">Filer uppdateras inte på plats under fil uppdaterings åtgärden.</span><span class="sxs-lookup"><span data-stu-id="6428d-272">During file update operation, files are not updated in place.</span></span> <span data-ttu-id="6428d-273">Feltolerant modul allokerar en sektor för data att skriva nya data till och sedan ta bort sektorn som innehåller de data som ska skrivas över, uppdatera tillhör ande fett poster för att länka den nya sektorn till Chian.</span><span class="sxs-lookup"><span data-stu-id="6428d-273">The fault tolerant module allocates a sector for the data to write the new data into, and then remove the sector that contains the data to be overwritten, updating related FAT entries to link the new sector into the chian.</span></span> <span data-ttu-id="6428d-274">För situationer där partiella data i ett kluster behöver ändras, tilldelar FileX alltid nya kluster, skriver hela data från de gamla klustren med uppdaterade data till de nya klustren och frigör sedan de gamla klustren.</span><span class="sxs-lookup"><span data-stu-id="6428d-274">For situations in which partial data in a cluster needs to be modified, FileX always allocates new clusters, writes the entire data from the old clusters with updated data into the new clusters, then frees up the old clusters.</span></span> <span data-ttu-id="6428d-275">Detta garanterar att den ursprungliga filen är intakt om fil uppdateringen avbryts.</span><span class="sxs-lookup"><span data-stu-id="6428d-275">This guarantees that if the file update is interrupted, the original file is intact.</span></span> <span data-ttu-id="6428d-276">Programmet måste vara medveten om att det under FileX feltoleranta skyddet kräver att mediet har tillräckligt med ledigt utrymme för att rymma nya data innan sektorer med gamla data kan släppas.</span><span class="sxs-lookup"><span data-stu-id="6428d-276">The application needs to be aware that under FileX fault tolerant protection, updating data in a file requires the media to have enough free space to hold new data before sectors with old data can be released.</span></span> <span data-ttu-id="6428d-277">Om mediet inte har tillräckligt med utrymme för att lagra nya data, Miss lyckas uppdaterings åtgärden.</span><span class="sxs-lookup"><span data-stu-id="6428d-277">If the media doesn't have enough space to hold new data, the update operation fails.</span></span>
